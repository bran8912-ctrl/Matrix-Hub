---
import Panel from './Panel.astro';
---

<Panel title="MATRIX MUSIC PLAYER" class="music-player-panel">
  <p class="panel-text" style="text-align: center;">
    Choose your experience, add layer tracks and mixer for best results
  </p>
  
  <div class="music-notice">
    <strong>Music License:</strong><br>
    All tracks are royalty-free or licensed under Creative Commons.<br>
    <span style="font-size: 0.97em;">
      Kevin MacLeod (incompetech.com): CC BY 4.0<br>
      <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">https://creativecommons.org/licenses/by/4.0/</a>
    </span>
  </div>
  
  <div id="matrix-player">
    <div class="matrix-title">MATRIX-HUB MP3 PLAYER</div>
    
    <audio id="matrixAudio" preload="auto" crossorigin="anonymous"></audio>
    
    <div class="now-playing">
      <div class="now-playing-label">Now Playing</div>
      <div id="currentTrackTitle">Select a track</div>
      <div id="currentTrackArtist">--</div>
      <div id="trackNumber">Track 0 of 40</div>
    </div>
    
    <div class="player-controls">
      <button id="prevBtn" title="Previous">‚èÆ</button>
      <button id="playBtn" title="Play">‚ñ∂</button>
      <button id="pauseBtn" title="Pause">‚è∏</button>
      <button id="nextBtn" title="Next">‚è≠</button>
    </div>
    
    <div class="secondary-controls">
      <button id="shuffleBtn" title="Shuffle">üîÄ</button>
      <button id="loopBtn" title="Loop">üîÅ</button>
      <button id="autoplayBtn" class="active" title="Autoplay">üîä</button>
    </div>
    
    <div id="playerStatus">Loop: OFF | Shuffle: OFF | Autoplay: ON</div>
  </div>
</Panel>

<style>
  .music-player-panel {
    --matrix-pulse-color: var(--theme-border);
    margin: 20px auto;
    max-width: 900px;
  }
  
  .music-notice {
    margin: 10px 0 18px 0;
    font-size: 0.98em;
    color: var(--theme-secondary);
    background: rgba(0,0,0,0.08);
    border-radius: 6px;
    padding: 8px;
    text-align: center;
  }
  
  #matrix-player {
    margin: 20px auto;
    padding: 20px;
    max-width: 350px;
    background: var(--theme-bg-panel);
    border: 2px solid var(--theme-primary);
    border-radius: 10px;
    text-align: center;
    font-family: 'Courier New', monospace;
    box-shadow: 0 0 20px var(--theme-glow);
  }
  
  .matrix-title {
    font-size: 18px;
    color: var(--theme-primary);
    margin-bottom: 15px;
    text-shadow: 0 0 8px var(--theme-glow);
  }
  
  .now-playing {
    background: rgba(0, 255, 65, 0.1);
    border: 1px solid var(--theme-border);
    border-radius: 5px;
    padding: 12px;
    margin-bottom: 15px;
  }
  
  .now-playing-label {
    font-size: 10px;
    color: var(--theme-primary);
    margin-bottom: 5px;
    text-transform: uppercase;
    opacity: 0.7;
  }
  
  #currentTrackTitle {
    font-size: 14px;
    color: var(--theme-primary);
    font-weight: bold;
    margin-bottom: 3px;
    text-shadow: 0 0 5px var(--theme-glow);
  }
  
  #currentTrackArtist {
    font-size: 12px;
    color: var(--theme-secondary);
  }
  
  #trackNumber {
    font-size: 11px;
    color: var(--theme-text);
    margin-top: 5px;
    opacity: 0.7;
  }
  
  #matrix-player button {
    background: black;
    color: var(--theme-primary);
    border: 1px solid var(--theme-border);
    padding: 10px 14px;
    margin: 4px;
    cursor: pointer;
    font-family: inherit;
    border-radius: 5px;
    transition: 0.2s;
    font-size: 14px;
  }
  
  #matrix-player button:hover {
    background: var(--theme-primary);
    color: black;
  }
  
  #matrix-player button.active {
    background: var(--theme-primary);
    color: black;
  }
  
  .player-controls {
    margin-bottom: 10px;
  }
  
  .secondary-controls {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 5px;
  }
  
  .secondary-controls button {
    padding: 6px 10px !important;
    font-size: 12px !important;
  }
  
  #playerStatus {
    margin-top: 12px;
    font-size: 11px;
    color: var(--theme-text);
    opacity: 0.7;
  }
  
  @media (max-width: 768px) {
    #matrix-player {
      width: 90vw;
    }
  }
</style>

<script>
  // Basic music player functionality
  const matrixAudio = document.getElementById('matrixAudio') as HTMLAudioElement;
  const currentTrackTitle = document.getElementById('currentTrackTitle');
  const currentTrackArtist = document.getElementById('currentTrackArtist');
  const trackNumber = document.getElementById('trackNumber');
  const playerStatus = document.getElementById('playerStatus');
  
  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const loopBtn = document.getElementById('loopBtn');
  const autoplayBtn = document.getElementById('autoplayBtn');
  
  // Sample playlist (subset from original)
  const matrixPlaylist = [
    { title: "Cyberpunk City", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/140/140.mp3" },
    { title: "Deep Techno Ambience", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/134/134.mp3" },
    { title: "Techno Fest Vibes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/124/124.mp3" },
    { title: "Hazy After Hours", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/132/132.mp3" },
    { title: "Minimal Techno 01", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/162/162.mp3" }
  ];
  
  let currentTrackIndex = 0;
  let isShuffleOn = false;
  let isLoopOn = false;
  let isAutoplayOn = true;
  
  function loadTrack(index: number) {
    const track = matrixPlaylist[index];
    if (track && matrixAudio) {
      matrixAudio.src = track.url;
      if (currentTrackTitle) currentTrackTitle.textContent = track.title;
      if (currentTrackArtist) currentTrackArtist.textContent = track.artist;
      if (trackNumber) trackNumber.textContent = `Track ${index + 1} of ${matrixPlaylist.length}`;
    }
  }
  
  function updatePlayerStatus() {
    if (playerStatus) {
      playerStatus.textContent = `Loop: ${isLoopOn ? 'ON' : 'OFF'} | Shuffle: ${isShuffleOn ? 'ON' : 'OFF'} | Autoplay: ${isAutoplayOn ? 'ON' : 'OFF'}`;
    }
  }
  
  playBtn?.addEventListener('click', () => matrixAudio?.play());
  pauseBtn?.addEventListener('click', () => matrixAudio?.pause());
  
  prevBtn?.addEventListener('click', () => {
    currentTrackIndex = (currentTrackIndex - 1 + matrixPlaylist.length) % matrixPlaylist.length;
    loadTrack(currentTrackIndex);
    if (!matrixAudio?.paused) matrixAudio?.play();
  });
  
  nextBtn?.addEventListener('click', () => {
    currentTrackIndex = (currentTrackIndex + 1) % matrixPlaylist.length;
    loadTrack(currentTrackIndex);
    if (!matrixAudio?.paused) matrixAudio?.play();
  });
  
  shuffleBtn?.addEventListener('click', () => {
    isShuffleOn = !isShuffleOn;
    shuffleBtn.classList.toggle('active');
    updatePlayerStatus();
  });
  
  loopBtn?.addEventListener('click', () => {
    isLoopOn = !isLoopOn;
    loopBtn.classList.toggle('active');
    if (matrixAudio) matrixAudio.loop = isLoopOn;
    updatePlayerStatus();
  });
  
  autoplayBtn?.addEventListener('click', () => {
    isAutoplayOn = !isAutoplayOn;
    autoplayBtn.classList.toggle('active');
    updatePlayerStatus();
  });
  
  matrixAudio?.addEventListener('ended', () => {
    if (isAutoplayOn && !isLoopOn) {
      currentTrackIndex = (currentTrackIndex + 1) % matrixPlaylist.length;
      loadTrack(currentTrackIndex);
      matrixAudio?.play();
    }
  });
  
  // Load first track
  loadTrack(0);
</script>
