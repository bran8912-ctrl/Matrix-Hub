<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CKWFL856MZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-CKWFL856MZ');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name='impact-site-verification' value='7c857a2b-e958-419c-9417-238f3c42d3dd'>
  <title>The Matrix Hub</title>
  <style>
    /* Theme CSS Variables - Dynamic Theming System */
    :root {
      --theme-primary: #00ff00;
      --theme-secondary: #00ffff;
      --theme-glow: #00ff00;
      --theme-bg-dark: #000000;
      --theme-bg-panel: rgba(0, 20, 0, 0.18);
      --theme-text: #00ffff;
      --theme-border: #00ff00;
      --theme-name: 'Classic Matrix';

      /* Audio-reactive UI pulse (0..1) */
      --matrix-bass: 0;

      /* Section-specific color variables */
      --section-music-player: #00ff41;
      --section-deal-scanner: #00ff00;
      --section-daily-drops: #00ff00;
      --section-art-generator: #00ff00;
      --section-video-generator: #00ff00;
      --section-bot-widget: #00ff9c;
    }

    /* Preset Theme Classes */
    .theme-classic {
      --theme-primary: #00ff00;
      --theme-secondary: #00ffff;
      --theme-glow: #00ff00;
      --theme-bg-dark: #000000;
      --theme-bg-panel: rgba(0, 20, 0, 0.18);
      --theme-text: #00ffff;
      --theme-border: #00ff00;
      --theme-name: 'Classic Matrix';
      --section-music-player: #00ff41;
      --section-deal-scanner: #00ff00;
      --section-daily-drops: #00ff00;
      --section-art-generator: #00ff00;
      --section-video-generator: #00ff00;
      --section-bot-widget: #00ff9c;
    }

    .theme-cyber-purple {
      --theme-primary: #bf00ff;
      --theme-secondary: #ff00ff;
      --theme-glow: #bf00ff;
      --theme-bg-dark: #0a000f;
      --theme-bg-panel: rgba(20, 0, 30, 0.18);
      --theme-text: #ff66ff;
      --theme-border: #bf00ff;
      --theme-name: 'Cyber Purple';
      --section-music-player: #bf00ff;
      --section-deal-scanner: #bf00ff;
      --section-daily-drops: #bf00ff;
      --section-art-generator: #bf00ff;
      --section-video-generator: #bf00ff;
      --section-bot-widget: #bf00ff;
    }

    .theme-neon-blue {
      --theme-primary: #00bfff;
      --theme-secondary: #00ffff;
      --theme-glow: #00bfff;
      --theme-bg-dark: #000a14;
      --theme-bg-panel: rgba(0, 15, 30, 0.18);
      --theme-text: #66d9ff;
      --theme-border: #00bfff;
      --theme-name: 'Neon Blue';
      --section-music-player: #00bfff;
      --section-deal-scanner: #00bfff;
      --section-daily-drops: #00bfff;
      --section-art-generator: #00bfff;
      --section-video-generator: #00bfff;
      --section-bot-widget: #00bfff;
    }

    .theme-blood-red {
      --theme-primary: #ff0040;
      --theme-secondary: #ff6680;
      --theme-glow: #ff0040;
      --theme-bg-dark: #0f0000;
      --theme-bg-panel: rgba(30, 0, 10, 0.18);
      --theme-text: #ff8099;
      --theme-border: #ff0040;
      --theme-name: 'Blood Red';
      --section-music-player: #ff0040;
      --section-deal-scanner: #ff0040;
      --section-daily-drops: #ff0040;
      --section-art-generator: #ff0040;
      --section-video-generator: #ff0040;
      --section-bot-widget: #ff0040;
    }

    .theme-gold-elite {
      --theme-primary: #ffd700;
      --theme-secondary: #ffea00;
      --theme-glow: #ffd700;
      --theme-bg-dark: #0a0800;
      --theme-bg-panel: rgba(30, 25, 0, 0.18);
      --theme-text: #ffeb80;
      --theme-border: #ffd700;
      --theme-name: 'Gold Elite';
      --section-music-player: #ffd700;
      --section-deal-scanner: #ffd700;
      --section-daily-drops: #ffd700;
      --section-art-generator: #ffd700;
      --section-video-generator: #ffd700;
      --section-bot-widget: #ffd700;
    }

    .theme-toxic-orange {
      --theme-primary: #ff6600;
      --theme-secondary: #ff9933;
      --theme-glow: #ff6600;
      --theme-bg-dark: #0f0800;
      --theme-bg-panel: rgba(30, 15, 0, 0.18);
      --theme-text: #ffb366;
      --theme-border: #ff6600;
      --theme-name: 'Toxic Orange';
      --section-music-player: #ff6600;
      --section-deal-scanner: #ff6600;
      --section-daily-drops: #ff6600;
      --section-art-generator: #ff6600;
      --section-video-generator: #ff6600;
      --section-bot-widget: #ff6600;
    }

    .theme-arctic-white {
      --theme-primary: #ffffff;
      --theme-secondary: #e0e0e0;
      --theme-glow: #ffffff;
      --theme-bg-dark: #0a0a0a;
      --theme-bg-panel: rgba(20, 20, 20, 0.18);
      --theme-text: #f0f0f0;
      --theme-border: #ffffff;
      --theme-name: 'Arctic White';
      --section-music-player: #ffffff;
      --section-deal-scanner: #ffffff;
      --section-daily-drops: #ffffff;
      --section-art-generator: #ffffff;
      --section-video-generator: #ffffff;
      --section-bot-widget: #ffffff;
    }

    .theme-synthwave {
      --theme-primary: #ff00ff;
      --theme-secondary: #00ffff;
      --theme-glow: #ff00ff;
      --theme-bg-dark: #0d0221;
      --theme-bg-panel: rgba(25, 5, 50, 0.18);
      --theme-text: #00ffff;
      --theme-border: #ff00ff;
      --theme-name: 'Synthwave';
      --section-music-player: #ff00ff;
      --section-deal-scanner: #ff00ff;
      --section-daily-drops: #ff00ff;
      --section-art-generator: #ff00ff;
      --section-video-generator: #ff00ff;
      --section-bot-widget: #ff00ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--theme-bg-dark);
      color: var(--theme-text);
      text-shadow: 0 0 7px var(--theme-glow);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Matrix Rain Canvas */
    #matrix-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    h1 {
      text-align: center;
      padding: 20px;
      font-size: 2.8rem;
    }

    .container {
      display: grid;
      gap: 20px;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    .panel {
      --matrix-pulse-color: var(--theme-border);
      border: 2px solid var(--theme-border);
      padding: 20px;
      border-radius: 10px;
      background: var(--theme-bg-panel);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow:
        0 0 0 calc(var(--matrix-bass) * 2px) var(--matrix-pulse-color),
        0 0 calc(10px + var(--matrix-bass) * 24px) var(--matrix-pulse-color);
      will-change: box-shadow;
    }

    .panel h2 {
      margin-top: 0;
    }

    .panel-text {
      padding: 10px 0;
      font-size: 1.1rem;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      background: var(--theme-bg-dark);
      color: var(--theme-primary);
      border: 1px solid var(--theme-border);
      border-radius: 6px;
      text-align: center;
      text-decoration: none;
      font-weight: bold;
      transition: 0.2s;
    }

    .btn:hover {
      background: var(--theme-bg-panel);
      box-shadow: 0 0 10px var(--theme-glow);
    }
  </style>

<!-- ORACLE BOT WIDGET STYLES -->
<style>
  /* --- ORACLE THEME COLORS --- */
  :root {
    --oracle-gold: #e8c76a;
    --oracle-violet: #7c3aed;
    --oracle-violet-2: #a78bfa;
    --oracle-ink: #050510;
    --oracle-ink-2: #0b0720;
    --oracle-border: rgba(232, 199, 106, 0.55);
    --oracle-glow: rgba(124, 58, 237, 0.65);
  }

  /* --- FLOATING BUTTON --- */
  #matrixBotButton {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background: radial-gradient(120% 120% at 30% 30%, rgba(167, 139, 250, 0.20), rgba(5, 5, 16, 0.95)),
      linear-gradient(135deg, rgba(124, 58, 237, 0.22), rgba(232, 199, 106, 0.12));
    color: var(--oracle-gold);
    border: 2px solid var(--oracle-border);
    width: 65px;
    height: 65px;
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    cursor: pointer;
    font-size: 30px;
    box-shadow: 0 0 18px rgba(232, 199, 106, 0.25), 0 0 28px var(--oracle-glow);
    animation: oracleGlow 2.2s infinite alternate;
    z-index: 9999;
  }

  /* --- CHAT WINDOW --- */
	  #matrixBotWindow {
	    position: fixed;
	    bottom: 110px;
	    right: 25px;
	    width: 340px;
	    height: 420px;
	    background: radial-gradient(130% 120% at 30% 10%, rgba(124, 58, 237, 0.16), rgba(5, 5, 16, 0.92));
	    border: 1px solid rgba(232, 199, 106, 0.45);
	    border-radius: 10px;
	    display: none;
	    flex-direction: column;
	    overflow: hidden;
	    box-shadow: 0 0 22px rgba(124, 58, 237, 0.28), 0 0 26px rgba(232, 199, 106, 0.12);
	    backdrop-filter: blur(10px);
	    -webkit-backdrop-filter: blur(10px);
	    z-index: 9999;
	  }

	  #matrixBotHeader {
	    background: linear-gradient(180deg, rgba(5, 5, 16, 0.95), rgba(11, 7, 32, 0.78));
	    color: var(--oracle-gold);
	    padding: 10px 10px 8px;
	    text-align: center;
	    font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
	    border-bottom: 1px solid rgba(232, 199, 106, 0.35);
      letter-spacing: 0.06em;
	  }

  #matrixBotMessages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    color: rgba(232, 199, 106, 0.95);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #matrixBotInputArea {
    display: flex;
    border-top: 1px solid rgba(232, 199, 106, 0.30);
  }

	  #matrixBotInput {
	    flex: 1;
	    padding: 10px;
	    background: rgba(5, 5, 16, 0.55);
	    color: rgba(255, 245, 210, 0.92);
	    border: none;
	    outline: none;
	    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
	  }

	  #matrixBotSend {
	    width: 55px;
	    background: rgba(5, 5, 16, 0.55);
	    color: var(--oracle-gold);
	    border: none;
	    cursor: pointer;
	    font-size: 20px;
	  }

  #matrixBotSend:hover {
    background: rgba(124, 58, 237, 0.16);
  }

  .bot-msg {
    display: flex;
    flex-direction: column;
    gap: 3px;
    max-width: 92%;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(232, 199, 106, 0.16);
    background: rgba(11, 7, 32, 0.40);
    white-space: pre-wrap;
    line-height: 1.35;
  }

  .bot-msg--user {
    align-self: flex-end;
    border-color: rgba(167, 139, 250, 0.22);
    background: rgba(124, 58, 237, 0.14);
    color: rgba(255, 245, 210, 0.92);
  }

  .bot-msg--oracle {
    align-self: flex-start;
    border-color: rgba(232, 199, 106, 0.22);
    background: rgba(5, 5, 16, 0.50);
    color: rgba(232, 199, 106, 0.95);
  }

  .bot-msg__name {
    font-size: 12px;
    opacity: 0.85;
    letter-spacing: 0.04em;
  }

  /* --- GLOW ANIMATION --- */
  @keyframes oracleGlow {
    from { box-shadow: 0 0 12px rgba(232, 199, 106, 0.22), 0 0 22px rgba(124, 58, 237, 0.40); }
    to   { box-shadow: 0 0 20px rgba(232, 199, 106, 0.32), 0 0 34px rgba(124, 58, 237, 0.65); }
  }
</style>

<link rel="stylesheet" href="/oracle/oracle-secretary.css" />

</head>
<body>
<!-- MTX ECOSYSTEM SECTION -->
<div id="mtx-ecosystem" class="panel" style="margin: 30px auto; max-width: 900px; border: 2px solid var(--theme-border); background: var(--theme-bg-panel); box-shadow: 0 0 24px var(--theme-glow);">
  <h2 style="color:var(--theme-primary); text-shadow: 0 0 10px var(--theme-glow); font-family: 'Courier New', monospace; letter-spacing: 2px; margin-bottom: 12px;">MTX Ecosystem</h2>
  <div class="panel-text" style="font-size: 1.15rem; color: var(--theme-text); margin-bottom: 18px;">
    <strong>MTX</strong> is the key token powering Matrix-Hub.<br>
    Earn, spend, burn, and lock MTX to unlock features, access premium tools, and participate in the Casino.
  </div>
  <ul style="margin: 18px 0 0 20px; font-size: 1.08rem;">
    <li><span style="color:var(--theme-primary); font-weight:bold;">Earn MTX:</span> Usage milestones, bug reports, GitHub actions, community testing</li>
    <li><span style="color:var(--theme-primary); font-weight:bold;">Spend MTX:</span> Premium tools, priority execution, experimental modules, Casino games</li>
    <li><span style="color:var(--theme-primary); font-weight:bold;">Burn MTX:</span> A % of premium spending is burned to keep supply healthy</li>
    <li><span style="color:var(--theme-primary); font-weight:bold;">Lock MTX:</span> Stake MTX for tier access, unlock after a set period</li>
    <li><span style="color:var(--theme-primary); font-weight:bold;">Casino:</span> Play slots, blackjack, roulette to win or spend MTX</li>
  </ul>
  <div class="panel-text" style="margin-top: 18px; color:var(--theme-secondary); font-size: 1.08rem;">
    MTX is useful, accessible, and designed for sustainable growth‚Äîno hype cycles required.
  </div>
</div>
<style>
#donate-banner {
    margin: 0 auto 20px auto;
    padding: 15px 20px;
    width: 90%;
    max-width: 800px;
    background: var(--theme-bg-panel);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 10px;
    text-align: center;
    font-family: 'Courier New', monospace;
    box-shadow:
      0 0 0 calc(var(--matrix-bass) * 2px) var(--theme-primary, #00ff00),
      0 0 calc(25px + var(--matrix-bass) * 28px) var(--theme-primary, #00ff00),
      inset 0 0 15px rgba(0, 255, 0, 0.1);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

#donate-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.1), transparent);
    animation: donateShimmer 3s infinite;
}

@keyframes donateShimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.donate-title {
    font-size: 16px;
    color: var(--theme-primary, #00ff00);
    margin-bottom: 8px;
    text-shadow: 0 0 10px var(--theme-primary, #00ff00);
    text-transform: uppercase;
    letter-spacing: 2px;
}

.donate-message {
    font-size: 13px;
    color: var(--theme-secondary, #00ffff);
    margin-bottom: 12px;
    opacity: 0.9;
    line-height: 1.4;
}

.donate-wallets {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
}

.wallet-item {
    background: rgba(0, 255, 0, 0.05);
    border: 1px solid var(--theme-primary, #00ff00);
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 11px;
    color: var(--theme-text, #00ffff);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.wallet-item:hover {
    background: rgba(0, 255, 0, 0.15);
    box-shadow: 0 0 15px var(--theme-primary, #00ff00);
    transform: scale(1.02);
}

.wallet-label {
    color: var(--theme-primary, #00ff00);
    font-weight: bold;
    margin-right: 5px;
}

.wallet-address {
    font-size: 10px;
    word-break: break-all;
    opacity: 0.85;
}

.donate-click-hint {
    font-size: 9px;
    color: var(--theme-secondary, #00ffff);
    margin-top: 8px;
    opacity: 0.6;
}

.paypal-donate-btn {
    display: inline-block;
    background: linear-gradient(135deg, #003087, #001a4d);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 8px;
    padding: 12px 24px;
    margin-top: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
}

.paypal-donate-btn:hover {
    background: linear-gradient(135deg, #004db3, #002a80);
    box-shadow: 0 0 25px var(--theme-primary, #00ff00), 0 0 40px rgba(0, 48, 135, 0.5);
    transform: scale(1.05);
}

.paypal-donate-btn span {
    color: var(--theme-primary, #00ff00);
    font-size: 14px;
    font-weight: bold;
    text-shadow: 0 0 10px var(--theme-primary, #00ff00);
    letter-spacing: 1px;
}

.venmo-donate-btn {
    display: inline-block;
    background: linear-gradient(135deg, #008CFF, #004d8c);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 8px;
    padding: 12px 24px;
    margin-top: 15px;
    margin-left: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
}

.venmo-donate-btn:hover {
    background: linear-gradient(135deg, #00a3ff, #0066b3);
    box-shadow: 0 0 25px var(--theme-primary, #00ff00), 0 0 40px rgba(0, 140, 255, 0.5);
    transform: scale(1.05);
}

.venmo-donate-btn span {
    color: var(--theme-primary, #00ff00);
    font-size: 14px;
    font-weight: bold;
    text-shadow: 0 0 10px var(--theme-primary, #00ff00);
    letter-spacing: 1px;
}

.cashapp-donate-btn {
    display: inline-block;
    background: linear-gradient(135deg, #00D632, #007a1d);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 8px;
    padding: 12px 24px;
    margin-top: 15px;
    margin-left: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
}

.cashapp-donate-btn:hover {
    background: linear-gradient(135deg, #00ff3c, #00a324);
    box-shadow: 0 0 25px var(--theme-primary, #00ff00), 0 0 40px rgba(0, 214, 50, 0.5);
    transform: scale(1.05);
}

.cashapp-donate-btn span {
    color: #000;
    font-size: 14px;
    font-weight: bold;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
    letter-spacing: 1px;
}

.telegram-join-btn {
    display: inline-block;
    background: linear-gradient(135deg, #0088cc, #005580);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 8px;
    padding: 12px 24px;
    margin-top: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
}

.telegram-join-btn:hover {
    background: linear-gradient(135deg, #00a3e6, #006699);
    box-shadow: 0 0 25px var(--theme-primary, #00ff00), 0 0 40px rgba(0, 136, 204, 0.5);
    transform: scale(1.05);
}

.telegram-join-btn span {
    color: var(--theme-primary, #00ff00);
    font-size: 14px;
    font-weight: bold;
    text-shadow: 0 0 10px var(--theme-primary, #00ff00);
    letter-spacing: 1px;
}

.donate-buttons-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
}

@media (max-width: 600px) {
    .donate-buttons-container {
        flex-direction: column;
        align-items: center;
    }
    .venmo-donate-btn, .cashapp-donate-btn, .paypal-donate-btn, .telegram-join-btn {
        margin-left: 0;
        width: 80%;
    }
}
    .donate-wallets {
        flex-direction: column;
        align-items: center;
    }
    .wallet-item {
        width: 90%;
    }
}
</style>

<div id="donate-banner">
    <div class="donate-title">‚ö° Keep The Matrix Alive ‚ö°</div>
    <div class="donate-message">Server costs and development require resources. Your contribution helps maintain free access for everyone in the Matrix.</div>
    <div class="donate-wallets">
        <div class="wallet-item" onclick="navigator.clipboard.writeText('bc1qfv2lky7ydu9yg6xwdmqea4h4n8mnvfry86nnuw'); this.querySelector('.wallet-label').textContent='Copied!';">
            <span class="wallet-label">BTC:</span>
            <span class="wallet-address">bc1qfv2lky7ydu9yg6xwdmqea4h4n8mnvfry86nnuw</span>
        </div>
        <div class="wallet-item" onclick="navigator.clipboard.writeText('0x8711467ad4baf15ab7691a4dadc139fcc9c4da54'); this.querySelector('.wallet-label').textContent='Copied!';">
            <span class="wallet-label">ETH:</span>
            <span class="wallet-address">0x8711467ad4baf15ab7691a4dadc139fcc9c4da54</span>
        </div>
        <div class="wallet-item" onclick="navigator.clipboard.writeText('6A5DvUXRH2ZxPYNG1WsdyanQ3QuU6vuWqCjgVx487UYx'); this.querySelector('.wallet-label').textContent='Copied!';">
            <span class="wallet-label">SOL:</span>
            <span class="wallet-address">6A5DvUXRH2ZxPYNG1WsdyanQ3QuU6vuWqCjgVx487UYx</span>
        </div>
    </div>
    <div class="donate-click-hint">Click any address to copy</div>
    <div class="donate-buttons-container">
        <a href="https://t.me/matrixhuborg" target="_blank" rel="noopener noreferrer" class="telegram-join-btn">
            <span>üì¢ Join Telegram Channel</span>
        </a>
        <a href="https://www.paypal.me/bletourneau692" target="_blank" rel="noopener noreferrer" class="paypal-donate-btn">
            <span>üí≥ Donate via PayPal</span>
        </a>
        <a href="https://venmo.com/code?user_id=2943286704603136860&created=1765731516" target="_blank" rel="noopener noreferrer" class="venmo-donate-btn">
            <span>üì± Donate via Venmo</span>
        </a>
        <a href="https://cash.app/$bran8912" target="_blank" rel="noopener noreferrer" class="cashapp-donate-btn">
            <span>üíµ Donate via CashApp</span>
        </a>
    </div>
</div>

<!-- TELEGRAM CHANNEL WIDGET -->
<style>
.telegram-widget-container {
    margin: 20px auto;
    padding: 20px;
    max-width: 600px;
    background: var(--theme-bg-panel);
    border: 2px solid var(--theme-primary, #00ff00);
    border-radius: 10px;
    text-align: center;
    font-family: 'Courier New', monospace;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.telegram-widget-title {
    font-size: 20px;
    color: var(--theme-primary, #00ff00);
    margin-bottom: 15px;
    text-shadow: 0 0 10px var(--theme-primary, #00ff00);
    letter-spacing: 2px;
}

.telegram-widget-subtitle {
    font-size: 14px;
    color: var(--theme-secondary, #00ffff);
    margin-bottom: 20px;
    opacity: 0.9;
}

.telegram-embed {
    border-radius: 8px;
    overflow: hidden;
    margin: 0 auto;
}
</style>

<div class="telegram-widget-container">
    <div class="telegram-widget-title">üì¢ MATRIX HUB TELEGRAM</div>
    <div class="telegram-widget-subtitle">Join our community for exclusive updates & deals</div>
    <div class="telegram-embed">
        <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-post="matrixhuborg/1" data-width="100%"></script>
    </div>
    <div style="margin-top: 20px;">
        <a href="https://t.me/matrixhuborg" target="_blank" rel="noopener noreferrer" 
           style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #00ff00, #00cc00); color: #000; text-decoration: none; border-radius: 25px; font-weight: bold; box-shadow: 0 0 20px rgba(0, 255, 0, 0.4); transition: all 0.3s ease;">
            üöÄ Join Channel
        </a>
    </div>
</div>

<!-- MATRIX MUSIC PLAYER -->
<style>
#matrix-player {
    margin: 20px auto;
    padding: 20px;
    width: 350px;
    max-width: 95%;
    background: var(--theme-bg-panel);
    border: 2px solid var(--section-music-player, #00ff41);
    border-radius: 10px;
    text-align: center;
    font-family: 'Courier New', monospace;
    box-shadow:
      0 0 0 calc(var(--matrix-bass) * 2px) var(--section-music-player, #00ff41),
      0 0 calc(20px + var(--matrix-bass) * 28px) var(--section-music-player, #00ff41);
    position: relative;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.matrix-title {
    font-size: 18px;
    color: var(--section-music-player, #00ff41);
    margin-bottom: 15px;
    text-shadow: 0 0 8px var(--section-music-player, #00ff41);
}

.player-tabs {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 0 0 14px;
}

#matrix-player .player-tab-btn {
    padding: 8px 10px;
    font-size: 12px;
    letter-spacing: 1px;
    text-transform: uppercase;
}

#matrix-player .player-tab-btn.active {
    background: var(--section-music-player, #00ff41);
    color: black;
}

.matrix-player-tab {
    display: block;
}

	/* Layers tab */
	.layers-header {
	    background: rgba(0, 255, 65, 0.08);
	    border: 1px solid var(--section-music-player, #00ff41);
	    border-radius: 5px;
	    padding: 10px;
	    margin-bottom: 12px;
	    text-align: left;
	}

	.layers-title {
	    font-size: 14px;
	    color: var(--section-music-player, #00ff41);
	    font-weight: bold;
	    margin: 3px 0 2px;
	    text-shadow: 0 0 5px var(--section-music-player, #00ff41);
	}

	.layers-subtitle {
	    font-size: 11px;
	    color: var(--section-music-player, #0a0);
	    opacity: 0.85;
	}

	.layers-panel {
	    border: 1px solid var(--section-music-player, #0a0);
	    border-radius: 5px;
	    background: rgba(0, 20, 0, 0.18);
	    padding: 10px;
	    margin-bottom: 12px;
	}

	.layers-row {
	    display: flex;
	    justify-content: center;
	    gap: 6px;
	    flex-wrap: wrap;
	}

	.layers-mix {
	    margin-top: 8px;
	    display: grid;
	    grid-template-columns: 78px 1fr 52px;
	    align-items: center;
	    gap: 8px;
	}

	.layers-mix label {
	    font-size: 11px;
	    color: var(--section-music-player, #0a0);
	    opacity: 0.85;
	    text-align: left;
	}

	.layers-mix input[type="range"] {
	    width: 100%;
	    accent-color: var(--section-music-player, #00ff41);
	}

	.layers-actions {
	    margin-top: 10px;
	    display: flex;
	    justify-content: center;
	    gap: 6px;
	    flex-wrap: wrap;
	}

	#layersNowPlaying {
	    margin-top: 10px;
	    font-size: 11px;
	    color: var(--section-music-player, #0a0);
	    opacity: 0.85;
	    text-align: center;
	}

	.layers-picks {
	    border: 1px solid var(--section-music-player, #0a0);
	    border-radius: 5px;
	    background: rgba(0, 0, 0, 0.25);
	    padding: 10px;
	    margin-bottom: 12px;
	    text-align: left;
	}

	.layers-picks-list {
	    display: grid;
	    grid-template-columns: 1fr;
	    gap: 8px;
	    margin-top: 8px;
	}

	.layers-picks-list button {
	    width: 100%;
	    padding: 8px 10px !important;
	    font-size: 11px !important;
	    text-align: left;
	    white-space: nowrap;
	    overflow: hidden;
	    text-overflow: ellipsis;
	}

	.layers-picker {
	    display: grid;
	    grid-template-columns: 1fr auto;
	    gap: 8px;
	    align-items: center;
	}

	#layersTrackSelect {
	    width: 100%;
	    background: black;
	    color: var(--section-music-player, #00ff41);
	    border: 1px solid var(--section-music-player, #00ff41);
	    border-radius: 5px;
	    padding: 8px 10px;
	    font-family: inherit;
	    font-size: 12px;
	}

.now-playing {
    background: rgba(0, 255, 65, 0.1);
    border: 1px solid var(--section-music-player, #00ff41);
    border-radius: 5px;
    padding: 12px;
    margin-bottom: 15px;
}

.now-playing-label {
    font-size: 10px;
    color: var(--section-music-player, #0a0);
    margin-bottom: 5px;
    text-transform: uppercase;
    opacity: 0.7;
}

#currentTrackTitle {
    font-size: 14px;
    color: var(--section-music-player, #00ff41);
    font-weight: bold;
    margin-bottom: 3px;
    text-shadow: 0 0 5px var(--section-music-player, #00ff41);
}

#currentTrackArtist {
    font-size: 12px;
    color: var(--section-music-player, #0f0);
}

#trackNumber {
    font-size: 11px;
    color: var(--section-music-player, #0a0);
    margin-top: 5px;
    opacity: 0.7;
}

#matrix-player button {
    background: black;
    color: var(--section-music-player, #00ff41);
    border: 1px solid var(--section-music-player, #00ff41);
    padding: 10px 14px;
    margin: 4px;
    cursor: pointer;
    font-family: inherit;
    border-radius: 5px;
    transition: 0.2s;
    font-size: 14px;
}

#matrix-player button:hover {
    background: var(--section-music-player, #00ff41);
    color: black;
}

#matrix-player button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.player-controls {
    margin-bottom: 10px;
}

.secondary-controls {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 5px;
}

.secondary-controls button {
    padding: 6px 10px !important;
    font-size: 12px !important;
}

.secondary-controls button.active {
    background: var(--section-music-player, #00ff41);
    color: black;
}

#playerStatus {
    margin-top: 12px;
    font-size: 11px;
    color: var(--section-music-player, #0a0);
    opacity: 0.7;
}

/* Click to play overlay */
#clickToPlayOverlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    border-radius: 10px;
    animation: pulse-glow 1.5s ease-in-out infinite;
}

#clickToPlayOverlay:hover {
    background: rgba(0, 30, 0, 0.6);
}

.click-to-play-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: var(--section-music-player, #00ff41);
    font-family: 'Courier New', monospace;
    text-align: center;
}

.click-to-play-content .play-icon {
    font-size: 48px;
    animation: bounce 0.8s ease-in-out infinite;
}

.click-to-play-content span:last-child {
    font-size: 14px;
    letter-spacing: 2px;
}

@keyframes pulse-glow {
    0%, 100% { box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.2); }
    50% { box-shadow: inset 0 0 40px rgba(0, 255, 65, 0.4); }
}

@keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* Playlist styles */
#playlistContainer {
    margin-top: 15px;
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid var(--section-music-player, #0a0);
    border-radius: 5px;
    background: rgba(0, 20, 0, 0.22);
}

#playlistContainer::-webkit-scrollbar {
    width: 8px;
}

#playlistContainer::-webkit-scrollbar-track {
    background: #001a00;
}

#playlistContainer::-webkit-scrollbar-thumb {
    background: var(--section-music-player, #00ff41);
    border-radius: 4px;
}

.playlist-item {
    padding: 8px 10px;
    text-align: left;
    cursor: pointer;
    border-bottom: 1px solid var(--section-music-player, #0a0);
    transition: 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.playlist-item:last-child {
    border-bottom: none;
}

.playlist-item:hover {
    background: rgba(0, 255, 65, 0.15);
}

.playlist-item.active {
    background: rgba(0, 255, 65, 0.25);
    border-left: 3px solid var(--section-music-player, #00ff41);
}

.playlist-num {
    font-size: 10px;
    color: var(--section-music-player, #0a0);
    min-width: 20px;
    opacity: 0.7;
}

.playlist-info {
    flex: 1;
    overflow: hidden;
}

.playlist-title {
    font-size: 12px;
    color: var(--section-music-player, #00ff41);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.playlist-artist {
    font-size: 10px;
    color: var(--section-music-player, #0a0);
    opacity: 0.7;
}

.playlist-toggle {
    margin-top: 10px;
}

	.playlist-toggle button {
	    font-size: 11px !important;
	    padding: 6px 12px !important;
	}

	/* Mixer styles */
	#mixerContainer {
	    margin-top: 12px;
	    border: 1px solid var(--section-music-player, #0a0);
	    border-radius: 5px;
	    background: rgba(0, 20, 0, 0.22);
	    padding: 10px;
	}

	.mixer-row {
	    display: grid;
	    grid-template-columns: 72px 1fr 52px;
	    align-items: center;
	    gap: 8px;
	    margin: 8px 0;
	}

	.mixer-row label {
	    font-size: 11px;
	    color: var(--section-music-player, #0a0);
	    opacity: 0.85;
	}

	.mixer-row input[type="range"] {
	    width: 100%;
	    accent-color: var(--section-music-player, #00ff41);
	}

	.mixer-value {
	    font-size: 11px;
	    color: var(--section-music-player, #00ff41);
	    text-align: right;
	    opacity: 0.9;
	}

	.mixer-actions {
	    display: flex;
	    justify-content: center;
	    gap: 6px;
	    margin-top: 10px;
	}

	.mixer-actions button {
	    padding: 6px 10px !important;
	    font-size: 11px !important;
	}

	.mixer-actions button.active {
	    background: var(--section-music-player, #00ff41);
	    color: black;
	}

	.mixer-toggle {
	    margin-top: 10px;
	}

	.mixer-toggle button {
	    font-size: 11px !important;
	    padding: 6px 12px !important;
	}
</style>

<div id="matrix-player">
    <div class="matrix-title">MATRIX-HUB MP3 PLAYER</div>

    <div class="player-tabs" role="tablist" aria-label="Matrix player tabs">
        <button id="matrixPlayerTabBtnMusic" class="player-tab-btn active" onclick="setMatrixPlayerTab('music')" role="tab" aria-selected="true" aria-controls="matrixPlayerTabMusic">MUSIC</button>
        <button id="matrixPlayerTabBtnLayers" class="player-tab-btn" onclick="setMatrixPlayerTab('layers')" role="tab" aria-selected="false" aria-controls="matrixPlayerTabLayers">LAYERS</button>
    </div>

    <div id="clickToPlayOverlay" style="display: none;">
        <div class="click-to-play-content">
            <span class="play-icon">‚ñ∂</span>
            <span>CLICK TO START MUSIC</span>
        </div>
    </div>

    <audio id="matrixAudio" preload="auto"></audio>
    <audio id="layersAudio" preload="auto"></audio>

    <div id="matrixPlayerTabMusic" class="matrix-player-tab">
        <div class="now-playing">
            <div class="now-playing-label">Now Playing</div>
            <div id="currentTrackTitle">Select a track</div>
            <div id="currentTrackArtist">--</div>
            <div id="trackNumber">Track 0 of 15</div>
        </div>

        <div class="player-controls">
            <button onclick="prevTrack()" title="Previous">‚èÆ</button>
            <button onclick="playMatrix()" id="playBtn" title="Play">‚ñ∂</button>
            <button onclick="pauseMatrix()" id="pauseBtn" title="Pause">‚è∏</button>
            <button onclick="nextTrack()" title="Next">‚è≠</button>
        </div>

        <div class="secondary-controls">
            <button onclick="toggleShuffle()" id="shuffleBtn" title="Shuffle">üîÄ</button>
            <button onclick="toggleLoop()" id="loopBtn" title="Loop">üîÅ</button>
            <button onclick="toggleAutoplay()" id="autoplayBtn" class="active" title="Autoplay">üîä</button>
        </div>

        <div id="playerStatus">Loop: OFF | Shuffle: OFF | Autoplay: ON</div>

        <div class="mixer-toggle">
            <button onclick="toggleMixer()">üéö MIXER</button>
        </div>
        <div id="mixerContainer" style="display: none;">
            <div class="mixer-row">
                <label for="mixerVolume">Volume</label>
                <input id="mixerVolume" type="range" min="0" max="1.5" step="0.01" value="1">
                <span class="mixer-value" id="mixerVolumeVal">100%</span>
            </div>
            <div class="mixer-row">
                <label for="mixerPan">Pan</label>
                <input id="mixerPan" type="range" min="-1" max="1" step="0.01" value="0">
                <span class="mixer-value" id="mixerPanVal">C</span>
            </div>
            <div class="mixer-row">
                <label for="mixerBass">Bass</label>
                <input id="mixerBass" type="range" min="-12" max="12" step="0.1" value="0">
                <span class="mixer-value" id="mixerBassVal">0dB</span>
            </div>
            <div class="mixer-row">
                <label for="mixerMid">Mid</label>
                <input id="mixerMid" type="range" min="-12" max="12" step="0.1" value="0">
                <span class="mixer-value" id="mixerMidVal">0dB</span>
            </div>
            <div class="mixer-row">
                <label for="mixerTreble">Treble</label>
                <input id="mixerTreble" type="range" min="-12" max="12" step="0.1" value="0">
                <span class="mixer-value" id="mixerTrebleVal">0dB</span>
            </div>
            <div class="mixer-actions">
                <button onclick="resetMixer()" title="Reset mixer">Reset</button>
                <button onclick="toggleMixerMute()" id="mixerMuteBtn" title="Mute output">Mute</button>
            </div>
        </div>

        <div class="playlist-toggle">
            <button onclick="togglePlaylist()">üìã PLAYLIST</button>
        </div>

        <div id="playlistContainer" style="display: none;"></div>
    </div>

    <div id="matrixPlayerTabLayers" class="matrix-player-tab" style="display: none;">
        <div class="layers-header">
            <div class="now-playing-label">Layers</div>
            <div class="layers-title">Sync a layer with the current track</div>
            <div class="layers-subtitle">Use ambient layers to blend cleanly with Matrix music.</div>
        </div>

        <div class="layers-panel">
            <div class="layers-row">
                <button onclick="prevLayerTrack()" title="Previous layer track">‚èÆ</button>
                <button onclick="playLayer()" id="layerPlayBtn" title="Play layer">‚ñ∂</button>
                <button onclick="pauseLayer()" id="layerPauseBtn" title="Pause layer">‚è∏</button>
                <button onclick="nextLayerTrack()" title="Next layer track">‚è≠</button>
            </div>

            <div class="layers-row layers-mix">
                <label for="layersVolume">Layer Vol</label>
                <input id="layersVolume" type="range" min="0" max="1" step="0.01" value="0.45">
                <span class="mixer-value" id="layersVolumeVal">45%</span>
            </div>

            <div class="layers-actions">
                <button onclick="syncPlayBoth()" title="Sync-start both tracks">‚è± SYNC BOTH</button>
                <button onclick="stopLayer()" title="Stop layer">‚èπ STOP LAYER</button>
            </div>

            <div id="layersNowPlaying">Layer: --</div>
        </div>

        <div class="layers-picks">
            <div class="now-playing-label">Sync Picks</div>
            <div id="layersSyncPicks" class="layers-picks-list" aria-live="polite"></div>
        </div>

        <div class="layers-picker">
            <select id="layersTrackSelect" aria-label="Layer track"></select>
            <button onclick="loadSelectedLayer()" title="Load selected layer">LOAD</button>
        </div>
    </div>
</div>

<script>
	  // Matrix MP3 Player Playlist - Royalty-Free Music from Mixkit
	  // All tracks are 100% free under the Mixkit Stock Music Free License
	  // No attribution required - free for commercial and personal use
      const matrixPlaylist = [
        { title: "Cyberpunk City", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/140/140.mp3" },
        { title: "Deep Techno Ambience", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/134/134.mp3" },
        { title: "Techno Fest Vibes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/124/124.mp3" },
        { title: "Hazy After Hours", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/132/132.mp3" },
        { title: "Minimal Techno 01", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/162/162.mp3" },
        { title: "Minimal Emotion", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/160/160.mp3" },
        { title: "Machine Drum Vibes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/117/117.mp3" },
        { title: "Dub Techno Groove", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/133/133.mp3" },
        { title: "Trance Party", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/166/166.mp3" },
        { title: "Infected Vibes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/157/157.mp3" },
        { title: "Goa Trance Mantra", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/137/137.mp3" },
        { title: "Tech House vibes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/130/130.mp3" },
        { title: "Kodama Night Town", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/114/114.mp3" },
        { title: "Digital Clouds", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/175/175.mp3" },
        { title: "Slow Rain", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/122/122.mp3" },
        { title: "Sun in Your Eyes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/131/131.mp3" },
        { title: "Better Times are Coming", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/173/173.mp3" },
        { title: "Lonerism", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/159/159.mp3" },
        { title: "B.O.R.N", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/620/620.mp3" },
        { title: "Deep Urban", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/623/623.mp3" },
        { title: "Feedback Dreams", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/588/588.mp3" },
        { title: "Fragments Of Bangkok", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/625/625.mp3" },
        { title: "Skyline", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/601/601.mp3" },
        { title: "Silent Descent", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/614/614.mp3" },
        { title: "Echoes", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/188/188.mp3" },
        { title: "Sci-Fi Game", artist: "Arulo", url: "https://assets.mixkit.co/music/395/395.mp3" },
        { title: "Sci-Fi Score", artist: "Arulo", url: "https://assets.mixkit.co/music/464/464.mp3" },
        { title: "Neon Skyline", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/626/626.mp3" },
        { title: "Digital Mirage", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/627/627.mp3" },
        { title: "Night Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/396/396.mp3" },
        { title: "Retro Future", artist: "Arulo", url: "https://assets.mixkit.co/music/397/397.mp3" },
        { title: "Dream Sequence", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/189/189.mp3" },
        { title: "Neon Runner", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/628/628.mp3" },
        { title: "Digital Skyline", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/629/629.mp3" },
        { title: "Night Vision", artist: "Arulo", url: "https://assets.mixkit.co/music/398/398.mp3" },
        { title: "Retro Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/399/399.mp3" },
        { title: "Dream Machine", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/190/190.mp3" },
        { title: "Synthwave Lights", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/630/630.mp3" },
        { title: "Electric Avenue", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/631/631.mp3" },
        { title: "Midnight Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/400/400.mp3" },
        { title: "Digital Dreamscape", artist: "Arulo", url: "https://assets.mixkit.co/music/401/401.mp3" },
        { title: "Neon Pulse", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/191/191.mp3" },
        // --- Local MP3s ---
        { title: "Cipher", artist: "Kevin MacLeod", url: "/public/music/cipher.mp3" },
        { title: "Digital Ghost", artist: "Kevin MacLeod", url: "/public/music/digital-ghost.mp3" },
        { title: "The Ambient", artist: "Ketsa", url: "/public/music/the-ambient.mp3" },
        { title: "Night Owl", artist: "Broke For Free", url: "/public/music/night-owl.mp3" },
        { title: "Dark Sci-Fi Synth", artist: "Mixkit", url: "/public/music/dark-sci-fi-synth.mp3" },
        { title: "Dreamwalker", artist: "Infraction", url: "/public/music/dreamwalker.mp3" },
        { title: "Industrial Cyberpunk", artist: "TAVAmusic", url: "/public/music/industrial-cyberpunk.mp3" },
        { title: "Rynos Theme (Sci-Fi Ambient 1)", artist: "Kevin MacLeod", url: "/public/music/sci-fi-ambient-1.mp3" },
        { title: "Floating Cities (Sci-Fi Ambient 2)", artist: "Kevin MacLeod", url: "/public/music/sci-fi-ambient-2.mp3" },
      ];

	  const matrixAudio = document.getElementById('matrixAudio');
	  // Enable CORS for Web Audio analysis (required for syncing visuals to remote MP3s)
	  matrixAudio.crossOrigin = 'anonymous';
	  const layersAudio = document.getElementById('layersAudio');
	  if (layersAudio) layersAudio.crossOrigin = 'anonymous';
	  const currentTrackTitle = document.getElementById('currentTrackTitle');
	  const currentTrackArtist = document.getElementById('currentTrackArtist');
	  const trackNumber = document.getElementById('trackNumber');
	  const playerStatus = document.getElementById('playerStatus');
	  const playlistContainer = document.getElementById('playlistContainer');
	  const shuffleBtn = document.getElementById('shuffleBtn');
	  const loopBtn = document.getElementById('loopBtn');
	  const autoplayBtn = document.getElementById('autoplayBtn');
	  const matrixPlayerTabBtnMusic = document.getElementById('matrixPlayerTabBtnMusic');
	  const matrixPlayerTabBtnLayers = document.getElementById('matrixPlayerTabBtnLayers');
	  const matrixPlayerTabMusic = document.getElementById('matrixPlayerTabMusic');
	  const matrixPlayerTabLayers = document.getElementById('matrixPlayerTabLayers');
	  const layersTrackSelect = document.getElementById('layersTrackSelect');
	  const layersVolume = document.getElementById('layersVolume');
	  const layersVolumeVal = document.getElementById('layersVolumeVal');
	  const layersNowPlaying = document.getElementById('layersNowPlaying');
	  const layersSyncPicks = document.getElementById('layersSyncPicks');

  let currentTrackIndex = 0;
  let isShuffleOn = false;
	  let isLoopOn = false; // Default off - music plays through playlist continuously
	  let playlistVisible = false;
	  let mixerVisible = false;
	  // Autoplay defaults to ON, but respect user preference from localStorage
	  let isAutoplayOn = localStorage.getItem('matrixPlayerAutoplay') !== 'false';

	  // --- Mixer (Web Audio graph is created by the Matrix rain script) ---
	  const matrixMixerStorageKey = 'matrixPlayerMixer';
	  const defaultMatrixMixer = { volume: 1, pan: 0, bass: 0, mid: 0, treble: 0, mute: false };

	  function clampMixerUiNum(v, min, max) {
	    return Math.max(min, Math.min(max, v));
	  }

	  function readMatrixMixerSettings() {
	    try {
	      const raw = localStorage.getItem(matrixMixerStorageKey);
	      const parsed = raw ? JSON.parse(raw) : {};
	      const next = { ...defaultMatrixMixer, ...parsed };
	      next.volume = clampMixerUiNum(Number(next.volume), 0, 1.5);
	      next.pan = clampMixerUiNum(Number(next.pan), -1, 1);
	      next.bass = clampMixerUiNum(Number(next.bass), -12, 12);
	      next.mid = clampMixerUiNum(Number(next.mid), -12, 12);
	      next.treble = clampMixerUiNum(Number(next.treble), -12, 12);
	      next.mute = Boolean(next.mute);
	      return next;
	    } catch {
	      return { ...defaultMatrixMixer };
	    }
	  }

	  function persistMatrixMixerSettings(settings) {
	    try {
	      localStorage.setItem(matrixMixerStorageKey, JSON.stringify(settings));
	    } catch {}
	  }

	  // Expose settings globally so the analyser/mixer graph can apply them when ready.
	  window.matrixMixerSettings = readMatrixMixerSettings();

	  function formatPanLabel(pan) {
	    const p = clampMixerUiNum(pan, -1, 1);
	    if (Math.abs(p) < 0.02) return 'C';
	    return p < 0 ? `L${Math.round(Math.abs(p) * 100)}` : `R${Math.round(p * 100)}`;
	  }

	  function applyMixerUi(settings) {
	    const vol = document.getElementById('mixerVolume');
	    const pan = document.getElementById('mixerPan');
	    const bass = document.getElementById('mixerBass');
	    const mid = document.getElementById('mixerMid');
	    const treb = document.getElementById('mixerTreble');
	    const muteBtn = document.getElementById('mixerMuteBtn');

	    if (vol) vol.value = String(settings.volume);
	    if (pan) pan.value = String(settings.pan);
	    if (bass) bass.value = String(settings.bass);
	    if (mid) mid.value = String(settings.mid);
	    if (treb) treb.value = String(settings.treble);

	    const volVal = document.getElementById('mixerVolumeVal');
	    const panVal = document.getElementById('mixerPanVal');
	    const bassVal = document.getElementById('mixerBassVal');
	    const midVal = document.getElementById('mixerMidVal');
	    const trebVal = document.getElementById('mixerTrebleVal');

	    if (volVal) volVal.textContent = `${Math.round(settings.volume * 100)}%`;
	    if (panVal) panVal.textContent = formatPanLabel(settings.pan);
	    if (bassVal) bassVal.textContent = `${settings.bass.toFixed(1).replace(/\.0$/, '')}dB`;
	    if (midVal) midVal.textContent = `${settings.mid.toFixed(1).replace(/\.0$/, '')}dB`;
	    if (trebVal) trebVal.textContent = `${settings.treble.toFixed(1).replace(/\.0$/, '')}dB`;

	    if (muteBtn) {
	      muteBtn.classList.toggle('active', settings.mute);
	      muteBtn.textContent = settings.mute ? 'Unmute' : 'Mute';
	      muteBtn.title = settings.mute ? 'Unmute output' : 'Mute output';
	    }
	  }

	  function notifyMixerGraph() {
	    if (typeof window.matrixEnsureAudioGraph === 'function') window.matrixEnsureAudioGraph();
	    if (typeof window.matrixApplyMixerSettings === 'function') window.matrixApplyMixerSettings();
	  }

	  function setMatrixMixer(partial) {
	    const next = { ...window.matrixMixerSettings, ...partial };
	    next.volume = clampMixerUiNum(Number(next.volume), 0, 1.5);
	    next.pan = clampMixerUiNum(Number(next.pan), -1, 1);
	    next.bass = clampMixerUiNum(Number(next.bass), -12, 12);
	    next.mid = clampMixerUiNum(Number(next.mid), -12, 12);
	    next.treble = clampMixerUiNum(Number(next.treble), -12, 12);
	    next.mute = Boolean(next.mute);
	    window.matrixMixerSettings = next;
	    persistMatrixMixerSettings(next);
	    applyMixerUi(next);
	    notifyMixerGraph();
	  }

	  function initMixerUi() {
	    const settings = window.matrixMixerSettings || readMatrixMixerSettings();
	    window.matrixMixerSettings = settings;
	    applyMixerUi(settings);

	    const bindRange = (id, key) => {
	      const el = document.getElementById(id);
	      if (!el) return;
	      el.addEventListener('input', () => setMatrixMixer({ [key]: parseFloat(el.value) }));
	    };
	    bindRange('mixerVolume', 'volume');
	    bindRange('mixerPan', 'pan');
	    bindRange('mixerBass', 'bass');
	    bindRange('mixerMid', 'mid');
	    bindRange('mixerTreble', 'treble');
	  }

	  // Initialize autoplay button state based on saved preference
	  if (!isAutoplayOn) {
	    autoplayBtn.classList.remove('active');
	  }

		  // --- Layers tab (secondary track that can play alongside Matrix music) ---
		  const matrixPlayerTabStorageKey = 'matrixPlayerActiveTab';
      const layersPlaylist = [
        { title: "Deep Techno Ambience", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/134/134.mp3", tags: ["ambient", "techno"] },
        { title: "Hazy After Hours", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/132/132.mp3", tags: ["ambient"] },
        { title: "Minimal Emotion", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/160/160.mp3", tags: ["minimal", "ambient"] },
        { title: "Dub Techno Groove", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/133/133.mp3", tags: ["dub", "techno"] },
        { title: "Digital Clouds", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/175/175.mp3", tags: ["ambient"] },
        { title: "Slow Rain", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/122/122.mp3", tags: ["ambient"] },
        { title: "Sun in Your Eyes", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/131/131.mp3", tags: ["ambient"] },
        { title: "Better Times are Coming", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/173/173.mp3", tags: ["ambient"] },
        { title: "Lonerism", artist: "Alejandro Maga√±a", url: "https://assets.mixkit.co/music/159/159.mp3", tags: ["minimal", "ambient"] },
        { title: "Sci-Fi Score", artist: "Arulo", url: "https://assets.mixkit.co/music/464/464.mp3", tags: ["sci-fi", "ambient"] },
        { title: "Neon Skyline", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/626/626.mp3", tags: ["ambient", "techno"] },
        { title: "Digital Mirage", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/627/627.mp3", tags: ["ambient"] },
        { title: "Night Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/396/396.mp3", tags: ["ambient"] },
        { title: "Retro Future", artist: "Arulo", url: "https://assets.mixkit.co/music/397/397.mp3", tags: ["sci-fi", "ambient"] },
        { title: "Dream Sequence", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/189/189.mp3", tags: ["ambient"] },
        { title: "Neon Runner", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/628/628.mp3", tags: ["ambient", "techno"] },
        { title: "Digital Skyline", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/629/629.mp3", tags: ["ambient"] },
        { title: "Night Vision", artist: "Arulo", url: "https://assets.mixkit.co/music/398/398.mp3", tags: ["ambient"] },
        { title: "Retro Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/399/399.mp3", tags: ["sci-fi", "ambient"] },
        { title: "Dream Machine", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/190/190.mp3", tags: ["ambient"] },
        { title: "Synthwave Lights", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/630/630.mp3", tags: ["ambient"] },
        { title: "Electric Avenue", artist: "Eugenio Mininni", url: "https://assets.mixkit.co/music/631/631.mp3", tags: ["ambient"] },
        { title: "Midnight Drive", artist: "Arulo", url: "https://assets.mixkit.co/music/400/400.mp3", tags: ["ambient"] },
        { title: "Digital Dreamscape", artist: "Arulo", url: "https://assets.mixkit.co/music/401/401.mp3", tags: ["ambient"] },
        { title: "Neon Pulse", artist: "Andrew Ev", url: "https://assets.mixkit.co/music/191/191.mp3", tags: ["ambient"] },
        // --- Local MP3s ---
        { title: "Cipher", artist: "Kevin MacLeod", url: "/public/music/cipher.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Digital Ghost", artist: "Kevin MacLeod", url: "/public/music/digital-ghost.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "The Ambient", artist: "Ketsa", url: "/public/music/the-ambient.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Night Owl", artist: "Broke For Free", url: "/public/music/night-owl.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Dark Sci-Fi Synth", artist: "Mixkit", url: "/public/music/dark-sci-fi-synth.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Dreamwalker", artist: "Infraction", url: "/public/music/dreamwalker.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Industrial Cyberpunk", artist: "TAVAmusic", url: "/public/music/industrial-cyberpunk.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Rynos Theme (Sci-Fi Ambient 1)", artist: "Kevin MacLeod", url: "/public/music/sci-fi-ambient-1.mp3", tags: ["cyberpunk", "ambient"] },
        { title: "Floating Cities (Sci-Fi Ambient 2)", artist: "Kevin MacLeod", url: "/public/music/sci-fi-ambient-2.mp3", tags: ["cyberpunk", "ambient"] },
      ];

		  let currentLayerIndex = 0;

		  function normalizePlayerTab(tab) {
		    return tab === 'layers' ? 'layers' : 'music';
		  }

		  function setMatrixPlayerTab(tab) {
		    const activeTab = normalizePlayerTab(tab);
		    if (matrixPlayerTabMusic) matrixPlayerTabMusic.style.display = activeTab === 'music' ? 'block' : 'none';
		    if (matrixPlayerTabLayers) matrixPlayerTabLayers.style.display = activeTab === 'layers' ? 'block' : 'none';
		    if (matrixPlayerTabBtnMusic) {
		      matrixPlayerTabBtnMusic.classList.toggle('active', activeTab === 'music');
		      matrixPlayerTabBtnMusic.setAttribute('aria-selected', activeTab === 'music' ? 'true' : 'false');
		    }
		    if (matrixPlayerTabBtnLayers) {
		      matrixPlayerTabBtnLayers.classList.toggle('active', activeTab === 'layers');
		      matrixPlayerTabBtnLayers.setAttribute('aria-selected', activeTab === 'layers' ? 'true' : 'false');
		    }
		    try { localStorage.setItem(matrixPlayerTabStorageKey, activeTab); } catch {}
		  }

		  function updateLayerNowPlaying() {
		    if (!layersNowPlaying) return;
		    const t = layersPlaylist[currentLayerIndex];
		    layersNowPlaying.textContent = t ? `Layer: ${t.title} ‚Äî ${t.artist}` : 'Layer: --';
		  }

		  function loadLayerTrack(index) {
		    if (!layersAudio) return;
		    if (index < 0 || index >= layersPlaylist.length) return;
		    currentLayerIndex = index;
		    const t = layersPlaylist[index];
		    layersAudio.src = t.url;
		    layersAudio.load();
		    if (layersTrackSelect) layersTrackSelect.value = String(index);
		    updateLayerNowPlaying();
		  }

		  function playLayer() {
		    if (!layersAudio) return;
		    if (!layersAudio.src || layersAudio.src === window.location.href) loadLayerTrack(0);
		    layersAudio.play().catch(() => {});
		  }

		  function pauseLayer() {
		    if (!layersAudio) return;
		    layersAudio.pause();
		  }

		  function stopLayer() {
		    if (!layersAudio) return;
		    layersAudio.pause();
		    try { layersAudio.currentTime = 0; } catch {}
		  }

		  function nextLayerTrack() {
		    const nextIndex = (currentLayerIndex + 1) % layersPlaylist.length;
		    loadLayerTrack(nextIndex);
		    playLayer();
		  }

		  function prevLayerTrack() {
		    const prevIndex = (currentLayerIndex - 1 + layersPlaylist.length) % layersPlaylist.length;
		    loadLayerTrack(prevIndex);
		    playLayer();
		  }

		  function waitForCanPlay(el) {
		    return new Promise((resolve) => {
		      if (!el) return resolve();
		      if (el.readyState >= 3) return resolve();
		      const done = () => resolve();
		      el.addEventListener('canplay', done, { once: true });
		      el.addEventListener('canplaythrough', done, { once: true });
		      el.addEventListener('loadeddata', done, { once: true });
		    });
		  }

		  async function syncPlayBoth() {
		    if (!matrixAudio || !layersAudio) return;
		    try { matrixAudio.pause(); } catch {}
		    try { layersAudio.pause(); } catch {}
		    try { matrixAudio.currentTime = 0; } catch {}
		    try { layersAudio.currentTime = 0; } catch {}
		    if (!matrixAudio.src || matrixAudio.src === window.location.href) loadTrack(currentTrackIndex || 0);
		    if (!layersAudio.src || layersAudio.src === window.location.href) loadLayerTrack(currentLayerIndex || 0);
		    await Promise.all([waitForCanPlay(matrixAudio), waitForCanPlay(layersAudio)]);
		    matrixAudio.play().catch(() => {});
		    layersAudio.play().catch(() => {});
		  }

		  function tagsFromTitle(title) {
		    const t = String(title || '').toLowerCase();
		    const tags = new Set();
		    if (/\btrance\b/.test(t)) tags.add('trance');
		    if (/\btechno\b/.test(t)) tags.add('techno');
		    if (/\bdub\b/.test(t)) tags.add('dub');
		    if (/\bhouse\b/.test(t)) tags.add('house');
		    if (/\bdrum\b/.test(t)) tags.add('drum');
		    if (/\bambient|ambience|hazy|clouds|rain|emotion|dreams|echoes\b/.test(t)) tags.add('ambient');
		    if (/\bminimal\b/.test(t)) tags.add('minimal');
		    if (/\bsci-?fi\b/.test(t)) tags.add('sci-fi');
		    return Array.from(tags);
		  }

		  function scoreLayerForMain(main, layer) {
		    const mainTags = new Set(tagsFromTitle(main?.title));
		    const layerTags = new Set([...(layer?.tags || []), ...tagsFromTitle(layer?.title)]);
		    let score = 0;
		    if (layerTags.has('ambient')) score += 3;
		    for (const tag of layerTags) {
		      if (mainTags.has(tag)) score += 4;
		    }
		    return score;
		  }

		  function getLayerSyncPicks(main) {
		    return layersPlaylist
		      .map((layer, index) => ({ index, layer, score: scoreLayerForMain(main, layer) }))
		      .sort((a, b) => b.score - a.score || a.index - b.index)
		      .slice(0, 5);
		  }

		  function renderLayerSyncPicks() {
		    if (!layersSyncPicks) return;
		    const main = matrixPlaylist?.[currentTrackIndex] ?? null;
		    const picks = getLayerSyncPicks(main);
		    layersSyncPicks.innerHTML = picks
		      .map((p) => `<button onclick="loadLayerTrack(${p.index})" title="Load this layer">${p.layer.title} ‚Äî ${p.layer.artist}</button>`)
		      .join('');
		  }

		  function renderLayersTrackSelect() {
		    if (!layersTrackSelect) return;
		    layersTrackSelect.innerHTML = layersPlaylist
		      .map((t, i) => `<option value="${i}">${t.title} ‚Äî ${t.artist}</option>`)
		      .join('');
		    layersTrackSelect.value = String(currentLayerIndex);
		  }

		  function loadSelectedLayer() {
		    if (!layersTrackSelect) return;
		    const idx = Number(layersTrackSelect.value);
		    if (!Number.isFinite(idx)) return;
		    loadLayerTrack(idx);
		  }

		  if (layersAudio) {
		    layersAudio.addEventListener('ended', () => nextLayerTrack());
		  }

		  if (layersVolume && layersAudio && layersVolumeVal) {
		    const applyLayerVol = () => {
		      const vol = Math.max(0, Math.min(1, Number(layersVolume.value)));
		      layersAudio.volume = vol;
		      layersVolumeVal.textContent = `${Math.round(vol * 100)}%`;
		    };
		    layersVolume.addEventListener('input', applyLayerVol);
		    applyLayerVol();
		  }

		  // Initialize tab + layers UI
		  renderLayersTrackSelect();
		  loadLayerTrack(0);
		  renderLayerSyncPicks();
		  try {
		    const rememberedTab = localStorage.getItem(matrixPlayerTabStorageKey);
		    if (rememberedTab === 'layers' || rememberedTab === 'music') setMatrixPlayerTab(rememberedTab);
		  } catch {}

  // Initialize playlist UI
  function initPlaylist() {
    playlistContainer.innerHTML = matrixPlaylist.map((track, index) => `
      <div class="playlist-item ${index === 0 ? 'active' : ''}" onclick="playTrack(${index})">
        <span class="playlist-num">${index + 1}</span>
        <div class="playlist-info">
          <div class="playlist-title">${track.title}</div>
          <div class="playlist-artist">${track.artist}</div>
        </div>
      </div>
    `).join('');
  }

  function loadTrack(index) {
    if (index < 0 || index >= matrixPlaylist.length) return;

    currentTrackIndex = index;
    const track = matrixPlaylist[index];

    matrixAudio.src = track.url;
    matrixAudio.load(); // Ensure audio element loads the new source
	    currentTrackTitle.textContent = track.title;
	    currentTrackArtist.textContent = track.artist;
	    trackNumber.textContent = `Track ${index + 1} of ${matrixPlaylist.length}`;
	    renderLayerSyncPicks();

    // Update playlist UI
    document.querySelectorAll('.playlist-item').forEach((item, i) => {
      item.classList.toggle('active', i === index);
    });

    // Scroll to active item in playlist
    const activeItem = playlistContainer.querySelector('.playlist-item.active');
    if (activeItem && playlistVisible) {
      activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  }

  function playTrack(index) {
    loadTrack(index);
    // Wait for the audio to be ready before playing
    matrixAudio.addEventListener('canplay', function playOnReady() {
      matrixAudio.play().catch(e => console.log('Playback error:', e));
      matrixAudio.removeEventListener('canplay', playOnReady);
    }, { once: true });
    // Also attempt immediate play in case audio is already loaded
    matrixAudio.play().catch(e => console.log('Playback error:', e));
  }

  function playMatrix() {
    if (!matrixAudio.src || matrixAudio.src === window.location.href) {
      loadTrack(0);
    }
    matrixAudio.play().catch(e => console.log('Playback error:', e));
  }

  function pauseMatrix() {
    matrixAudio.pause();
  }

  function nextTrack() {
    let nextIndex;
    if (isShuffleOn) {
      nextIndex = Math.floor(Math.random() * matrixPlaylist.length);
    } else {
      nextIndex = (currentTrackIndex + 1) % matrixPlaylist.length;
    }
    playTrack(nextIndex);
  }

  function prevTrack() {
    let prevIndex;
    if (isShuffleOn) {
      prevIndex = Math.floor(Math.random() * matrixPlaylist.length);
    } else {
      prevIndex = (currentTrackIndex - 1 + matrixPlaylist.length) % matrixPlaylist.length;
    }
    playTrack(prevIndex);
  }

  function toggleLoop() {
    isLoopOn = !isLoopOn;
    loopBtn.classList.toggle('active', isLoopOn);
    updateStatus();
  }

  function toggleShuffle() {
    isShuffleOn = !isShuffleOn;
    shuffleBtn.classList.toggle('active', isShuffleOn);
    updateStatus();
  }

  function toggleAutoplay() {
    isAutoplayOn = !isAutoplayOn;
    autoplayBtn.classList.toggle('active', isAutoplayOn);
    // Save user preference to localStorage
    localStorage.setItem('matrixPlayerAutoplay', isAutoplayOn ? 'true' : 'false');
    updateStatus();

    // If autoplay is turned on and music isn't playing, start it
    if (isAutoplayOn && matrixAudio.paused) {
      matrixAudio.play().catch(e => console.log('Playback error:', e));
    }
  }

	  function togglePlaylist() {
	    playlistVisible = !playlistVisible;
	    playlistContainer.style.display = playlistVisible ? 'block' : 'none';
	  }

	  function toggleMixer() {
	    mixerVisible = !mixerVisible;
	    const mixerContainer = document.getElementById('mixerContainer');
	    if (mixerContainer) mixerContainer.style.display = mixerVisible ? 'block' : 'none';
	  }

	  function resetMixer() {
	    setMatrixMixer({ ...defaultMatrixMixer });
	  }

	  function toggleMixerMute() {
	    setMatrixMixer({ mute: !window.matrixMixerSettings?.mute });
	  }

	  function updateStatus() {
	    playerStatus.textContent = `Loop: ${isLoopOn ? 'ON' : 'OFF'} | Shuffle: ${isShuffleOn ? 'ON' : 'OFF'} | Autoplay: ${isAutoplayOn ? 'ON' : 'OFF'}`;
	  }

  // Handle track ending
  matrixAudio.addEventListener('ended', () => {
    if (isLoopOn) {
      matrixAudio.currentTime = 0;
      matrixAudio.play();
    } else {
      nextTrack();
    }
  });

  // Get overlay element
  const clickToPlayOverlay = document.getElementById('clickToPlayOverlay');

  // Function to hide overlay and start music
  function startMusicAndHideOverlay() {
    if (clickToPlayOverlay) {
      clickToPlayOverlay.style.display = 'none';
    }
    if (isAutoplayOn && matrixAudio.paused) {
      if (matrixAudio.readyState >= 2) {
        matrixAudio.play().catch(err => console.log('Playback error:', err));
      } else {
        matrixAudio.addEventListener('canplay', function() {
          if (isAutoplayOn) {
            matrixAudio.play().catch(err => console.log('Playback error:', err));
          }
        }, { once: true });
      }
    }
  }

  // Add click listener to overlay
  if (clickToPlayOverlay) {
    clickToPlayOverlay.addEventListener('click', startMusicAndHideOverlay);
  }

  // Initialize with random track autoplay
	  initPlaylist();
	  initMixerUi();
	  updateStatus(); // Initialize status display with current settings

  // Select a random track on page load
  const randomStartIndex = Math.floor(Math.random() * matrixPlaylist.length);
  loadTrack(randomStartIndex);

  // Auto-play the random track when user enters the site
  // Using user interaction detection to comply with browser autoplay policies
  function attemptAutoplay() {
    // Only attempt autoplay if user hasn't disabled it
    if (!isAutoplayOn) {
      console.log('Matrix MP3 Player: Autoplay is disabled by user preference');
      if (clickToPlayOverlay) {
        clickToPlayOverlay.style.display = 'none';
      }
      return;
    }

    // Wait for audio to be ready before attempting playback
    function tryPlay() {
      matrixAudio.play().then(() => {
        console.log('Matrix MP3 Player: Autoplay started with "' + matrixPlaylist[randomStartIndex].title + '"');
        // Hide overlay on successful autoplay
        if (clickToPlayOverlay) {
          clickToPlayOverlay.style.display = 'none';
        }
      }).catch(e => {
        console.log('Autoplay blocked by browser. Click the player to start music.');
        // Show the click-to-play overlay
        if (clickToPlayOverlay) {
          clickToPlayOverlay.style.display = 'flex';
        }
        // Also add document-wide click listener as fallback
        document.addEventListener('click', function startOnInteraction(event) {
          // Don't trigger if clicking on player controls (let them handle it)
          if (event.target.closest('#matrix-player button') && !event.target.closest('#clickToPlayOverlay')) {
            return;
          }
          startMusicAndHideOverlay();
          document.removeEventListener('click', startOnInteraction);
        }, { once: true });
      });
    }

    // Check if audio is ready, if not wait for it
    if (matrixAudio.readyState >= 2) {
      tryPlay();
    } else {
      matrixAudio.addEventListener('canplay', tryPlay, { once: true });
    }
  }

  // Attempt autoplay when page loads
  if (document.readyState === 'complete') {
    attemptAutoplay();
  } else {
    window.addEventListener('load', attemptAutoplay);
  }
</script>

<!-- Matrix Rain Background -->
<canvas id="matrix-canvas"></canvas>

<h1>THE MATRIX HUB</h1>

<!-- Theme Customizer Panel -->
<div class="container">
  <div class="panel theme-customizer-panel">
    <h2 style="text-align: center; margin-bottom: 15px;">THEME CUSTOMIZER</h2>
    <p class="theme-subtitle">Choose your reality - customize your experience</p>

    <div class="current-theme-display">
      <span class="theme-label">Active Theme:</span>
      <span id="current-theme-name">Classic Matrix</span>
    </div>

    <div class="theme-presets">
      <div class="theme-preset active" data-theme="classic" onclick="setTheme('classic')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #000 0%, #001a00 100%); border-color: #00ff00;">
          <div class="preview-glow" style="background: #00ff00;"></div>
        </div>
        <span class="theme-preset-name">Classic Matrix</span>
      </div>

      <div class="theme-preset" data-theme="cyber-purple" onclick="setTheme('cyber-purple')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0a000f 0%, #1e0030 100%); border-color: #bf00ff;">
          <div class="preview-glow" style="background: #bf00ff;"></div>
        </div>
        <span class="theme-preset-name">Cyber Purple</span>
      </div>

      <div class="theme-preset" data-theme="neon-blue" onclick="setTheme('neon-blue')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #000a14 0%, #001e3c 100%); border-color: #00bfff;">
          <div class="preview-glow" style="background: #00bfff;"></div>
        </div>
        <span class="theme-preset-name">Neon Blue</span>
      </div>

      <div class="theme-preset" data-theme="blood-red" onclick="setTheme('blood-red')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0f0000 0%, #300010 100%); border-color: #ff0040;">
          <div class="preview-glow" style="background: #ff0040;"></div>
        </div>
        <span class="theme-preset-name">Blood Red</span>
      </div>

      <div class="theme-preset" data-theme="gold-elite" onclick="setTheme('gold-elite')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0800 0%, #1e1900 100%); border-color: #ffd700;">
          <div class="preview-glow" style="background: #ffd700;"></div>
        </div>
        <span class="theme-preset-name">Gold Elite</span>
      </div>

      <div class="theme-preset" data-theme="toxic-orange" onclick="setTheme('toxic-orange')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0f0800 0%, #301500 100%); border-color: #ff6600;">
          <div class="preview-glow" style="background: #ff6600;"></div>
        </div>
        <span class="theme-preset-name">Toxic Orange</span>
      </div>

      <div class="theme-preset" data-theme="arctic-white" onclick="setTheme('arctic-white')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); border-color: #ffffff;">
          <div class="preview-glow" style="background: #ffffff;"></div>
        </div>
        <span class="theme-preset-name">Arctic White</span>
      </div>

      <div class="theme-preset" data-theme="synthwave" onclick="setTheme('synthwave')">
        <div class="theme-preview" style="background: linear-gradient(135deg, #0d0221 0%, #190532 100%); border-color: #ff00ff;">
          <div class="preview-glow" style="background: linear-gradient(45deg, #ff00ff, #00ffff);"></div>
        </div>
        <span class="theme-preset-name">Synthwave</span>
      </div>
    </div>

    <div class="custom-color-section">
      <h3 style="text-align: center; margin: 20px 0 15px; font-size: 1rem;">CUSTOM COLOR</h3>
      <div class="custom-color-controls">
        <div class="color-picker-wrapper">
          <label for="custom-primary">Primary:</label>
          <input type="color" id="custom-primary" value="#00ff00" onchange="applyCustomColor()">
        </div>
        <div class="color-picker-wrapper">
          <label for="custom-secondary">Secondary:</label>
          <input type="color" id="custom-secondary" value="#00ffff" onchange="applyCustomColor()">
        </div>
        <button class="btn custom-apply-btn" onclick="applyCustomColor()">APPLY CUSTOM</button>
      </div>
    </div>

    <!-- Section-specific Color Controls -->
    <div class="section-colors-area">
      <h3 style="text-align: center; margin: 20px 0 15px; font-size: 1rem;">SECTION COLORS</h3>
      <p class="section-colors-subtitle">Customize each section individually</p>

      <div class="section-color-grid">
        <div class="section-color-item">
          <label for="color-music-player">Music Player:</label>
          <input type="color" id="color-music-player" value="#00ff41" onchange="applySectionColor('music-player', this.value)">
        </div>
        <div class="section-color-item">
          <label for="color-deal-scanner">Deal Scanner:</label>
          <input type="color" id="color-deal-scanner" value="#00ff00" onchange="applySectionColor('deal-scanner', this.value)">
        </div>
        <div class="section-color-item">
          <label for="color-daily-drops">Daily Drops:</label>
          <input type="color" id="color-daily-drops" value="#00ff00" onchange="applySectionColor('daily-drops', this.value)">
        </div>
        <div class="section-color-item">
          <label for="color-art-generator">Art Generator:</label>
          <input type="color" id="color-art-generator" value="#00ff00" onchange="applySectionColor('art-generator', this.value)">
        </div>
        <div class="section-color-item">
          <label for="color-video-generator">Video Generator:</label>
          <input type="color" id="color-video-generator" value="#00ff00" onchange="applySectionColor('video-generator', this.value)">
        </div>
        <div class="section-color-item">
          <label for="color-bot-widget">Bot Widget:</label>
          <input type="color" id="color-bot-widget" value="#00ff9c" onchange="applySectionColor('bot-widget', this.value)">
        </div>
      </div>

      <div class="section-color-actions">
        <button class="btn section-sync-btn" onclick="syncAllSectionColors()">SYNC ALL TO PRIMARY</button>
      </div>
    </div>

    <div class="theme-actions">
      <button class="btn reset-theme-btn" onclick="resetTheme()">RESET TO DEFAULT</button>
    </div>
  </div>
</div>

<style>
  .theme-customizer-panel {
    background: var(--theme-bg-panel) !important;
    border: 2px solid var(--theme-border);
    position: relative;
    overflow: hidden;
  }

  .theme-customizer-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--theme-primary), var(--theme-secondary), var(--theme-primary), transparent);
    animation: themeScan 4s linear infinite;
  }

  @keyframes themeScan {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  .theme-subtitle {
    text-align: center;
    color: var(--theme-text);
    font-size: 0.9rem;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
    opacity: 0.8;
  }

  .current-theme-display {
    text-align: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.16);
    border: 1px solid var(--theme-border);
    border-radius: 5px;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
  }

  .theme-label {
    color: var(--theme-text);
    opacity: 0.7;
    font-size: 0.85rem;
  }

  #current-theme-name {
    color: var(--theme-primary);
    font-weight: bold;
    margin-left: 10px;
    text-shadow: 0 0 10px var(--theme-glow);
  }

  .theme-presets {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .theme-preset {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid transparent;
  }

  .theme-preset:hover {
    transform: translateY(-3px);
  }

  .theme-preset.active {
    border-color: var(--theme-primary);
    background: rgba(255, 255, 255, 0.05);
  }

  .theme-preview {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 3px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .theme-preset:hover .theme-preview {
    box-shadow: 0 0 20px currentColor;
    transform: scale(1.1);
  }

  .preview-glow {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    animation: previewPulse 2s infinite;
  }

  @keyframes previewPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  .theme-preset-name {
    margin-top: 8px;
    font-size: 0.75rem;
    color: var(--theme-text);
    font-family: 'Courier New', monospace;
    text-align: center;
  }

  .custom-color-section {
    border-top: 1px solid var(--theme-border);
    padding-top: 15px;
  }

  .custom-color-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
  }

  .color-picker-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .color-picker-wrapper label {
    color: var(--theme-text);
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
  }

  .color-picker-wrapper input[type="color"] {
    width: 50px;
    height: 35px;
    border: 2px solid var(--theme-border);
    border-radius: 5px;
    cursor: pointer;
    background: var(--theme-bg-dark);
    padding: 2px;
  }

  .color-picker-wrapper input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  .color-picker-wrapper input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 3px;
  }

  .custom-apply-btn {
    width: auto !important;
    padding: 10px 20px !important;
    font-size: 0.85rem;
  }

  /* Section Colors Area Styles */
  .section-colors-area {
    border-top: 1px solid var(--theme-border);
    padding-top: 15px;
    margin-top: 15px;
  }

  .section-colors-subtitle {
    text-align: center;
    color: var(--theme-text);
    font-size: 0.8rem;
    margin-bottom: 15px;
    font-family: 'Courier New', monospace;
    opacity: 0.7;
  }

  .section-color-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 15px;
  }

  .section-color-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0, 0, 0, 0.16);
    padding: 10px 12px;
    border-radius: 5px;
    border: 1px solid var(--theme-border);
    transition: all 0.3s ease;
  }

  .section-color-item:hover {
    border-color: var(--theme-primary);
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
  }

  .section-color-item label {
    color: var(--theme-text);
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    white-space: nowrap;
  }

  .section-color-item input[type="color"] {
    width: 40px;
    height: 30px;
    border: 2px solid var(--theme-border);
    border-radius: 4px;
    cursor: pointer;
    background: var(--theme-bg-dark);
    padding: 2px;
  }

  .section-color-item input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  .section-color-item input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 2px;
  }

  .section-color-actions {
    text-align: center;
    margin-top: 10px;
  }

  .section-sync-btn {
    width: auto !important;
    padding: 8px 16px !important;
    font-size: 0.8rem;
    background: rgba(0, 255, 0, 0.1) !important;
  }

  .section-sync-btn:hover {
    background: rgba(0, 255, 0, 0.2) !important;
  }

  .theme-actions {
    margin-top: 15px;
    text-align: center;
  }

  .reset-theme-btn {
    width: auto !important;
    padding: 8px 16px !important;
    font-size: 0.8rem;
    background: transparent !important;
    border-style: dashed !important;
  }
</style>

<script>
  // Theme Management System
  const themeNames = {
    'classic': 'Classic Matrix',
    'cyber-purple': 'Cyber Purple',
    'neon-blue': 'Neon Blue',
    'blood-red': 'Blood Red',
    'gold-elite': 'Gold Elite',
    'toxic-orange': 'Toxic Orange',
    'arctic-white': 'Arctic White',
    'synthwave': 'Synthwave',
    'custom': 'Custom Theme'
  };

  const themeColors = {
    'classic': '#00ff00',
    'cyber-purple': '#bf00ff',
    'neon-blue': '#00bfff',
    'blood-red': '#ff0040',
    'gold-elite': '#ffd700',
    'toxic-orange': '#ff6600',
    'arctic-white': '#ffffff',
    'synthwave': '#ff00ff'
  };

  // Default section colors for each theme
  const themeSectionColors = {
    'classic': {
      'music-player': '#00ff41',
      'deal-scanner': '#00ff00',
      'daily-drops': '#00ff00',
      'art-generator': '#00ff00',
      'video-generator': '#00ff00',
      'bot-widget': '#00ff9c'
    },
    'cyber-purple': {
      'music-player': '#bf00ff',
      'deal-scanner': '#bf00ff',
      'daily-drops': '#bf00ff',
      'art-generator': '#bf00ff',
      'video-generator': '#bf00ff',
      'bot-widget': '#bf00ff'
    },
    'neon-blue': {
      'music-player': '#00bfff',
      'deal-scanner': '#00bfff',
      'daily-drops': '#00bfff',
      'art-generator': '#00bfff',
      'video-generator': '#00bfff',
      'bot-widget': '#00bfff'
    },
    'blood-red': {
      'music-player': '#ff0040',
      'deal-scanner': '#ff0040',
      'daily-drops': '#ff0040',
      'art-generator': '#ff0040',
      'video-generator': '#ff0040',
      'bot-widget': '#ff0040'
    },
    'gold-elite': {
      'music-player': '#ffd700',
      'deal-scanner': '#ffd700',
      'daily-drops': '#ffd700',
      'art-generator': '#ffd700',
      'video-generator': '#ffd700',
      'bot-widget': '#ffd700'
    },
    'toxic-orange': {
      'music-player': '#ff6600',
      'deal-scanner': '#ff6600',
      'daily-drops': '#ff6600',
      'art-generator': '#ff6600',
      'video-generator': '#ff6600',
      'bot-widget': '#ff6600'
    },
    'arctic-white': {
      'music-player': '#ffffff',
      'deal-scanner': '#ffffff',
      'daily-drops': '#ffffff',
      'art-generator': '#ffffff',
      'video-generator': '#ffffff',
      'bot-widget': '#ffffff'
    },
    'synthwave': {
      'music-player': '#ff00ff',
      'deal-scanner': '#ff00ff',
      'daily-drops': '#ff00ff',
      'art-generator': '#ff00ff',
      'video-generator': '#ff00ff',
      'bot-widget': '#ff00ff'
    }
  };

  let currentTheme = 'classic';

  // Section color management
  function applySectionColor(section, color) {
    document.documentElement.style.setProperty(`--section-${section}`, color);

    // Save to localStorage
    const savedSectionColors = JSON.parse(localStorage.getItem('matrixHubSectionColors') || '{}');
    savedSectionColors[section] = color;
    localStorage.setItem('matrixHubSectionColors', JSON.stringify(savedSectionColors));
  }

  function syncAllSectionColors() {
    const primary = document.getElementById('custom-primary').value || getComputedStyle(document.documentElement).getPropertyValue('--theme-primary').trim() || '#00ff00';

    const sections = ['music-player', 'deal-scanner', 'daily-drops', 'art-generator', 'video-generator', 'bot-widget'];
    sections.forEach(section => {
      document.documentElement.style.setProperty(`--section-${section}`, primary);
      const colorInput = document.getElementById(`color-${section}`);
      if (colorInput) colorInput.value = primary;
    });

    // Save all section colors
    const sectionColors = {};
    sections.forEach(section => {
      sectionColors[section] = primary;
    });
    localStorage.setItem('matrixHubSectionColors', JSON.stringify(sectionColors));
  }

  function updateSectionColorInputs(themeName) {
    const sectionColors = themeSectionColors[themeName] || themeSectionColors['classic'];

    Object.keys(sectionColors).forEach(section => {
      const colorInput = document.getElementById(`color-${section}`);
      if (colorInput) {
        colorInput.value = sectionColors[section];
      }
      document.documentElement.style.setProperty(`--section-${section}`, sectionColors[section]);
    });
  }

  function loadSavedSectionColors() {
    const savedSectionColors = JSON.parse(localStorage.getItem('matrixHubSectionColors') || '{}');

    Object.keys(savedSectionColors).forEach(section => {
      const color = savedSectionColors[section];
      const colorInput = document.getElementById(`color-${section}`);
      if (colorInput) colorInput.value = color;
      document.documentElement.style.setProperty(`--section-${section}`, color);
    });
  }

	  function setTheme(themeName) {
	    const themeTarget = document.documentElement;

	    // Remove all theme classes
	    themeTarget.classList.remove(
	      'theme-classic', 'theme-cyber-purple', 'theme-neon-blue',
	      'theme-blood-red', 'theme-gold-elite', 'theme-toxic-orange',
	      'theme-arctic-white', 'theme-synthwave'
	    );

	    // Clear any inline custom theme overrides so presets apply correctly
	    [
	      '--theme-primary',
	      '--theme-secondary',
	      '--theme-glow',
	      '--theme-border',
	      '--theme-text'
	    ].forEach((prop) => themeTarget.style.removeProperty(prop));

	    // Add new theme class
	    themeTarget.classList.add(`theme-${themeName}`);
	    currentTheme = themeName;

    // Update active state on presets
    document.querySelectorAll('.theme-preset').forEach(preset => {
      preset.classList.remove('active');
      if (preset.dataset.theme === themeName) {
        preset.classList.add('active');
      }
    });

    // Update display name
    document.getElementById('current-theme-name').textContent = themeNames[themeName];

    // Save to localStorage
    localStorage.setItem('matrixHubTheme', themeName);

    // Update section color inputs to match theme
    updateSectionColorInputs(themeName);

    // Clear saved section colors when changing themes
    localStorage.removeItem('matrixHubSectionColors');

    // Update matrix rain color
    updateMatrixRainColor(themeColors[themeName] || '#00ff00');
  }

	  function applyCustomColor() {
	    const themeTarget = document.documentElement;
	    const primary = document.getElementById('custom-primary').value;
	    const secondary = document.getElementById('custom-secondary').value;

	    // Custom theme should not be constrained by a preset theme class
	    themeTarget.classList.remove(
	      'theme-classic', 'theme-cyber-purple', 'theme-neon-blue',
	      'theme-blood-red', 'theme-gold-elite', 'theme-toxic-orange',
	      'theme-arctic-white', 'theme-synthwave'
	    );

	    // Apply custom colors via CSS variables
	    themeTarget.style.setProperty('--theme-primary', primary);
	    themeTarget.style.setProperty('--theme-secondary', secondary);
	    themeTarget.style.setProperty('--theme-glow', primary);
	    themeTarget.style.setProperty('--theme-border', primary);
	    themeTarget.style.setProperty('--theme-text', secondary);

    // Update active state
    document.querySelectorAll('.theme-preset').forEach(preset => {
      preset.classList.remove('active');
    });

    // Update display name
    document.getElementById('current-theme-name').textContent = 'Custom Theme';
    currentTheme = 'custom';

    // Save custom colors
    localStorage.setItem('matrixHubTheme', 'custom');
    localStorage.setItem('matrixHubCustomPrimary', primary);
    localStorage.setItem('matrixHubCustomSecondary', secondary);

    // Update matrix rain color
    updateMatrixRainColor(primary);
  }

  function resetTheme() {
    setTheme('classic');
    document.getElementById('custom-primary').value = '#00ff00';
    document.getElementById('custom-secondary').value = '#00ffff';

    // Clear custom colors from CSS
    document.documentElement.style.removeProperty('--theme-primary');
    document.documentElement.style.removeProperty('--theme-secondary');
    document.documentElement.style.removeProperty('--theme-glow');
    document.documentElement.style.removeProperty('--theme-border');
    document.documentElement.style.removeProperty('--theme-text');

    // Reset section colors
    const sections = ['music-player', 'deal-scanner', 'daily-drops', 'art-generator', 'video-generator', 'bot-widget'];
    sections.forEach(section => {
      document.documentElement.style.removeProperty(`--section-${section}`);
    });

    localStorage.removeItem('matrixHubCustomPrimary');
    localStorage.removeItem('matrixHubCustomSecondary');
    localStorage.removeItem('matrixHubSectionColors');

    // Reset color pickers to default
    updateSectionColorInputs('classic');
  }

  function updateMatrixRainColor(color) {
    // This will be used by the matrix rain canvas
    window.matrixRainColor = color;
  }

  // Load saved theme on page load
  function loadSavedTheme() {
    const savedTheme = localStorage.getItem('matrixHubTheme');

    if (savedTheme === 'custom') {
      const primary = localStorage.getItem('matrixHubCustomPrimary') || '#00ff00';
      const secondary = localStorage.getItem('matrixHubCustomSecondary') || '#00ffff';

      document.getElementById('custom-primary').value = primary;
      document.getElementById('custom-secondary').value = secondary;

      applyCustomColor();
    } else if (savedTheme && themeNames[savedTheme]) {
      setTheme(savedTheme);
    }

    // Load saved section colors (these override theme defaults)
    loadSavedSectionColors();
  }

  // Initialize theme on DOM load
  document.addEventListener('DOMContentLoaded', loadSavedTheme);
</script>

<!-- Matrix Gaming Section -->
<div class="container">
  <div class="panel matrix-gaming-panel">
    <h2 style="text-align: center; margin-bottom: 15px;">üéÆ MATRIX GAMING TERMINAL üéÆ</h2>
    <p style="text-align: center; color: var(--theme-text); margin-bottom: 20px; opacity: 0.8;">
      Enter the digital realm - 7 Matrix-themed games to test your skills
    </p>
    
    <div class="game-tabs">
      <div class="tab-buttons">
        <button class="tab-btn active" data-game="matrix-rain">
          üåßÔ∏è Digital Rain
        </button>
        <button class="tab-btn" data-game="hacking-simulator">
          üíª Hacking Simulator
        </button>
        <button class="tab-btn" data-game="bullet-dodge">
          üéØ Bullet Time
        </button>
        <button class="tab-btn" data-game="memory-game">
          üß© Memory Protocol
        </button>
        <button class="tab-btn" data-game="code-breaker">
          ‚å®Ô∏è Code Breaker
        </button>
        <button class="tab-btn" data-game="cyber-snake">
          üêç Cyber Snake
        </button>
        <button class="tab-btn" data-game="neos-training">
          ‚ö° Neo's Training
        </button>
      </div>

      <div class="game-container">
        <div class="game-frame active" data-game="matrix-rain">
          <iframe 
            src="/games/matrix-rain/" 
            title="Matrix Digital Rain"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="hacking-simulator">
          <iframe 
            src="/games/hacking-simulator/" 
            title="Matrix Hacking Simulator"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="bullet-dodge">
          <iframe 
            src="/games/bullet-dodge/" 
            title="Matrix Bullet Dodge"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="memory-game">
          <iframe 
            src="/games/memory-game/" 
            title="Matrix Memory Game"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="code-breaker">
          <iframe 
            src="/games/code-breaker/" 
            title="Matrix Code Breaker"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="cyber-snake">
          <iframe 
            src="/games/cyber-snake/" 
            title="Cyber Snake"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
        <div class="game-frame" data-game="neos-training">
          <iframe 
            src="/games/neos-training/" 
            title="Neo's Training"
            class="game-iframe"
            loading="lazy"
          ></iframe>
        </div>
      </div>

      <div class="game-info">
        <p style="text-align: center; color: var(--theme-text); opacity: 0.6; font-size: 0.85rem; margin-top: 10px;">
          All games optimized for desktop & mobile ‚Ä¢ Swipe/Touch enabled
        </p>
        <button id="show-leaderboards-btn" style="margin: 15px auto; display: block; padding: 10px 20px; background: #000; border: 2px solid var(--theme-primary); color: var(--theme-primary); cursor: pointer; font-family: 'Courier New', monospace; border-radius: 5px;">
          üìä VIEW LEADERBOARDS
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Leaderboards Modal -->
<div id="leaderboards-modal" class="matrix-game-modal" style="display: none;">
  <div class="matrix-game-modal-content">
    <button class="modal-close-btn" id="close-leaderboards">√ó</button>
    <h2 style="text-align: center; color: var(--theme-primary); margin-bottom: 20px;">üèÜ MATRIX LEADERBOARDS üèÜ</h2>
    
    <div class="leaderboard-tabs">
      <button class="lb-tab active" data-game="bullet-dodge">üéØ Bullet Time</button>
      <button class="lb-tab" data-game="memory-game">üß© Memory</button>
      <button class="lb-tab" data-game="cyber-snake">üêç Snake</button>
      <button class="lb-tab" data-game="code-breaker">‚å®Ô∏è Code Breaker</button>
      <button class="lb-tab" data-game="neos-training">‚ö° Neo's Training</button>
    </div>
    
    <div id="leaderboard-content" style="margin-top: 20px; min-height: 300px;">
      <div id="leaderboard-display"></div>
    </div>
    
    <p style="text-align: center; color: var(--theme-text); opacity: 0.6; font-size: 0.85rem; margin-top: 15px;">
      Play games to see your scores here! Leaderboards saved locally.
    </p>
  </div>
</div>

<style>
  .matrix-gaming-panel {
    background: var(--theme-bg-panel) !important;
    border: 2px solid var(--theme-primary);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
  }

  .game-tabs {
    width: 100%;
  }

  .tab-buttons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .tab-btn {
    flex: 1;
    min-width: 140px;
    padding: 0.75rem 1rem;
    background: rgba(0, 0, 0, 0.8);
    color: var(--theme-primary);
    border: 2px solid var(--theme-primary);
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    text-shadow: 0 0 5px var(--theme-glow);
  }

  .tab-btn:hover {
    background: rgba(0, 255, 0, 0.1);
    box-shadow: 0 0 15px var(--theme-glow);
    transform: translateY(-2px);
  }

  .tab-btn.active {
    background: var(--theme-primary);
    color: #000;
    text-shadow: none;
    box-shadow: 0 0 20px var(--theme-glow);
  }

  .game-container {
    position: relative;
    width: 100%;
    height: 600px;
    border: 2px solid var(--theme-primary);
    border-radius: 8px;
    overflow: hidden;
    background: #000;
  }

  .game-frame {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
  }

  .game-frame.active {
    opacity: 1;
    visibility: visible;
  }

  .game-iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  @media (max-width: 768px) {
    .tab-btn {
      flex: 1 1 45%;
      font-size: 0.7rem;
      padding: 0.5rem;
      min-width: 100px;
    }

    .game-container {
      height: 500px;
      margin-bottom: 10px;
    }
    
    .matrix-gaming-panel {
      padding: 10px;
    }
  }
  
  @media (max-width: 480px) {
    .tab-btn {
      flex: 1 1 100%;
      font-size: 0.8rem;
    }
    
    .game-container {
      height: 450px;
    }
  }

  /* Leaderboard Modal Styles */
  .matrix-game-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .matrix-game-modal-content {
    background: var(--theme-bg-dark);
    border: 3px solid var(--theme-primary);
    border-radius: 10px;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 40px var(--theme-glow);
    position: relative;
  }

  .modal-close-btn {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    color: var(--theme-primary);
    font-size: 2rem;
    cursor: pointer;
    line-height: 1;
    padding: 0;
    width: 30px;
    height: 30px;
  }

  .modal-close-btn:hover {
    color: #f00;
    text-shadow: 0 0 10px #f00;
  }

  .leaderboard-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-bottom: 15px;
  }

  .lb-tab {
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid var(--theme-primary);
    color: var(--theme-primary);
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    border-radius: 5px;
    transition: all 0.3s ease;
  }

  .lb-tab:hover {
    background: rgba(0, 255, 0, 0.1);
    box-shadow: 0 0 10px var(--theme-glow);
  }

  .lb-tab.active {
    background: var(--theme-primary);
    color: #000;
    box-shadow: 0 0 15px var(--theme-glow);
  }

  .leaderboard-entry {
    display: grid;
    grid-template-columns: 50px 1fr 100px 120px;
    align-items: center;
    padding: 12px;
    border: 1px solid rgba(0, 255, 0, 0.3);
    background: rgba(0, 20, 0, 0.3);
    margin-bottom: 8px;
    border-radius: 5px;
    font-family: 'Courier New', monospace;
    transition: all 0.3s ease;
  }

  .leaderboard-entry:hover {
    background: rgba(0, 40, 0, 0.5);
    border-color: var(--theme-primary);
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
  }

  .leaderboard-entry.top-three {
    border-width: 2px;
    background: rgba(0, 30, 0, 0.5);
  }

  .leaderboard-entry .rank {
    font-size: 1.3rem;
    text-align: center;
  }

  .leaderboard-entry .player-name {
    color: var(--theme-primary);
    text-shadow: 0 0 5px var(--theme-glow);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .leaderboard-entry .score {
    color: #0ff;
    text-align: right;
    font-weight: bold;
    text-shadow: 0 0 5px #0ff;
  }

  .leaderboard-entry .date {
    color: #0a0;
    text-align: right;
    font-size: 0.75rem;
  }

  @media (max-width: 600px) {
    .matrix-game-modal-content {
      padding: 20px;
    }

    .lb-tab {
      font-size: 0.7rem;
      padding: 6px 10px;
    }

    .leaderboard-entry {
      grid-template-columns: 40px 1fr 80px;
      font-size: 0.85rem;
    }

    .leaderboard-entry .date {
      display: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const gameFrames = document.querySelectorAll('.game-frame');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const gameName = button.dataset.game;

        // Remove active class from all buttons and frames
        tabButtons.forEach(btn => btn.classList.remove('active'));
        gameFrames.forEach(frame => frame.classList.remove('active'));

        // Add active class to clicked button and corresponding frame
        button.classList.add('active');
        const activeFrame = document.querySelector(`.game-frame[data-game="${gameName}"]`);
        if (activeFrame) {
          activeFrame.classList.add('active');
        }
      });
    });
  });

  // Leaderboard System
  const leaderboardModal = document.getElementById('leaderboards-modal');
  const showLeaderboardsBtn = document.getElementById('show-leaderboards-btn');
  const closeLeaderboardsBtn = document.getElementById('close-leaderboards');
  const lbTabs = document.querySelectorAll('.lb-tab');
  const leaderboardDisplay = document.getElementById('leaderboard-display');

  let currentLeaderboardGame = 'bullet-dodge';

  function getLeaderboard(gameName) {
    try {
      const stored = localStorage.getItem(`matrix_leaderboard_${gameName}`);
      if (!stored) return [];
      const parsed = JSON.parse(stored);
      return Array.isArray(parsed) ? parsed : [];
    } catch (error) {
      console.error('Error loading leaderboard:', error);
      return [];
    }
  }

  function formatDate(dateString) {
    try {
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return 'N/A';
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    } catch (error) {
      return 'N/A';
    }
  }

  function getRankIcon(rank) {
    if (rank === 1) return 'ü•á';
    if (rank === 2) return 'ü•à';
    if (rank === 3) return 'ü•â';
    return `#${rank}`;
  }

  function escapeHtml(text) {
    try {
      const div = document.createElement('div');
      div.textContent = String(text || '');
      return div.innerHTML;
    } catch (error) {
      return String(text || 'Anonymous');
    }
  }

  function renderLeaderboard(gameName) {
    if (!leaderboardDisplay) {
      console.error('Leaderboard display element not found');
      return;
    }

    const scores = getLeaderboard(gameName);
    
    if (!scores || scores.length === 0) {
      leaderboardDisplay.innerHTML = `
        <div style="text-align: center; padding: 40px; color: var(--theme-text); opacity: 0.6;">
          <p style="font-size: 1.2rem; margin-bottom: 10px;">No scores yet</p>
          <p style="font-size: 0.9rem;">Be the first to set a record!</p>
          <p style="font-size: 0.8rem; margin-top: 15px; opacity: 0.8;">Play games to see leaderboards here</p>
        </div>
      `;
      return;
    }

    try {
      leaderboardDisplay.innerHTML = scores.map((entry, index) => {
        const rank = index + 1;
        const name = escapeHtml(entry.name || 'Anonymous');
        const score = Number(entry.score) || 0;
        const date = formatDate(entry.date);
        
        return `
          <div class="leaderboard-entry ${index < 3 ? 'top-three' : ''}">
            <span class="rank">${getRankIcon(rank)}</span>
            <span class="player-name">${name}</span>
            <span class="score">${score.toLocaleString()}</span>
            <span class="date">${date}</span>
          </div>
        `;
      }).join('');
    } catch (error) {
      console.error('Error rendering leaderboard:', error);
      leaderboardDisplay.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #f00;">
          <p>Error loading leaderboard</p>
        </div>
      `;
    }
  }

  // Initialize event listeners
  if (showLeaderboardsBtn) {
    showLeaderboardsBtn.addEventListener('click', () => {
      if (leaderboardModal) {
        leaderboardModal.style.display = 'flex';
        renderLeaderboard(currentLeaderboardGame);
      }
    });
  }

  if (closeLeaderboardsBtn) {
    closeLeaderboardsBtn.addEventListener('click', () => {
      if (leaderboardModal) {
        leaderboardModal.style.display = 'none';
      }
    });
  }

  if (leaderboardModal) {
    leaderboardModal.addEventListener('click', (e) => {
      if (e.target === leaderboardModal) {
        leaderboardModal.style.display = 'none';
      }
    });
  }

  if (lbTabs) {
    lbTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        lbTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const gameName = tab.dataset.game;
        if (gameName) {
          currentLeaderboardGame = gameName;
          renderLeaderboard(currentLeaderboardGame);
        }
      });
    });
  }

  // Listen for score updates from games via postMessage
  window.addEventListener('message', (event) => {
    try {
      if (event.data && event.data.type === 'gameScore') {
        const { game, name, score } = event.data;
        if (game && name && typeof score === 'number') {
          addScore(game, name, score);
        }
      }
    } catch (error) {
      console.error('Error processing game score message:', error);
    }
  });

  function addScore(gameName, playerName, score) {
    try {
      const scores = getLeaderboard(gameName);
      scores.push({
        name: String(playerName).substring(0, 20),
        score: Number(score) || 0,
        date: new Date().toISOString()
      });
      scores.sort((a, b) => (Number(b.score) || 0) - (Number(a.score) || 0));
      const topScores = scores.slice(0, 10);
      localStorage.setItem(`matrix_leaderboard_${gameName}`, JSON.stringify(topScores));
      
      // Refresh the display if this game's leaderboard is currently showing
      if (currentLeaderboardGame === gameName && leaderboardModal && leaderboardModal.style.display === 'flex') {
        renderLeaderboard(gameName);
      }
    } catch (error) {
      console.error('Error saving score:', error);
    }
  }

  // Initialize the first leaderboard on page load
  if (leaderboardDisplay) {
    renderLeaderboard(currentLeaderboardGame);
  }
</script>

<!-- Deal Scanner Section -->
<div class="container">
  <div class="panel deal-scanner-panel">
    <h2 style="text-align: center; margin-bottom: 15px;">DEAL SCANNER TERMINAL</h2>
    <div id="scanner-terminal">
      <div id="scanner-output"></div>
      <button id="scan-btn" class="btn" style="margin-top: 15px;">INITIATE SCAN</button>
    </div>
    <div id="decoded-deals" style="display: none; margin-top: 20px;">
      <h3 style="text-align: center; color: var(--section-deal-scanner, #0f0); margin-bottom: 15px;">DECODED OPPORTUNITIES</h3>
      <div id="deals-container"></div>
    </div>
  </div>
</div>

<style>
  .deal-scanner-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: var(--section-deal-scanner, #0f0);
    border: 2px solid var(--section-deal-scanner, #0f0);
    font-family: 'Courier New', monospace;
  }

  #scanner-terminal {
    background: #000;
    border: 1px solid var(--section-deal-scanner, #0f0);
    border-radius: 5px;
    padding: 15px;
    min-height: 150px;
  }

  #scanner-output {
    color: var(--section-deal-scanner, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    line-height: 1.6;
    white-space: pre-wrap;
    min-height: 120px;
  }

  #scanner-output .cursor {
    animation: blink 0.7s infinite;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .decoded-deal {
    background: rgba(0, 30, 0, 0.28);
    border: 1px solid var(--section-deal-scanner, #0f0);
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 15px;
  }

  .deal-label {
    display: inline-block;
    background: var(--section-deal-scanner, #0f0);
    color: #000;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .deal-info {
    font-size: 0.85rem;
    color: var(--section-deal-scanner, #0a0);
    margin-top: 8px;
    text-align: center;
    opacity: 0.8;
  }

  #scan-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

<script>
  const scannerOutput = document.getElementById('scanner-output');
  const scanBtn = document.getElementById('scan-btn');
  const decodedDeals = document.getElementById('decoded-deals');
  const dealsContainer = document.getElementById('deals-container');

  // All available deals for rotation
  const allDeals = [
    // Crypto & Security
    { label: 'CRYPTO SECURITY', title: 'Ledger Hardware Wallet', url: 'https://shop.ledger.com/?r=5b26c17b2e98', info: 'Protect your digital assets with military-grade security' },
    { label: 'CRYPTO EXCHANGE', title: 'Binance US - Trade Crypto', url: 'https://www.binance.us/universal_JHHGDSKDJ/auth/registration?ref=614205735', info: 'Trade 100+ cryptocurrencies with low fees' },
    { label: 'CRYPTO TRADING', title: 'BTCC Exchange', url: 'https://btcc.com/invite/Ufihz4l', info: 'Advanced crypto trading platform with bonuses' },
    // Investing & Finance
    { label: 'PASSIVE INCOME', title: 'Acorns Investing - FREE $5', url: 'https://acorns.com/share/?shareable_code=CQ1T7GA&first_name=Brandon&friend_reward=5', info: 'Start investing spare change automatically' },
    { label: 'FREE STOCK', title: 'Robinhood - Get Free Stock', url: 'https://join.robinhood.com/brandol-06d7e3', info: 'Commission-free trading with sign-up bonus' },
    // AI Tools
    { label: 'AI TOOLS', title: 'VEED - AI Video Editor', url: 'https://veed.sjv.io/7aj7Pr', info: 'Professional video editing powered by AI' },
    { label: 'AI TOOLS', title: 'Pictory - AI Video Creator', url: 'https://pictory.ai?ref=brandon94', info: 'Turn scripts into stunning videos with AI' },
    { label: 'AI TOOLS', title: 'Invideo AI - Create Videos', url: 'https://invideo.sjv.io/o4E32b', info: 'Turn AI into income with unlimited generations' },
    // Health & Fitness
    { label: 'FITNESS DEALS', title: 'Redcon1 Supplements', url: 'http://rwrd.io/nr6geao?s', info: 'Premium supplements with exclusive rewards' },
    // Games & Other
    { label: 'GAMING', title: 'MPL PRO - Win Real Money', url: 'https://referral-mplpro.onelink.me/eMpV/6kc2y3ka', info: 'Compete in skill-based games for cash prizes' },
    { label: 'GAMING', title: 'Stake.US - Social Casino', url: 'https://stake.us/?c=vKE8Fpwd', info: 'Free-to-play social casino experience' },
    { label: 'DELIVERY', title: 'DoorDash - Food Delivery', url: 'https://drd.sh/W94sSoxe4jsGyFoO', info: 'Get food delivered with sign-up bonus' },
    // TEMU
    { label: 'HOT DEALS', title: 'TEMU - Super Fast Earning', url: 'https://temu.to/k/ph6uzzqbm7c', info: 'Earn rewards while shopping amazing deals' },
    { label: 'HOT DEALS', title: 'TEMU - Hot Deals', url: 'https://temu.to/k/prxuzyej54g', info: 'Flash deals on trending products' },
    { label: 'EXCLUSIVE', title: 'TEMU - Exclusive Deal', url: 'https://temu.to/k/pssqr37haqj', info: 'Special offer just for you' },
    { label: '$200 COUPON', title: 'TEMU - $200 Coupon Bundle', url: 'https://temu.to/k/plk7nt89x6c', info: 'Massive savings coupon bundle' },
    { label: 'BEST SELLERS', title: 'TEMU - Best Sellers', url: 'https://temu.to/k/pjbw6mpytbx', info: 'Shop the most popular items' },
    // Amazon
    { label: 'STREAMING', title: 'Prime for Young Adults', url: 'https://amzn.to/4pzCx7R', info: 'Discounted Prime for ages 18-24' },
    { label: 'STREAMING', title: 'Amazon Prime', url: 'https://amzn.to/48AEXgW', info: 'Free shipping, streaming & more' },
    { label: 'STREAMING', title: 'Prime Video', url: 'https://amzn.to/3XkW404', info: 'Stream movies & exclusive shows' },
    { label: 'AUDIO', title: 'Audible Premium Plus', url: 'https://amzn.to/44p4Mhw', info: 'Unlimited audiobooks & originals' },
    { label: 'READING', title: 'Kindle Unlimited', url: 'https://amzn.to/3XhTl7x', info: 'Unlimited reading on any device' },
    { label: 'MUSIC', title: 'Amazon Music Unlimited', url: 'https://amzn.to/4rtHuBg', info: '100M+ songs ad-free' },
    { label: 'FAMILY', title: 'Amazon Kids+', url: 'https://amzn.to/4oE71oJ', info: 'Kid-friendly content & games' },
    { label: 'SAVINGS', title: 'Amazon Access (SNAP/EBT)', url: 'https://amzn.to/4rp4EZk', info: 'Discounted Prime for qualifying members' }
  ];

  // Track shown deals to avoid immediate repeats
  let lastShownDeals = [];

  const scannerLines = [
    '> Initializing MATRIX-HUB deal scanner...',
    '> Connecting to affiliate networks...',
    '> Scanning 4,221 digital offers...',
    '> Analyzing conversion rates...',
    '> Filtering highest payouts...',
    '> Decrypting opportunity data...',
    '> Validating partner programs...',
    '> SCAN COMPLETE.',
    '> Displaying 3 profit-optimized opportunities...'
  ];

  // Fisher-Yates shuffle
  function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  // Get 3 random deals, avoiding the last shown deals
  function getRandomDeals() {
    // Filter out deals that were just shown
    const availableDeals = allDeals.filter(deal => !lastShownDeals.includes(deal.url));

    // Shuffle and pick 3
    const shuffled = shuffleArray(availableDeals);
    const selected = shuffled.slice(0, 3);

    // Remember these for next time
    lastShownDeals = selected.map(d => d.url);

    return selected;
  }

  // Render deals to the container
  function renderDeals(deals) {
    dealsContainer.innerHTML = deals.map(deal => `
      <div class="decoded-deal">
        <span class="deal-label">${deal.label}</span>
        <a href="${deal.url}" class="btn" target="_blank" rel="noopener">${deal.title}</a>
        <p class="deal-info">${deal.info}</p>
      </div>
    `).join('');
  }

  scanBtn.addEventListener('click', runScanner);

  async function runScanner() {
    scanBtn.disabled = true;
    scanBtn.textContent = 'SCANNING...';
    scannerOutput.innerHTML = '';
    decodedDeals.style.display = 'none';

    for (let i = 0; i < scannerLines.length; i++) {
      await typeText(scannerLines[i]);
      await delay(300 + Math.random() * 400);
    }

    // Get and render random deals
    const randomDeals = getRandomDeals();
    renderDeals(randomDeals);

    await delay(500);
    decodedDeals.style.display = 'block';
    decodedDeals.style.animation = 'fadeIn 0.5s ease-in';
    scanBtn.textContent = 'SCAN AGAIN';
    scanBtn.disabled = false;
  }

  async function typeText(text) {
    const line = document.createElement('div');
    scannerOutput.appendChild(line);

    for (let i = 0; i < text.length; i++) {
      line.textContent = text.substring(0, i + 1);
      await delay(20 + Math.random() * 30);
    }
    line.innerHTML += '<br>';
    scannerOutput.scrollTop = scannerOutput.scrollHeight;
  }

  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<!-- DAILY DROPS BOT SECTION -->
<div class="container">
  <div class="panel daily-drops-panel">
    <div class="daily-drops-header">
      <h2>DAILY DROPS BOT</h2>
      <div class="bot-status">
        <span class="status-dot"></span>
        <span id="bot-status-text">LIVE</span>
      </div>
    </div>
    <p class="daily-drops-subtitle">Fresh deals dropped automatically every day</p>

    <div id="daily-drops-content">
      <div class="drops-loading">
        <div class="loading-spinner"></div>
        <span>Scanning for today's best deals...</span>
      </div>
    </div>

    <div class="drops-footer">
      <span id="last-updated">Last updated: --</span>
      <button id="refresh-drops" class="btn refresh-btn">REFRESH DROPS</button>
    </div>
  </div>
</div>

<style>
  .daily-drops-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: var(--section-daily-drops, #0f0);
    border: 2px solid var(--section-daily-drops, #0f0);
    position: relative;
    overflow: hidden;
  }

  .daily-drops-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--section-daily-drops, #0f0), transparent);
    animation: scanLine 3s infinite;
  }

  @keyframes scanLine {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  .daily-drops-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .daily-drops-header h2 {
    margin: 0;
    font-family: 'Courier New', monospace;
    text-shadow: 0 0 10px var(--section-daily-drops, #0f0);
  }

  .bot-status {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(0, 255, 0, 0.1);
    padding: 5px 12px;
    border-radius: 20px;
    border: 1px solid var(--section-daily-drops, #0f0);
  }

  .status-dot {
    width: 10px;
    height: 10px;
    background: var(--section-daily-drops, #0f0);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 5px var(--section-daily-drops, #0f0); }
    50% { opacity: 0.5; box-shadow: 0 0 15px var(--section-daily-drops, #0f0); }
  }

  .daily-drops-subtitle {
    color: var(--section-daily-drops, #0a0);
    font-size: 0.9rem;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
    opacity: 0.8;
  }

  .drops-category {
    margin-bottom: 20px;
  }

  .drops-category-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    color: var(--section-daily-drops, #0f0);
    text-transform: uppercase;
  }

  .drops-category-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--section-daily-drops, #0f0), transparent);
  }

  .drops-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
  }

  .drop-card {
    background: rgba(0, 30, 0, 0.28);
    border: 1px solid var(--section-daily-drops, #0a0);
    border-radius: 8px;
    padding: 12px;
    transition: all 0.3s ease;
    cursor: pointer;
    text-decoration: none;
    display: block;
  }

  .drop-card:hover {
    border-color: var(--section-daily-drops, #0f0);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 255, 0, 0.2);
  }

  .drop-card-tag {
    display: inline-block;
    background: var(--section-daily-drops, #0f0);
    color: #000;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: bold;
    margin-bottom: 8px;
  }

  .drop-card-title {
    color: #0ff;
    font-weight: bold;
    font-size: 0.95rem;
    margin-bottom: 5px;
  }

  .drop-card-desc {
    color: var(--section-daily-drops, #0a0);
    font-size: 0.8rem;
    line-height: 1.4;
    opacity: 0.8;
  }

  .drop-card-code {
    margin-top: 8px;
    background: rgba(0, 255, 0, 0.1);
    border: 1px dashed var(--section-daily-drops, #0f0);
    padding: 4px 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    color: var(--section-daily-drops, #0f0);
  }

  .drops-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid var(--section-daily-drops, #0a0);
  }

  #last-updated {
    font-size: 0.75rem;
    color: var(--section-daily-drops, #0a0);
    font-family: 'Courier New', monospace;
    opacity: 0.8;
  }

  .refresh-btn {
    padding: 8px 16px !important;
    font-size: 0.8rem !important;
    width: auto !important;
    margin: 0 !important;
  }

  .drops-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px;
    gap: 15px;
    color: var(--section-daily-drops, #0a0);
    font-family: 'Courier New', monospace;
    opacity: 0.8;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--section-daily-drops, #0a0);
    border-top-color: var(--section-daily-drops, #0f0);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>

<script>
  // Daily Drops Bot
  const dailyDropsContent = document.getElementById('daily-drops-content');
  const lastUpdatedEl = document.getElementById('last-updated');
  const refreshBtn = document.getElementById('refresh-drops');

  async function loadDailyDrops() {
    dailyDropsContent.innerHTML = `
      <div class="drops-loading">
        <div class="loading-spinner"></div>
        <span>Scanning for today's best deals...</span>
      </div>
    `;

    try {
      const response = await fetch('/api/daily-drops');
      const data = await response.json();

      renderDrops(data);
      lastUpdatedEl.textContent = `Last updated: ${new Date(data.timestamp).toLocaleTimeString()}`;
    } catch (error) {
      console.error('Failed to load daily drops:', error);
      dailyDropsContent.innerHTML = `
        <div class="drops-loading">
          <span style="color: #f00;">Failed to load deals. Click refresh to try again.</span>
        </div>
      `;
    }
  }

  function renderDrops(data) {
    let html = '';

    // Affiliate Deals
    if (data.featuredAffiliate?.length) {
      html += `
        <div class="drops-category">
          <div class="drops-category-title">New Affiliate Deals</div>
          <div class="drops-grid">
            ${data.featuredAffiliate.map(deal => createDropCard(deal)).join('')}
          </div>
        </div>
      `;
    }

    // Discount Codes
    if (data.featuredDiscounts?.length) {
      html += `
        <div class="drops-category">
          <div class="drops-category-title">Discount Codes</div>
          <div class="drops-grid">
            ${data.featuredDiscounts.map(deal => createDropCard(deal, true)).join('')}
          </div>
        </div>
      `;
    }

    // Digital Products
    if (data.featuredDigital?.length) {
      html += `
        <div class="drops-category">
          <div class="drops-category-title">Digital Product Promos</div>
          <div class="drops-grid">
            ${data.featuredDigital.map(deal => createDropCard(deal)).join('')}
          </div>
        </div>
      `;
    }

    // Crypto & Hosting
    if (data.featuredCrypto?.length) {
      html += `
        <div class="drops-category">
          <div class="drops-category-title">Crypto & Hosting Deals</div>
          <div class="drops-grid">
            ${data.featuredCrypto.map(deal => createDropCard(deal)).join('')}
          </div>
        </div>
      `;
    }

    dailyDropsContent.innerHTML = html;
  }

  function createDropCard(deal, showCode = false) {
    const codeHtml = (showCode && deal.code) ? `<div class="drop-card-code">CODE: ${deal.code}</div>` : '';
    return `
      <a href="${deal.url}" target="_blank" rel="noopener" class="drop-card">
        <span class="drop-card-tag">${deal.category}</span>
        <div class="drop-card-title">${deal.title}</div>
        <div class="drop-card-desc">${deal.description}</div>
        ${codeHtml}
      </a>
    `;
  }

  // Load on page load
  loadDailyDrops();

  // Refresh button
  refreshBtn.addEventListener('click', loadDailyDrops);
</script>

<!-- ALL CATEGORY LINKS - STORED FOR SCANNER AND DAILY DROPS (hidden from display)
  CRYPTO & SECURITY:
  - Ledger Wallets: https://shop.ledger.com/?r=5b26c17b2e98
  - Binance US: https://www.binance.us/universal_JHHGDSKDJ/auth/registration?ref=614205735
  - BTCC: https://btcc.com/invite/Ufihz4l

  INVESTING & FINANCE:
  - Acorns: https://acorns.com/share/?shareable_code=CQ1T7GA&first_name=Brandon&friend_reward=5
  - Robinhood: https://join.robinhood.com/brandol-06d7e3

  AI TOOLS:
  - VEED: https://veed.sjv.io/7aj7Pr
  - Pictory: https://pictory.ai?ref=brandon94
  - Invideo AI: https://invideo.sjv.io/o4E32b

  HEALTH & FITNESS:
  - Redcon1: http://rwrd.io/nr6geao?s

  GAMES/OTHER:
  - MPL PRO: https://referral-mplpro.onelink.me/eMpV/6kc2y3ka
  - Stake.US: https://stake.us/?c=vKE8Fpwd
  - DoorDash: https://drd.sh/W94sSoxe4jsGyFoO
-->

<!-- TEMU LINKS - STORED FOR SCANNER AND DAILY DROPS (hidden from display)
  - Super Fast Earning Mode: https://temu.to/k/ph6uzzqbm7c
  - Hot Deals: https://temu.to/k/prxuzyej54g
  - Exclusive Deal: https://temu.to/k/pssqr37haqj
  - $200 Coupon Bundle: https://temu.to/k/plk7nt89x6c
  - Temu Best Sellers: https://temu.to/k/pjbw6mpytbx
-->

<!-- AMAZON LINKS - STORED FOR SCANNER AND DAILY DROPS (hidden from display)
  - Prime for Young Adults: https://amzn.to/4pzCx7R
  - Prime: https://amzn.to/48AEXgW
  - Prime Access: https://amzn.to/4rmVdcX
  - Prime Video: https://amzn.to/3XkW404
  - Audible Premium Plus: https://amzn.to/44p4Mhw
  - Kindle Unlimited: https://amzn.to/3XhTl7x
  - Amazon Music Unlimited: https://amzn.to/4rtHuBg
  - Amazon Kids+: https://amzn.to/4oE71oJ
  - Baby Registry: https://amzn.to/4oopQM9
  - Wedding Registry: https://amzn.to/3KcYGKo
  - Amazon Access (SNAP/EBT): https://amzn.to/4rp4EZk
-->

<!-- Matrix Rain Animation Script -->
<script>
  const canvas = document.getElementById('matrix-canvas');
  const ctx = canvas.getContext('2d');

  // --- Audio-driven sync (Web Audio API) ---
  const matrixAudioEl = document.getElementById('matrixAudio');
  let matrixAudioCtx = null;
  let matrixAnalyser = null;
  let matrixAnalyserSource = null; // MediaElementAudioSourceNode (shared)
  let matrixAnalyserSink = null;   // Zero-gain sink to keep analyser branch "alive"
  let matrixFreqData = null;
  let matrixAudioOk = false;

  // Mixer nodes (playback path)
  let matrixEqLow = null;
  let matrixEqMid = null;
  let matrixEqHigh = null;
  let matrixPanNode = null; // StereoPannerNode or a splitter/merger fallback object
  let matrixGainNode = null;
  let matrixLimiterNode = null;

  function clampMixerNum(v, min, max) {
    const n = Number(v);
    if (!Number.isFinite(n)) return min;
    return Math.max(min, Math.min(max, n));
  }

  function applyMatrixPan(pan) {
    if (!matrixAudioCtx || !matrixPanNode) return;
    const p = clampMixerNum(pan, -1, 1);
    // StereoPannerNode path
    if (typeof matrixPanNode.pan === 'object' && typeof matrixPanNode.pan.value === 'number') {
      matrixPanNode.pan.setTargetAtTime(p, matrixAudioCtx.currentTime, 0.015);
      return;
    }
    // Splitter/merger fallback (equal-power panning)
    if (matrixPanNode.leftGain && matrixPanNode.rightGain) {
      const theta = (p + 1) * 0.25 * Math.PI; // 0..pi/2
      const left = Math.cos(theta);
      const right = Math.sin(theta);
      matrixPanNode.leftGain.gain.setTargetAtTime(left, matrixAudioCtx.currentTime, 0.015);
      matrixPanNode.rightGain.gain.setTargetAtTime(right, matrixAudioCtx.currentTime, 0.015);
    }
  }

  // Expose graph hooks for the player UI.
  window.matrixApplyMixerSettings = function matrixApplyMixerSettings() {
    if (!matrixAudioCtx || !matrixGainNode || !matrixEqLow || !matrixEqMid || !matrixEqHigh) return;
    const s = window.matrixMixerSettings || {};
    const volume = clampMixerNum(s.volume ?? 1, 0, 1.5);
    const mute = Boolean(s.mute);
    const bass = clampMixerNum(s.bass ?? 0, -12, 12);
    const mid = clampMixerNum(s.mid ?? 0, -12, 12);
    const treble = clampMixerNum(s.treble ?? 0, -12, 12);
    const pan = clampMixerNum(s.pan ?? 0, -1, 1);

    matrixEqLow.gain.setTargetAtTime(bass, matrixAudioCtx.currentTime, 0.02);
    matrixEqMid.gain.setTargetAtTime(mid, matrixAudioCtx.currentTime, 0.02);
    matrixEqHigh.gain.setTargetAtTime(treble, matrixAudioCtx.currentTime, 0.02);
    applyMatrixPan(pan);
    matrixGainNode.gain.setTargetAtTime(mute ? 0 : volume, matrixAudioCtx.currentTime, 0.02);
  };

  const matrixAudioState = {
    energy: 0,
    bass: 0,
    treble: 0,
    beat: 0,
    _smoothEnergy: 0,
    _smoothBass: 0,
    _smoothTreble: 0,
    _beatHold: 0,
  };

  function syncMatrixPulseCssVars() {
    document.documentElement.style.setProperty('--matrix-bass', String(matrixAudioState.bass));
  }

  function clamp01(v) {
    return Math.max(0, Math.min(1, v));
  }

  function clamp(v, min, max) {
    return Math.max(min, Math.min(max, v));
  }

  function avgBins(data, start, end) {
    const s = Math.max(0, start | 0);
    const e = Math.min(data.length, end | 0);
    if (e <= s) return 0;
    let sum = 0;
    for (let i = s; i < e; i++) sum += data[i];
    return sum / (e - s);
  }

  function ensureMatrixAudioGraph() {
    if (!matrixAudioEl) return false;
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return false;

    try {
      if (!matrixAudioCtx) matrixAudioCtx = new Ctx();
      if (matrixAudioCtx.state === 'suspended') {
        // Resume may fail if not in a user gesture.
        // Avoid creating a MediaElementSourceNode while suspended (can silence playback).
        matrixAudioCtx
          .resume()
          .then(() => {
            try {
              ensureMatrixAudioGraph();
              if (typeof window.matrixApplyMixerSettings === 'function') window.matrixApplyMixerSettings();
            } catch {}
          })
          .catch(() => {});
        return false;
      }

      if (!matrixAnalyser) {
        matrixAnalyser = matrixAudioCtx.createAnalyser();
        matrixAnalyser.fftSize = 2048;
        matrixAnalyser.smoothingTimeConstant = 0.8;
        matrixFreqData = new Uint8Array(matrixAnalyser.frequencyBinCount);

        matrixAnalyserSource = matrixAudioCtx.createMediaElementSource(matrixAudioEl);

        // Analysis branch (pre-mixer) so beat sync stays stable even with EQ/volume/pan changes.
        matrixAnalyserSink = matrixAudioCtx.createGain();
        matrixAnalyserSink.gain.value = 0;
        matrixAnalyserSource.connect(matrixAnalyser);
        matrixAnalyser.connect(matrixAnalyserSink);
        matrixAnalyserSink.connect(matrixAudioCtx.destination);

        // Playback branch (mixer)
        matrixEqLow = matrixAudioCtx.createBiquadFilter();
        matrixEqLow.type = 'lowshelf';
        matrixEqLow.frequency.value = 140;
        matrixEqLow.gain.value = 0;

        matrixEqMid = matrixAudioCtx.createBiquadFilter();
        matrixEqMid.type = 'peaking';
        matrixEqMid.frequency.value = 1000;
        matrixEqMid.Q.value = 0.9;
        matrixEqMid.gain.value = 0;

        matrixEqHigh = matrixAudioCtx.createBiquadFilter();
        matrixEqHigh.type = 'highshelf';
        matrixEqHigh.frequency.value = 6000;
        matrixEqHigh.gain.value = 0;

        // Pan (prefer StereoPannerNode; fall back to splitter/merger)
        if (typeof matrixAudioCtx.createStereoPanner === 'function') {
          matrixPanNode = matrixAudioCtx.createStereoPanner();
          matrixPanNode.pan.value = 0;
        } else {
          const splitter = matrixAudioCtx.createChannelSplitter(2);
          const merger = matrixAudioCtx.createChannelMerger(2);
          const leftGain = matrixAudioCtx.createGain();
          const rightGain = matrixAudioCtx.createGain();
          leftGain.gain.value = 1;
          rightGain.gain.value = 1;
          splitter.connect(leftGain, 0);
          splitter.connect(rightGain, 1);
          leftGain.connect(merger, 0, 0);
          rightGain.connect(merger, 0, 1);
          matrixPanNode = { splitter, merger, leftGain, rightGain };
        }

        matrixGainNode = matrixAudioCtx.createGain();
        matrixGainNode.gain.value = 1;

        // Gentle limiter to reduce clipping when boosting the mixer.
        matrixLimiterNode = matrixAudioCtx.createDynamicsCompressor();
        matrixLimiterNode.threshold.value = -3;
        matrixLimiterNode.knee.value = 0;
        matrixLimiterNode.ratio.value = 20;
        matrixLimiterNode.attack.value = 0.003;
        matrixLimiterNode.release.value = 0.25;

        // Wire playback path: source -> EQ -> pan -> gain -> limiter -> destination
        matrixAnalyserSource.connect(matrixEqLow);
        matrixEqLow.connect(matrixEqMid);
        matrixEqMid.connect(matrixEqHigh);

        if (matrixPanNode && typeof matrixPanNode.connect === 'function') {
          matrixEqHigh.connect(matrixPanNode);
          matrixPanNode.connect(matrixGainNode);
        } else if (matrixPanNode && matrixPanNode.splitter && matrixPanNode.merger) {
          matrixEqHigh.connect(matrixPanNode.splitter);
          matrixPanNode.merger.connect(matrixGainNode);
        } else {
          matrixEqHigh.connect(matrixGainNode);
        }

        matrixGainNode.connect(matrixLimiterNode);
        matrixLimiterNode.connect(matrixAudioCtx.destination);

        // Apply any UI-selected mixer settings (saved in localStorage).
        if (typeof window.matrixApplyMixerSettings === 'function') window.matrixApplyMixerSettings();
      }

      matrixAudioOk = true;
      return true;
    } catch (e) {
      // Most commonly caused by cross-origin audio without proper CORS headers.
      matrixAudioOk = false;
      return false;
    }
  }

  function updateMatrixAudioState() {
    // Decay to baseline when not playing or analysis unavailable
    if (!matrixAnalyser || !matrixAudioOk || !matrixAudioEl || matrixAudioEl.paused) {
      matrixAudioState._smoothEnergy *= 0.94;
      matrixAudioState._smoothBass *= 0.94;
      matrixAudioState._smoothTreble *= 0.94;
      matrixAudioState._beatHold *= 0.90;
      matrixAudioState.energy = matrixAudioState._smoothEnergy;
      matrixAudioState.bass = matrixAudioState._smoothBass;
      matrixAudioState.treble = matrixAudioState._smoothTreble;
      matrixAudioState.beat = matrixAudioState._beatHold;
      syncMatrixPulseCssVars();
      return;
    }

    matrixAnalyser.getByteFrequencyData(matrixFreqData);

    const sampleRate = matrixAudioCtx ? matrixAudioCtx.sampleRate : 44100;
    const binHz = sampleRate / matrixAnalyser.fftSize;

    const bassEnd = clamp(Math.floor(250 / binHz), 1, matrixFreqData.length);
    const trebleStart = clamp(Math.floor(2000 / binHz), 0, matrixFreqData.length);
    const trebleEnd = clamp(Math.floor(8000 / binHz), trebleStart + 1, matrixFreqData.length);

    const rawEnergy = avgBins(matrixFreqData, 0, matrixFreqData.length) / 255;
    const rawBass = avgBins(matrixFreqData, 0, bassEnd) / 255;
    const rawTreble = avgBins(matrixFreqData, trebleStart, trebleEnd) / 255;

    matrixAudioState._smoothEnergy = matrixAudioState._smoothEnergy * 0.85 + rawEnergy * 0.15;
    matrixAudioState._smoothBass = matrixAudioState._smoothBass * 0.82 + rawBass * 0.18;
    matrixAudioState._smoothTreble = matrixAudioState._smoothTreble * 0.82 + rawTreble * 0.18;

    // Simple "beat" pulse from bass rising above its recent average
    const beatStrength = Math.max(0, rawBass - matrixAudioState._smoothBass * 1.12);
    matrixAudioState._beatHold = Math.max(matrixAudioState._beatHold * 0.88, beatStrength * 2.4);

    matrixAudioState.energy = clamp01(matrixAudioState._smoothEnergy);
    matrixAudioState.bass = clamp01(matrixAudioState._smoothBass);
    matrixAudioState.treble = clamp01(matrixAudioState._smoothTreble);
    matrixAudioState.beat = clamp01(matrixAudioState._beatHold);
    syncMatrixPulseCssVars();
  }

  // Set canvas size to full window
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // Matrix characters (Katakana, numbers, and some Latin letters)
  const matrixChars = '„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  const chars = matrixChars.split('');

  const fontSize = 16;
  let columns = Math.floor(canvas.width / fontSize);

  // Array to track the y position of each column's drop
  let drops = [];
  for (let i = 0; i < columns; i++) {
    drops[i] = Math.random() * -100; // Start above the screen at random heights
  }

  // Update columns and drops on resize
  window.addEventListener('resize', () => {
    columns = Math.floor(canvas.width / fontSize);
    const newDrops = [];
    for (let i = 0; i < columns; i++) {
      newDrops[i] = drops[i] !== undefined ? drops[i] : Math.random() * -100;
    }
    drops = newDrops;
  });

  // Get current theme color for matrix rain
  function getMatrixRainColor() {
    // Check if custom color was set via theme system
    if (window.matrixRainColor) {
      return window.matrixRainColor;
    }
    // Otherwise get from CSS variable
    const style = getComputedStyle(document.documentElement);
    return style.getPropertyValue('--theme-primary').trim() || '#0f0';
  }

  function drawMatrix() {
    // Update audio metrics once per frame; visuals read from smoothed values.
    updateMatrixAudioState();
    const energy = matrixAudioState.energy;
    const bass = matrixAudioState.bass;
    const beat = matrixAudioState.beat;

    // Semi-transparent black to create fade effect
    // Higher energy => shorter trails (more frequent clears).
    const fadeAlpha = clamp(0.03 + (1 - energy) * 0.04 + bass * 0.015, 0.025, 0.09);
    ctx.fillStyle = `rgba(0, 0, 0, ${fadeAlpha})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Get dynamic theme color
    const rainColor = getMatrixRainColor();
    ctx.save();
    // Brightness & "punch" respond to energy/beat.
    ctx.globalAlpha = clamp(0.35 + energy * 0.55 + beat * 0.55, 0.25, 1);
    ctx.fillStyle = rainColor;
    ctx.font = fontSize + 'px monospace';

    const speed = 0.6 + energy * 2.2 + beat * 3.0;
    const respawnThreshold = clamp(0.985 - energy * 0.02 - bass * 0.02 - beat * 0.03, 0.90, 0.99);

    for (let i = 0; i < drops.length; i++) {
      // Random character
      const char = chars[Math.floor(Math.random() * chars.length)];

      // Draw the character
      ctx.fillText(char, i * fontSize, drops[i] * fontSize);

      // Reset drop to top with random delay when it goes off screen
      if (drops[i] * fontSize > canvas.height && Math.random() > respawnThreshold) {
        drops[i] = 0;
      }

      drops[i] += speed;
    }
    ctx.restore();
  }

  // Run animation
  // Try to initialize audio analysis on user interaction / playback.
  function kickMatrixAudioSync() {
    ensureMatrixAudioGraph();
  }
  if (matrixAudioEl) {
    matrixAudioEl.addEventListener('play', kickMatrixAudioSync);
  }
  window.addEventListener('pointerdown', kickMatrixAudioSync, { once: true, passive: true });
  window.addEventListener('keydown', kickMatrixAudioSync, { once: true });

  // Allow the player UI to trigger graph creation on slider changes.
  window.matrixEnsureAudioGraph = ensureMatrixAudioGraph;

  // Frame pacing: ramps toward higher FPS with higher energy.
  let lastFrameTs = 0;
  function animateMatrix(ts) {
    requestAnimationFrame(animateMatrix);

    // If audio is playing, keep attempting to attach analyser (resume/graph creation can lag behind policies).
    if (matrixAudioEl && !matrixAudioEl.paused) ensureMatrixAudioGraph();

    const targetFps = clamp(20 + matrixAudioState.energy * 35 + matrixAudioState.beat * 25, 18, 60);
    const frameMs = 1000 / targetFps;
    if (ts - lastFrameTs < frameMs) return;
    lastFrameTs = ts;

    drawMatrix();
  }
  requestAnimationFrame(animateMatrix);
</script>

<!-- MATRIX BOT WIDGET -->
<div id="matrixBotWidget">
  <div id="matrixBotButton" role="button" aria-label="Open Oracle chat" title="Ask the Oracle">‚óà</div>

  <div id="matrixBotWindow">
    <div id="matrixBotHeader">
      <div class="oracle-header__title">THE ORACLE</div>
      <div class="oracle-header__controls">
        <button id="oracleAppsBtn" class="oracle-header__btn" type="button" title="Apps">APPS</button>
        <button id="oracleVoiceBtn" class="oracle-header__btn" type="button" aria-pressed="false" title="Voice">VOICE</button>
        <button id="oracleCloseBtn" class="oracle-header__btn" type="button" title="Close">√ó</button>
      </div>
    </div>

    <div id="oracleQuickActions"></div>
    <div id="oracleAppsPanel" hidden></div>
    <div id="matrixBotMessages"></div>

    <div id="matrixBotInputArea">
      <input id="matrixBotInput" type="text" placeholder="Ask the Oracle...">
      <button id="matrixBotSend">‚û§</button>
    </div>
  </div>
</div>

<div id="oracleMatrixToasts" aria-live="polite" aria-atomic="true"></div>
<script type="module" src="/oracle/oracle-secretary.js"></script>

<!-- MATRIX IMAGE GENERATOR -->
<div class="container">
  <div class="panel image-generator-panel">
    <!-- Animated Matrix Characters Background -->
    <div class="generator-matrix-bg">
      <div class="matrix-char-column" style="left: 5%;"></div>
      <div class="matrix-char-column" style="left: 15%;"></div>
      <div class="matrix-char-column" style="left: 25%;"></div>
      <div class="matrix-char-column" style="left: 35%;"></div>
      <div class="matrix-char-column" style="left: 45%;"></div>
      <div class="matrix-char-column" style="left: 55%;"></div>
      <div class="matrix-char-column" style="left: 65%;"></div>
      <div class="matrix-char-column" style="left: 75%;"></div>
      <div class="matrix-char-column" style="left: 85%;"></div>
      <div class="matrix-char-column" style="left: 95%;"></div>
    </div>

    <h2 style="text-align: center; margin-bottom: 15px; position: relative; z-index: 2;">
      <span class="glitch-title" data-text="MATRIX AI GENERATOR">MATRIX AI GENERATOR</span>
    </h2>
    <p class="generator-subtitle">Generate unique Matrix-themed visuals with animated code effects</p>

    <div class="generator-controls">
      <div class="control-group">
        <label for="gen-style">Style:</label>
        <select id="gen-style">
          <option value="rain">Digital Rain</option>
          <option value="circuit">Circuit Board</option>
          <option value="glitch">Glitch Art</option>
          <option value="code">Binary Code</option>
          <option value="hex">Hexagonal Grid</option>
          <option value="particles">Particle Storm</option>
          <option value="waves">Digital Waves</option>
          <option value="fractals">Fractal Code</option>
          <option value="neural">Neural Network</option>
          <option value="datastream">Data Stream</option>
          <option value="cyberpunk">Cyberpunk City</option>
          <optgroup label="Movie Styles">
            <option value="movie-classic">Movie: Classic Codefall</option>
            <option value="movie-bullet-time">Movie: Bullet-Time Burst</option>
            <option value="movie-agent">Movie: Agent Mirror Glitch</option>
            <option value="movie-architect">Movie: Architect White Room</option>
            <option value="movie-zion">Movie: Zion Industrial</option>
            <option value="movie-sentinels">Movie: Sentinel Swarm</option>
          </optgroup>
        </select>
      </div>
      <div class="control-group">
        <label for="gen-color">Color:</label>
        <select id="gen-color">
          <option value="#00ff00">Matrix Green</option>
          <option value="#00ffff">Cyan</option>
          <option value="#ff00ff">Magenta</option>
          <option value="#ffff00">Yellow</option>
          <option value="#ff0040">Blood Red</option>
          <option value="#ffd700">Gold</option>
          <option value="#ff6600">Orange</option>
          <option value="#00bfff">Neon Blue</option>
          <option value="#bf00ff">Purple</option>
          <option value="#ffffff">White</option>
          <option value="#ff1493">Hot Pink</option>
          <option value="#7fff00">Chartreuse</option>
          <option value="rainbow">Rainbow</option>
          <option value="matrix-fade">Matrix Fade</option>
          <option value="theme">Use Theme Color</option>
        </select>
      </div>
      <div class="control-group">
        <label for="gen-intensity">Intensity:</label>
        <select id="gen-intensity">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="extreme">Extreme</option>
          <option value="ultra">Ultra</option>
        </select>
      </div>
      <div class="control-group">
        <label for="gen-effect">Effect:</label>
        <select id="gen-effect">
          <option value="none">None</option>
          <option value="scanlines">Scanlines</option>
          <option value="vignette">Vignette</option>
          <option value="noise">Static Noise</option>
          <option value="chromatic">Chromatic</option>
        </select>
      </div>
    </div>

    <div class="generator-canvas-wrapper">
      <canvas id="generator-canvas" width="400" height="300"></canvas>
      <div class="canvas-overlay" id="canvas-overlay">
        <span class="overlay-text">Click GENERATE to create</span>
        <span class="overlay-cursor">_</span>
      </div>
    </div>

    <div class="generator-buttons">
      <button id="generate-btn" class="btn generator-btn">
        <span class="btn-matrix-char"></span> GENERATE
      </button>
      <button id="download-btn" class="btn generator-btn" disabled>
        <span class="btn-matrix-char"></span> DOWNLOAD
      </button>
      <button id="save-to-archive-btn" class="btn generator-btn">
        <span class="btn-matrix-char"></span> SAVE TO ARCHIVE
      </button>
    </div>
  </div>
</div>

<style>
  .image-generator-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: var(--section-art-generator, #0f0);
    border: 2px solid var(--section-art-generator, #0f0);
    border-radius: 14px;
    box-shadow:
      0 0 0 calc(var(--matrix-bass) * 2px) rgba(0, 255, 0, 0.28),
      0 0 28px rgba(0, 255, 0, 0.18),
      0 0 60px rgba(0, 255, 255, 0.05);
    backdrop-filter: blur(12px) saturate(120%);
    -webkit-backdrop-filter: blur(12px) saturate(120%);
    isolation: isolate;
    position: relative;
    overflow: hidden;
  }

  /* Cinematic CRT overlays (inspired by the Matrix aesthetic; no movie assets used) */
  .image-generator-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    opacity: 0.55;
    background:
      radial-gradient(1200px circle at 20% 0%, rgba(0, 255, 0, 0.18), transparent 55%),
      radial-gradient(900px circle at 85% 100%, rgba(0, 255, 255, 0.08), transparent 60%),
      repeating-linear-gradient(180deg, rgba(255, 255, 255, 0.035) 0px, rgba(255, 255, 255, 0.035) 1px, transparent 2px, transparent 6px);
    mix-blend-mode: screen;
  }

  .image-generator-panel::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    background:
      radial-gradient(closest-side at 50% 50%, transparent 55%, rgba(0, 0, 0, 0.55) 100%),
      linear-gradient(90deg, rgba(255, 0, 0, 0.03), transparent 18%, transparent 82%, rgba(0, 255, 255, 0.03));
    opacity: 0.9;
    animation: matrixCrtFlicker 6.5s steps(2) infinite;
  }

  @keyframes matrixCrtFlicker {
    0%, 100% { opacity: 0.85; filter: contrast(1) saturate(1); }
    50% { opacity: 0.95; filter: contrast(1.05) saturate(1.1); }
  }

  /* Animated Matrix Characters Background */
  .generator-matrix-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    pointer-events: none;
    opacity: 0.18;
    z-index: 0;
    mask-image: radial-gradient(circle at 50% 35%, #000 40%, transparent 78%);
  }

  .matrix-char-column {
    position: absolute;
    top: -100%;
    width: 20px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: var(--section-art-generator, #0f0);
    text-shadow: 0 0 10px currentColor;
    animation: matrixColumnFall linear infinite;
    white-space: nowrap;
    writing-mode: vertical-rl;
    text-orientation: upright;
  }

  .matrix-char-column::before {
    content: '„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    animation: matrixCharChange 0.5s steps(1) infinite;
  }

  .matrix-char-column:nth-child(1) { animation-duration: 8s; animation-delay: 0s; }
  .matrix-char-column:nth-child(2) { animation-duration: 12s; animation-delay: 1s; }
  .matrix-char-column:nth-child(3) { animation-duration: 10s; animation-delay: 0.5s; }
  .matrix-char-column:nth-child(4) { animation-duration: 14s; animation-delay: 2s; }
  .matrix-char-column:nth-child(5) { animation-duration: 9s; animation-delay: 0.3s; }
  .matrix-char-column:nth-child(6) { animation-duration: 11s; animation-delay: 1.5s; }
  .matrix-char-column:nth-child(7) { animation-duration: 13s; animation-delay: 0.8s; }
  .matrix-char-column:nth-child(8) { animation-duration: 7s; animation-delay: 2.5s; }
  .matrix-char-column:nth-child(9) { animation-duration: 15s; animation-delay: 0.2s; }
  .matrix-char-column:nth-child(10) { animation-duration: 10s; animation-delay: 1.8s; }

  @keyframes matrixColumnFall {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(200%); }
  }

  @keyframes matrixCharChange {
    0% { opacity: 0.3; }
    50% { opacity: 1; }
    100% { opacity: 0.3; }
  }

  /* Glitch Title Effect */
  .glitch-title {
    position: relative;
    display: inline-block;
    color: var(--section-art-generator, #0f0);
    text-shadow: 0 0 10px var(--section-art-generator, #0f0);
    filter: drop-shadow(0 0 18px rgba(0, 255, 0, 0.25));
    animation: glitchTitle 3s infinite;
  }

  .glitch-title::before,
  .glitch-title::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .glitch-title::before {
    color: #f00;
    animation: glitchBefore 2s infinite;
    clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
    transform: translateX(-2px);
    opacity: 0.8;
  }

  .glitch-title::after {
    color: #0ff;
    animation: glitchAfter 2s infinite;
    clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
    transform: translateX(2px);
    opacity: 0.8;
  }

  @keyframes glitchTitle {
    0%, 90%, 100% { opacity: 1; }
    92%, 94%, 96% { opacity: 0.9; transform: translateX(1px); }
  }

  @keyframes glitchBefore {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-3px); }
    40% { transform: translateX(3px); }
    60% { transform: translateX(-1px); }
    80% { transform: translateX(2px); }
  }

  @keyframes glitchAfter {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(3px); }
    40% { transform: translateX(-3px); }
    60% { transform: translateX(2px); }
    80% { transform: translateX(-1px); }
  }

  /* Button Matrix Character Animation */
  .btn-matrix-char {
    display: inline-block;
    width: 1em;
    font-family: 'Courier New', monospace;
  }

  .btn-matrix-char::before {
    content: '>';
    animation: btnCharCycle 2s steps(1) infinite;
  }

  @keyframes btnCharCycle {
    0% { content: '>'; }
    25% { content: '>>'; }
    50% { content: '>>>'; }
    75% { content: '>>'; }
  }

  /* Canvas Overlay Cursor Animation */
  .canvas-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--section-art-generator, #0a0);
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    pointer-events: none;
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .overlay-cursor {
    animation: cursorBlink 0.8s steps(1) infinite;
    color: var(--section-art-generator, #0f0);
  }

  @keyframes cursorBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .generator-subtitle {
    text-align: center;
    color: var(--section-art-generator, #0a0);
    font-size: 0.9rem;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
    opacity: 0.8;
  }

  .generator-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    position: relative;
    z-index: 2;
    padding: 14px 12px;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(0, 25, 0, 0.35), rgba(0, 0, 0, 0.18));
    border: 1px solid rgba(0, 255, 0, 0.18);
    box-shadow: inset 0 0 22px rgba(0, 255, 0, 0.06);
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .control-group label {
    color: var(--section-art-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    text-shadow: 0 0 12px rgba(0, 255, 0, 0.25);
  }

  .control-group select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background:
      linear-gradient(180deg, rgba(0, 40, 0, 0.55), rgba(0, 5, 0, 0.55));
    color: var(--section-art-generator, #0f0);
    border: 1px solid var(--section-art-generator, #0f0);
    padding: 9px 34px 9px 12px;
    border-radius: 10px;
    font-family: 'Courier New', monospace;
    cursor: pointer;
    box-shadow: inset 0 0 18px rgba(0, 255, 0, 0.08);
    background-image:
      linear-gradient(45deg, transparent 50%, rgba(0, 255, 0, 0.9) 50%),
      linear-gradient(135deg, rgba(0, 255, 0, 0.9) 50%, transparent 50%),
      linear-gradient(180deg, rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.25));
    background-position:
      calc(100% - 18px) 50%,
      calc(100% - 12px) 50%,
      0 0;
    background-size:
      6px 6px,
      6px 6px,
      100% 100%;
    background-repeat: no-repeat;
  }

  .control-group select:hover {
    border-color: rgba(0, 255, 0, 0.85);
    box-shadow: 0 0 16px rgba(0, 255, 0, 0.18), inset 0 0 18px rgba(0, 255, 0, 0.1);
  }

  .control-group select:focus {
    outline: none;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
  }

  .generator-canvas-wrapper {
    position: relative;
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    padding: 10px;
    border-radius: 14px;
    border: 1px solid rgba(0, 255, 0, 0.18);
    background:
      radial-gradient(110% 110% at 30% 10%, rgba(0, 255, 0, 0.08), rgba(0, 0, 0, 0.35)),
      linear-gradient(180deg, rgba(0, 0, 0, 0.25), rgba(0, 20, 0, 0.12));
    box-shadow: inset 0 0 24px rgba(0, 255, 0, 0.06), 0 0 22px rgba(0, 255, 0, 0.10);
    z-index: 2;
  }

  .generator-canvas-wrapper::before {
    content: '';
    position: absolute;
    inset: 8px;
    border-radius: 12px;
    pointer-events: none;
    background: repeating-linear-gradient(180deg, rgba(0, 255, 0, 0.04) 0px, rgba(0, 255, 0, 0.04) 1px, transparent 2px, transparent 7px);
    mix-blend-mode: screen;
    opacity: 0.45;
  }

  .generator-canvas-wrapper::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 14px;
    background: radial-gradient(closest-side at 50% 50%, transparent 60%, rgba(0, 0, 0, 0.55) 100%);
    opacity: 0.65;
  }

  #generator-canvas {
    border: 2px solid var(--section-art-generator, #0f0);
    border-radius: 5px;
    background: #000;
    max-width: 100%;
    height: auto;
    filter: contrast(1.08) saturate(1.12);
  }

  .canvas-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--section-art-generator, #0a0);
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    pointer-events: none;
  }

  .generator-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
    position: relative;
    z-index: 2;
  }

  .generator-btn {
    width: auto !important;
    padding: 12px 30px !important;
    font-size: 0.9rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    background:
      radial-gradient(140% 160% at 30% 30%, rgba(0, 255, 0, 0.12), rgba(0, 0, 0, 0.85));
    border: 1px solid rgba(0, 255, 0, 0.55);
    box-shadow: 0 0 0 rgba(0, 255, 0, 0);
    position: relative;
    overflow: hidden;
  }

  .generator-btn::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.25), rgba(0, 255, 255, 0.12), rgba(0, 255, 0, 0.25), transparent);
    transform: translateX(-120%);
    transition: transform 0.5s ease;
    opacity: 0.75;
  }

  .generator-btn:hover {
    border-color: rgba(0, 255, 0, 0.95);
    box-shadow: 0 0 22px rgba(0, 255, 0, 0.22), inset 0 0 18px rgba(0, 255, 0, 0.08);
    transform: translateY(-1px);
  }

  .generator-btn:hover::before {
    transform: translateX(120%);
  }

  .generator-btn:active {
    transform: translateY(0px);
    box-shadow: 0 0 16px rgba(0, 255, 0, 0.16), inset 0 0 22px rgba(0, 255, 0, 0.12);
  }

  .generator-btn:focus-visible,
  .control-group select:focus-visible {
    outline: 2px solid rgba(0, 255, 255, 0.65);
    outline-offset: 3px;
  }

  .generator-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  @media (prefers-reduced-motion: reduce) {
    .matrix-char-column,
    .glitch-title,
    .image-generator-panel::after,
    .btn-matrix-char::before {
      animation: none !important;
    }
    .generator-btn,
    .matrix-ai-video-icon,
    .matrix-ai-video-panel::before {
      transition: none !important;
    }
  }
</style>

<script>
  const genCanvas = document.getElementById('generator-canvas');
  const genCtx = genCanvas.getContext('2d');
  const genStyleSelect = document.getElementById('gen-style');
  const genColorSelect = document.getElementById('gen-color');
  const genIntensitySelect = document.getElementById('gen-intensity');
  const genEffectSelect = document.getElementById('gen-effect');
  const generateBtn = document.getElementById('generate-btn');
  const downloadBtn = document.getElementById('download-btn');
  const saveToArchiveBtn = document.getElementById('save-to-archive-btn');
  const canvasOverlay = document.getElementById('canvas-overlay');

  const matrixCharsGen = '„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';

  const intensityMultipliers = {
    low: 0.5,
    medium: 1,
    high: 1.5,
    extreme: 2.5,
    ultra: 4
  };

  function getActiveColor() {
    let color = genColorSelect.value;

    // Handle special color modes
    if (color === 'theme') {
      // Get theme color from CSS variable
      const style = getComputedStyle(document.documentElement);
      color = style.getPropertyValue('--theme-primary').trim() || '#00ff00';
    } else if (color === 'rainbow') {
      // Return a function that generates rainbow colors
      return 'rainbow';
    } else if (color === 'matrix-fade') {
      return 'matrix-fade';
    }

    return color;
  }

  function getRainbowColor(index, total) {
    const hue = (index / total) * 360;
    return `hsl(${hue}, 100%, 50%)`;
  }

  function getMatrixFadeColor(y, height) {
    // Creates a green gradient that fades from bright to dark
    const brightness = 1 - (y / height) * 0.7;
    const green = Math.floor(255 * brightness);
    return `rgb(0, ${green}, ${Math.floor(green * 0.4)})`;
  }

  function generateImage() {
    const style = genStyleSelect.value;
    const color = getActiveColor();
    const intensity = intensityMultipliers[genIntensitySelect.value];
    const effect = genEffectSelect.value;

    canvasOverlay.style.display = 'none';
    genCtx.fillStyle = '#000';
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    switch(style) {
      case 'rain':
        generateRain(color, intensity);
        break;
      case 'circuit':
        generateCircuit(color, intensity);
        break;
      case 'glitch':
        generateGlitch(color, intensity);
        break;
      case 'code':
        generateBinaryCode(color, intensity);
        break;
      case 'hex':
        generateHexGrid(color, intensity);
        break;
      case 'particles':
        generateParticles(color, intensity);
        break;
      case 'waves':
        generateWaves(color, intensity);
        break;
      case 'fractals':
        generateFractals(color, intensity);
        break;
      case 'neural':
        generateNeuralNetwork(color, intensity);
        break;
      case 'datastream':
        generateDataStream(color, intensity);
        break;
      case 'cyberpunk':
        generateCyberpunk(color, intensity);
        break;
      case 'movie-classic':
        generateMovieClassic(color, intensity);
        break;
      case 'movie-bullet-time':
        generateMovieBulletTime(color, intensity);
        break;
      case 'movie-agent':
        generateMovieAgentMirror(color, intensity);
        break;
      case 'movie-architect':
        generateMovieArchitect(color, intensity);
        break;
      case 'movie-zion':
        generateMovieZion(color, intensity);
        break;
      case 'movie-sentinels':
        generateMovieSentinels(color, intensity);
        break;
    }

    // Apply post-processing effects
    applyEffect(effect, color);

    downloadBtn.disabled = false;
    saveToArchiveBtn.disabled = false;
  }

  // Post-processing effects
  function applyEffect(effect, color) {
    if (effect === 'none') return;

    const imageData = genCtx.getImageData(0, 0, genCanvas.width, genCanvas.height);
    const data = imageData.data;

    switch(effect) {
      case 'scanlines':
        for (let y = 0; y < genCanvas.height; y += 3) {
          genCtx.fillStyle = 'rgba(0, 0, 0, 0.3)';
          genCtx.fillRect(0, y, genCanvas.width, 1);
        }
        break;
      case 'vignette':
        const gradient = genCtx.createRadialGradient(
          genCanvas.width / 2, genCanvas.height / 2, 0,
          genCanvas.width / 2, genCanvas.height / 2, genCanvas.width * 0.7
        );
        gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0.8)');
        genCtx.fillStyle = gradient;
        genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);
        break;
      case 'noise':
        for (let i = 0; i < data.length; i += 4) {
          const noise = (Math.random() - 0.5) * 30;
          data[i] += noise;
          data[i + 1] += noise;
          data[i + 2] += noise;
        }
        genCtx.putImageData(imageData, 0, 0);
        break;
      case 'chromatic':
        // Simple chromatic aberration
        const offsetData = genCtx.getImageData(0, 0, genCanvas.width, genCanvas.height);
        for (let i = 0; i < data.length; i += 4) {
          const offset = 8;
          if (i + offset * 4 < data.length) {
            data[i] = offsetData.data[i + offset * 4]; // Red channel offset
          }
          if (i - offset * 4 >= 0) {
            data[i + 2] = offsetData.data[i - offset * 4 + 2]; // Blue channel offset
          }
        }
        genCtx.putImageData(imageData, 0, 0);
        break;
    }
  }

  // New style: Neural Network
  function generateNeuralNetwork(color, intensity) {
    const nodeCount = Math.floor(40 * intensity);
    const nodes = [];

    // Create nodes
    for (let i = 0; i < nodeCount; i++) {
      nodes.push({
        x: Math.random() * genCanvas.width,
        y: Math.random() * genCanvas.height,
        layer: Math.floor(Math.random() * 4)
      });
    }

    // Draw connections
    genCtx.lineWidth = 1;
    for (let i = 0; i < nodes.length; i++) {
      for (let j = i + 1; j < nodes.length; j++) {
        const dist = Math.sqrt(
          Math.pow(nodes[i].x - nodes[j].x, 2) +
          Math.pow(nodes[i].y - nodes[j].y, 2)
        );

        if (dist < 100 * intensity && Math.abs(nodes[i].layer - nodes[j].layer) <= 1) {
          const activeColor = color === 'rainbow' ? getRainbowColor(i, nodes.length) :
                             color === 'matrix-fade' ? getMatrixFadeColor(nodes[i].y, genCanvas.height) : color;
          genCtx.beginPath();
          genCtx.moveTo(nodes[i].x, nodes[i].y);
          genCtx.lineTo(nodes[j].x, nodes[j].y);
          genCtx.strokeStyle = adjustBrightness(activeColor, 0.3);
          genCtx.stroke();
        }
      }
    }

    // Draw nodes
    nodes.forEach((node, i) => {
      const activeColor = color === 'rainbow' ? getRainbowColor(i, nodes.length) :
                         color === 'matrix-fade' ? getMatrixFadeColor(node.y, genCanvas.height) : color;
      const radius = 3 + node.layer * 2;

      // Glow
      genCtx.beginPath();
      genCtx.arc(node.x, node.y, radius + 5, 0, Math.PI * 2);
      genCtx.fillStyle = adjustBrightness(activeColor, 0.2);
      genCtx.fill();

      // Node
      genCtx.beginPath();
      genCtx.arc(node.x, node.y, radius, 0, Math.PI * 2);
      genCtx.fillStyle = activeColor;
      genCtx.fill();
    });

    // Add floating characters
    genCtx.font = '10px monospace';
    for (let i = 0; i < 30 * intensity; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const char = matrixCharsGen[Math.floor(Math.random() * matrixCharsGen.length)];
      const activeColor = color === 'rainbow' ? getRainbowColor(i, 30) :
                         color === 'matrix-fade' ? getMatrixFadeColor(y, genCanvas.height) : color;
      genCtx.fillStyle = adjustBrightness(activeColor, 0.5);
      genCtx.fillText(char, x, y);
    }
  }

  // New style: Data Stream
  function generateDataStream(color, intensity) {
    const streamCount = Math.floor(15 * intensity);

    for (let s = 0; s < streamCount; s++) {
      const startX = (genCanvas.width / streamCount) * s + Math.random() * 20;
      const activeColor = color === 'rainbow' ? getRainbowColor(s, streamCount) :
                         color === 'matrix-fade' ? getMatrixFadeColor(s * 20, genCanvas.height) : color;

      // Draw stream line
      genCtx.beginPath();
      genCtx.moveTo(startX, 0);
      let x = startX;
      for (let y = 0; y < genCanvas.height; y += 10) {
        x += (Math.random() - 0.5) * 20;
        genCtx.lineTo(x, y);
      }
      genCtx.strokeStyle = adjustBrightness(activeColor, 0.3);
      genCtx.lineWidth = 2;
      genCtx.stroke();

      // Add data packets
      x = startX;
      for (let y = 0; y < genCanvas.height; y += 30 + Math.random() * 20) {
        x += (Math.random() - 0.5) * 15;
        const packetSize = 5 + Math.random() * 10;

        genCtx.fillStyle = activeColor;
        genCtx.fillRect(x - packetSize / 2, y, packetSize, 3);

        // Binary text next to packets
        if (Math.random() > 0.5) {
          genCtx.font = '8px monospace';
          genCtx.fillStyle = adjustBrightness(activeColor, 0.7);
          const binary = Math.floor(Math.random() * 256).toString(2).padStart(8, '0');
          genCtx.fillText(binary, x + 10, y + 3);
        }
      }
    }

    // Add horizontal scan lines
    for (let y = 0; y < genCanvas.height; y += 40 + Math.random() * 30) {
      const activeColor = color === 'rainbow' ? getRainbowColor(y, genCanvas.height) :
                         color === 'matrix-fade' ? getMatrixFadeColor(y, genCanvas.height) : color;
      genCtx.fillStyle = adjustBrightness(activeColor, 0.1);
      genCtx.fillRect(0, y, genCanvas.width, 2);
    }
  }

  // New style: Cyberpunk City
  function generateCyberpunk(color, intensity) {
    // Draw background gradient
    const bgGradient = genCtx.createLinearGradient(0, 0, 0, genCanvas.height);
    bgGradient.addColorStop(0, '#0a0015');
    bgGradient.addColorStop(1, '#000510');
    genCtx.fillStyle = bgGradient;
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    // Draw buildings
    const buildingCount = Math.floor(12 * intensity);
    for (let i = 0; i < buildingCount; i++) {
      const x = (genCanvas.width / buildingCount) * i;
      const width = 20 + Math.random() * 30;
      const height = 50 + Math.random() * 150;
      const y = genCanvas.height - height;

      const activeColor = color === 'rainbow' ? getRainbowColor(i, buildingCount) :
                         color === 'matrix-fade' ? getMatrixFadeColor(y, genCanvas.height) : color;

      // Building body
      genCtx.fillStyle = '#0a0a0a';
      genCtx.fillRect(x, y, width, height);

      // Building outline
      genCtx.strokeStyle = adjustBrightness(activeColor, 0.5);
      genCtx.lineWidth = 1;
      genCtx.strokeRect(x, y, width, height);

      // Windows
      for (let wy = y + 10; wy < genCanvas.height - 10; wy += 15) {
        for (let wx = x + 5; wx < x + width - 5; wx += 10) {
          if (Math.random() > 0.3) {
            genCtx.fillStyle = Math.random() > 0.5 ? activeColor : adjustBrightness(activeColor, 0.3);
            genCtx.fillRect(wx, wy, 4, 6);
          }
        }
      }
    }

    // Add neon signs
    const signCount = Math.floor(5 * intensity);
    for (let i = 0; i < signCount; i++) {
      const x = Math.random() * (genCanvas.width - 60);
      const y = 50 + Math.random() * 100;
      const activeColor = color === 'rainbow' ? getRainbowColor(i, signCount) :
                         color === 'matrix-fade' ? getMatrixFadeColor(y, genCanvas.height) : color;

      genCtx.font = 'bold 12px monospace';
      genCtx.fillStyle = activeColor;
      genCtx.shadowColor = activeColor;
      genCtx.shadowBlur = 15;

      const signs = ['CYBER', 'NEON', 'HACK', 'CODE', 'DATA', 'NET'];
      genCtx.fillText(signs[Math.floor(Math.random() * signs.length)], x, y);
      genCtx.shadowBlur = 0;
    }

    // Add rain
    genCtx.strokeStyle = adjustBrightness(color === 'rainbow' ? '#00ffff' :
                                          color === 'matrix-fade' ? '#00ff00' : color, 0.2);
    genCtx.lineWidth = 1;
    for (let i = 0; i < 100 * intensity; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const length = 5 + Math.random() * 15;
      genCtx.beginPath();
      genCtx.moveTo(x, y);
      genCtx.lineTo(x, y + length);
      genCtx.stroke();
    }
  }

  function getActiveColorAt(color, index, total, y) {
    if (color === 'rainbow') return getRainbowColor(index, total);
    if (color === 'matrix-fade') return getMatrixFadeColor(y, genCanvas.height);
    return color;
  }

  function applyCinematicGrade(color, intensity) {
    // Subtle green tint / contrast lift without overriding the user's effect selection.
    const tint = genCtx.createLinearGradient(0, 0, 0, genCanvas.height);
    const top = color === 'rainbow' || color === 'matrix-fade' ? '#00ff00' : color;
    tint.addColorStop(0, 'rgba(0, 0, 0, 0)');
    tint.addColorStop(1, 'rgba(0, 0, 0, 0.25)');
    genCtx.fillStyle = tint;
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    // Film grain
    const imageData = genCtx.getImageData(0, 0, genCanvas.width, genCanvas.height);
    const data = imageData.data;
    const strength = Math.max(4, Math.floor(10 * intensity));
    for (let i = 0; i < data.length; i += 4) {
      const n = (Math.random() - 0.5) * strength;
      data[i] = Math.min(255, Math.max(0, data[i] + n));
      data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + n));
      data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + n));
    }
    genCtx.putImageData(imageData, 0, 0);

    // Scanlines
    genCtx.fillStyle = 'rgba(0, 0, 0, 0.18)';
    for (let y = 0; y < genCanvas.height; y += 4) {
      genCtx.fillRect(0, y, genCanvas.width, 1);
    }

    // HUD corners
    genCtx.strokeStyle = adjustBrightness(top, 0.5);
    genCtx.lineWidth = 1;
    const inset = 10;
    const corner = 14;
    genCtx.beginPath();
    genCtx.moveTo(inset, inset + corner);
    genCtx.lineTo(inset, inset);
    genCtx.lineTo(inset + corner, inset);
    genCtx.moveTo(genCanvas.width - inset - corner, inset);
    genCtx.lineTo(genCanvas.width - inset, inset);
    genCtx.lineTo(genCanvas.width - inset, inset + corner);
    genCtx.moveTo(inset, genCanvas.height - inset - corner);
    genCtx.lineTo(inset, genCanvas.height - inset);
    genCtx.lineTo(inset + corner, genCanvas.height - inset);
    genCtx.moveTo(genCanvas.width - inset - corner, genCanvas.height - inset);
    genCtx.lineTo(genCanvas.width - inset, genCanvas.height - inset);
    genCtx.lineTo(genCanvas.width - inset, genCanvas.height - inset - corner);
    genCtx.stroke();
  }

  function generateMovieClassic(color, intensity) {
    // Dense codefall + cinematic grade.
    generateRain(color === 'matrix-fade' ? '#00ff00' : color, intensity * 1.25);

    // Add bright head streaks
    const streaks = Math.floor(12 * intensity);
    for (let i = 0; i < streaks; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const h = 20 + Math.random() * 80;
      genCtx.fillStyle = 'rgba(255, 255, 255, 0.08)';
      genCtx.fillRect(x, y, 2, h);
    }

    applyCinematicGrade(color, intensity);
  }

  function generateMovieBulletTime(color, intensity) {
    // Radial burst lines + floating glyphs.
    const cx = genCanvas.width / 2;
    const cy = genCanvas.height / 2;

    genCtx.fillStyle = '#000';
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    const rays = Math.floor(180 * intensity);
    for (let i = 0; i < rays; i++) {
      const a = (i / rays) * Math.PI * 2 + (Math.random() - 0.5) * 0.02;
      const r = Math.min(genCanvas.width, genCanvas.height) * (0.35 + Math.random() * 0.7);
      const x = cx + Math.cos(a) * r;
      const y = cy + Math.sin(a) * r;
      const activeColor = getActiveColorAt(color, i, rays, y);
      genCtx.strokeStyle = adjustBrightness(activeColor, 0.4 + Math.random() * 0.4);
      genCtx.globalAlpha = 0.15 + Math.random() * 0.35;
      genCtx.lineWidth = 1 + Math.random() * 2;
      genCtx.beginPath();
      genCtx.moveTo(cx, cy);
      genCtx.lineTo(x, y);
      genCtx.stroke();
    }
    genCtx.globalAlpha = 1;

    // Shock rings
    const rings = Math.floor(4 + 3 * intensity);
    for (let i = 0; i < rings; i++) {
      const radius = (i + 1) * (20 + 10 * intensity);
      genCtx.beginPath();
      genCtx.arc(cx, cy, radius, 0, Math.PI * 2);
      genCtx.strokeStyle = adjustBrightness(color === 'matrix-fade' ? '#00ff00' : color, 0.35);
      genCtx.globalAlpha = 0.25;
      genCtx.lineWidth = 1;
      genCtx.stroke();
    }
    genCtx.globalAlpha = 1;

    // Floating characters
    const charCount = Math.floor(90 * intensity);
    for (let i = 0; i < charCount; i++) {
      const x = cx + (Math.random() - 0.5) * genCanvas.width * 0.9;
      const y = cy + (Math.random() - 0.5) * genCanvas.height * 0.9;
      const ch = matrixCharsGen[Math.floor(Math.random() * matrixCharsGen.length)];
      const activeColor = getActiveColorAt(color, i, charCount, y);
      genCtx.font = `${10 + Math.random() * 10}px monospace`;
      genCtx.fillStyle = adjustBrightness(activeColor, 0.35 + Math.random() * 0.5);
      genCtx.globalAlpha = 0.25 + Math.random() * 0.5;
      genCtx.fillText(ch, x, y);
    }
    genCtx.globalAlpha = 1;

    applyCinematicGrade(color, intensity);
  }

  function generateMovieAgentMirror(color, intensity) {
    // Symmetry + harsh glitches to mimic a "mirror" agent presence.
    generateGlitch(color === 'matrix-fade' ? '#00ff00' : color);
    generateCircuit(color === 'rainbow' || color === 'matrix-fade' ? '#00ff00' : color);

    // Mirror seam
    const seamX = genCanvas.width / 2;
    genCtx.fillStyle = 'rgba(255, 255, 255, 0.06)';
    genCtx.fillRect(seamX - 1, 0, 2, genCanvas.height);

    // Copy left half to right with slight offset to feel "wrong"
    const left = genCtx.getImageData(0, 0, Math.floor(seamX), genCanvas.height);
    genCtx.save();
    genCtx.scale(-1, 1);
    genCtx.globalAlpha = 0.9;
    genCtx.putImageData(left, -genCanvas.width + (Math.random() - 0.5) * 6, (Math.random() - 0.5) * 4);
    genCtx.restore();
    genCtx.globalAlpha = 1;

    // Add small "agent code" headers
    const headerColor = color === 'rainbow' || color === 'matrix-fade' ? '#00ff00' : color;
    genCtx.fillStyle = adjustBrightness(headerColor, 0.7);
    genCtx.font = 'bold 10px monospace';
    genCtx.fillText('AGENT', 12, 18);
    genCtx.fillText('MIRROR', 12, 32);

    applyCinematicGrade(color, intensity);
  }

  function generateMovieArchitect(color, intensity) {
    // Bright, minimal geometric composition.
    genCtx.fillStyle = '#f6f6f6';
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    const accent = color === 'rainbow' || color === 'matrix-fade' ? '#00aa00' : color;

    // Soft grid
    genCtx.strokeStyle = 'rgba(0, 0, 0, 0.06)';
    genCtx.lineWidth = 1;
    for (let x = 0; x < genCanvas.width; x += 20) {
      genCtx.beginPath();
      genCtx.moveTo(x, 0);
      genCtx.lineTo(x, genCanvas.height);
      genCtx.stroke();
    }
    for (let y = 0; y < genCanvas.height; y += 20) {
      genCtx.beginPath();
      genCtx.moveTo(0, y);
      genCtx.lineTo(genCanvas.width, y);
      genCtx.stroke();
    }

    // Minimal blocks + labels
    const blocks = Math.floor(10 * intensity);
    for (let i = 0; i < blocks; i++) {
      const x = 10 + Math.random() * (genCanvas.width - 80);
      const y = 10 + Math.random() * (genCanvas.height - 60);
      const w = 40 + Math.random() * 90;
      const h = 18 + Math.random() * 40;
      genCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      genCtx.fillRect(x, y, w, h);
      genCtx.strokeStyle = adjustBrightness(accent, 0.8);
      genCtx.strokeRect(x, y, w, h);

      genCtx.fillStyle = 'rgba(0, 0, 0, 0.55)';
      genCtx.font = '9px monospace';
      genCtx.fillText(`NODE_${Math.floor(Math.random() * 999)}`, x + 6, y + 12);
    }

    // Light vignette for depth
    const gradient = genCtx.createRadialGradient(
      genCanvas.width / 2, genCanvas.height / 2, 0,
      genCanvas.width / 2, genCanvas.height / 2, genCanvas.width * 0.8
    );
    gradient.addColorStop(0, 'rgba(255, 255, 255, 0)');
    gradient.addColorStop(1, 'rgba(0, 0, 0, 0.15)');
    genCtx.fillStyle = gradient;
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);
  }

  function generateMovieZion(color, intensity) {
    // Industrial warm tones + cables and sparks.
    const bg = genCtx.createLinearGradient(0, 0, 0, genCanvas.height);
    bg.addColorStop(0, '#120b05');
    bg.addColorStop(1, '#000000');
    genCtx.fillStyle = bg;
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    const accent = color === 'rainbow' || color === 'matrix-fade' ? '#ff6600' : color;

    // Beams
    genCtx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
    genCtx.lineWidth = 2;
    for (let i = 0; i < 10 * intensity; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      genCtx.beginPath();
      genCtx.moveTo(x, y);
      genCtx.lineTo(x + (Math.random() - 0.5) * 220, y + (Math.random() - 0.5) * 120);
      genCtx.stroke();
    }

    // Cables
    genCtx.strokeStyle = adjustBrightness(accent, 0.5);
    genCtx.lineWidth = 1;
    for (let i = 0; i < 20 * intensity; i++) {
      const x0 = Math.random() * genCanvas.width;
      const y0 = Math.random() * genCanvas.height;
      genCtx.beginPath();
      genCtx.moveTo(x0, y0);
      for (let s = 0; s < 6; s++) {
        genCtx.lineTo(
          x0 + (s + 1) * (Math.random() - 0.5) * 25,
          y0 + (s + 1) * (Math.random() - 0.5) * 22
        );
      }
      genCtx.stroke();
    }

    // Sparks
    const sparks = Math.floor(120 * intensity);
    for (let i = 0; i < sparks; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const activeColor = getActiveColorAt(accent, i, sparks, y);
      genCtx.fillStyle = adjustBrightness(activeColor, 0.6 + Math.random() * 0.6);
      genCtx.globalAlpha = 0.15 + Math.random() * 0.6;
      genCtx.fillRect(x, y, 1 + Math.random() * 2, 1 + Math.random() * 2);
    }
    genCtx.globalAlpha = 1;

    applyCinematicGrade(accent, intensity);
  }

  function generateMovieSentinels(color, intensity) {
    // Swirling tentacles and nodes.
    genCtx.fillStyle = '#000';
    genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);

    const tentacles = Math.floor(6 * intensity);
    for (let t = 0; t < tentacles; t++) {
      const x0 = Math.random() * genCanvas.width;
      const y0 = Math.random() * genCanvas.height;
      const segments = 18 + Math.floor(Math.random() * 18);
      genCtx.beginPath();
      genCtx.moveTo(x0, y0);
      let x = x0;
      let y = y0;
      for (let s = 0; s < segments; s++) {
        x += (Math.random() - 0.5) * 28;
        y += (Math.random() - 0.5) * 22;
        genCtx.lineTo(x, y);
      }
      const activeColor = getActiveColorAt(color, t, tentacles, y0);
      genCtx.strokeStyle = adjustBrightness(activeColor === 'matrix-fade' ? '#00ff00' : activeColor, 0.45);
      genCtx.lineWidth = 1.5;
      genCtx.globalAlpha = 0.35;
      genCtx.stroke();
    }
    genCtx.globalAlpha = 1;

    // Nodes/eyes
    const nodes = Math.floor(30 * intensity);
    for (let i = 0; i < nodes; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const r = 2 + Math.random() * 6;
      const activeColor = getActiveColorAt(color, i, nodes, y);
      genCtx.beginPath();
      genCtx.arc(x, y, r, 0, Math.PI * 2);
      genCtx.fillStyle = adjustBrightness(activeColor, 0.8);
      genCtx.globalAlpha = 0.25 + Math.random() * 0.55;
      genCtx.fill();
    }
    genCtx.globalAlpha = 1;

    applyCinematicGrade(color, intensity);
  }

  function generateRain(color, intensity) {
    const fontSize = 14;
    const columns = Math.floor(genCanvas.width / fontSize);

    for (let frame = 0; frame < 50; frame++) {
      genCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
      genCtx.fillRect(0, 0, genCanvas.width, genCanvas.height);
    }

    for (let i = 0; i < columns; i++) {
      const x = i * fontSize;
      const streamLength = Math.floor(Math.random() * 15) + 5;
      const startY = Math.random() * genCanvas.height;

      for (let j = 0; j < streamLength; j++) {
        const char = matrixCharsGen[Math.floor(Math.random() * matrixCharsGen.length)];
        const y = startY + j * fontSize;

        if (y > genCanvas.height) continue;

        const brightness = 1 - (j / streamLength);
        genCtx.fillStyle = adjustBrightness(color, brightness);
        genCtx.font = fontSize + 'px monospace';
        genCtx.fillText(char, x, y);
      }
    }

    // Add some bright "head" characters
    for (let i = 0; i < 20; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const char = matrixCharsGen[Math.floor(Math.random() * matrixCharsGen.length)];
      genCtx.fillStyle = '#fff';
      genCtx.font = '14px monospace';
      genCtx.fillText(char, x, y);
    }
  }

  function generateCircuit(color) {
    genCtx.strokeStyle = color;
    genCtx.lineWidth = 2;

    // Draw circuit paths
    for (let i = 0; i < 30; i++) {
      genCtx.beginPath();
      let x = Math.random() * genCanvas.width;
      let y = Math.random() * genCanvas.height;
      genCtx.moveTo(x, y);

      for (let j = 0; j < Math.random() * 5 + 2; j++) {
        if (Math.random() > 0.5) {
          x += (Math.random() - 0.5) * 100;
        } else {
          y += (Math.random() - 0.5) * 100;
        }
        genCtx.lineTo(x, y);
      }

      genCtx.globalAlpha = Math.random() * 0.5 + 0.3;
      genCtx.stroke();
    }

    // Draw nodes
    genCtx.globalAlpha = 1;
    for (let i = 0; i < 40; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const radius = Math.random() * 4 + 2;

      genCtx.beginPath();
      genCtx.arc(x, y, radius, 0, Math.PI * 2);
      genCtx.fillStyle = color;
      genCtx.fill();

      // Glow effect
      genCtx.beginPath();
      genCtx.arc(x, y, radius + 3, 0, Math.PI * 2);
      genCtx.fillStyle = adjustBrightness(color, 0.3);
      genCtx.fill();
    }
  }

  function generateGlitch(color) {
    // Create base pattern
    for (let i = 0; i < genCanvas.height; i += 2) {
      genCtx.fillStyle = Math.random() > 0.5 ? adjustBrightness(color, Math.random()) : '#000';
      genCtx.fillRect(0, i, genCanvas.width, 1);
    }

    // Add glitch blocks
    for (let i = 0; i < 15; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const w = Math.random() * 100 + 20;
      const h = Math.random() * 30 + 5;

      genCtx.fillStyle = color;
      genCtx.globalAlpha = Math.random() * 0.7 + 0.3;
      genCtx.fillRect(x, y, w, h);
    }

    // Add scan lines
    genCtx.globalAlpha = 0.1;
    for (let i = 0; i < genCanvas.height; i += 4) {
      genCtx.fillStyle = '#000';
      genCtx.fillRect(0, i, genCanvas.width, 2);
    }

    // Add random offset blocks
    genCtx.globalAlpha = 1;
    for (let i = 0; i < 5; i++) {
      const y = Math.random() * genCanvas.height;
      const h = Math.random() * 20 + 5;
      const offset = (Math.random() - 0.5) * 40;

      const imageData = genCtx.getImageData(0, y, genCanvas.width, h);
      genCtx.fillStyle = '#000';
      genCtx.fillRect(0, y, genCanvas.width, h);
      genCtx.putImageData(imageData, offset, y);
    }
  }

  function generateBinaryCode(color) {
    const fontSize = 10;
    genCtx.font = fontSize + 'px monospace';

    for (let y = 0; y < genCanvas.height; y += fontSize) {
      let line = '';
      for (let x = 0; x < genCanvas.width / (fontSize * 0.6); x++) {
        line += Math.random() > 0.5 ? '1' : '0';
      }

      genCtx.fillStyle = adjustBrightness(color, Math.random() * 0.5 + 0.3);
      genCtx.fillText(line, 0, y + fontSize);
    }

    // Add highlight rectangles
    for (let i = 0; i < 8; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const w = Math.random() * 80 + 30;
      const h = Math.random() * 40 + 15;

      genCtx.strokeStyle = color;
      genCtx.lineWidth = 2;
      genCtx.strokeRect(x, y, w, h);

      genCtx.fillStyle = adjustBrightness(color, 0.1);
      genCtx.fillRect(x, y, w, h);
    }
  }

  // New style: Hexagonal Grid
  function generateHexGrid(color, intensity) {
    const hexSize = 20;
    const hexHeight = hexSize * Math.sqrt(3);
    const cols = Math.ceil(genCanvas.width / (hexSize * 1.5)) + 1;
    const rows = Math.ceil(genCanvas.height / hexHeight) + 1;

    for (let row = 0; row < rows * intensity; row++) {
      for (let col = 0; col < cols * intensity; col++) {
        const x = col * hexSize * 1.5;
        const y = row * hexHeight + (col % 2 ? hexHeight / 2 : 0);

        const activeColor = color === 'rainbow' ? getRainbowColor(row * cols + col, rows * cols) : color;

        if (Math.random() > 0.3) {
          drawHexagon(x, y, hexSize * 0.8, activeColor, Math.random() * 0.8 + 0.2);
        }
      }
    }
  }

  function drawHexagon(cx, cy, size, color, alpha) {
    genCtx.beginPath();
    for (let i = 0; i < 6; i++) {
      const angle = (Math.PI / 3) * i - Math.PI / 6;
      const x = cx + size * Math.cos(angle);
      const y = cy + size * Math.sin(angle);
      if (i === 0) genCtx.moveTo(x, y);
      else genCtx.lineTo(x, y);
    }
    genCtx.closePath();

    genCtx.globalAlpha = alpha;
    genCtx.strokeStyle = color;
    genCtx.lineWidth = 2;
    genCtx.stroke();

    if (Math.random() > 0.7) {
      genCtx.fillStyle = adjustBrightness(color, 0.2);
      genCtx.fill();
    }
    genCtx.globalAlpha = 1;
  }

  // New style: Particle Storm
  function generateParticles(color, intensity) {
    const particleCount = Math.floor(300 * intensity);

    // Draw particle trails
    for (let i = 0; i < particleCount; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const size = Math.random() * 4 + 1;
      const trailLength = Math.random() * 30 + 10;
      const angle = Math.random() * Math.PI * 2;

      const activeColor = color === 'rainbow' ? getRainbowColor(i, particleCount) : color;

      // Draw trail
      genCtx.beginPath();
      genCtx.moveTo(x, y);
      genCtx.lineTo(
        x + Math.cos(angle) * trailLength,
        y + Math.sin(angle) * trailLength
      );

      const gradient = genCtx.createLinearGradient(
        x, y,
        x + Math.cos(angle) * trailLength,
        y + Math.sin(angle) * trailLength
      );
      gradient.addColorStop(0, activeColor);
      gradient.addColorStop(1, 'transparent');

      genCtx.strokeStyle = gradient;
      genCtx.lineWidth = size / 2;
      genCtx.stroke();

      // Draw particle head
      genCtx.beginPath();
      genCtx.arc(x, y, size, 0, Math.PI * 2);
      genCtx.fillStyle = activeColor;
      genCtx.fill();
    }

    // Add glow points
    for (let i = 0; i < 20 * intensity; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const size = Math.random() * 8 + 4;

      const activeColor = color === 'rainbow' ? getRainbowColor(i, 20) : color;

      genCtx.beginPath();
      genCtx.arc(x, y, size, 0, Math.PI * 2);
      genCtx.fillStyle = '#fff';
      genCtx.fill();

      genCtx.beginPath();
      genCtx.arc(x, y, size + 5, 0, Math.PI * 2);
      genCtx.fillStyle = adjustBrightness(activeColor, 0.3);
      genCtx.fill();
    }
  }

  // New style: Digital Waves
  function generateWaves(color, intensity) {
    const waveCount = Math.floor(8 * intensity);

    for (let w = 0; w < waveCount; w++) {
      const activeColor = color === 'rainbow' ? getRainbowColor(w, waveCount) : color;
      const amplitude = 20 + Math.random() * 40;
      const frequency = 0.01 + Math.random() * 0.03;
      const yOffset = (genCanvas.height / waveCount) * w + genCanvas.height / waveCount / 2;
      const phase = Math.random() * Math.PI * 2;

      genCtx.beginPath();
      genCtx.moveTo(0, yOffset);

      for (let x = 0; x <= genCanvas.width; x += 2) {
        const y = yOffset + Math.sin(x * frequency + phase) * amplitude;
        genCtx.lineTo(x, y);
      }

      genCtx.strokeStyle = activeColor;
      genCtx.lineWidth = 2 + Math.random() * 2;
      genCtx.globalAlpha = 0.5 + Math.random() * 0.5;
      genCtx.stroke();

      // Add data points
      for (let x = 0; x < genCanvas.width; x += 40 + Math.random() * 30) {
        const y = yOffset + Math.sin(x * frequency + phase) * amplitude;
        genCtx.beginPath();
        genCtx.arc(x, y, 3, 0, Math.PI * 2);
        genCtx.fillStyle = '#fff';
        genCtx.fill();
      }
    }

    genCtx.globalAlpha = 1;

    // Add grid lines
    genCtx.strokeStyle = adjustBrightness(color === 'rainbow' ? '#00ff00' : color, 0.2);
    genCtx.lineWidth = 1;

    for (let x = 0; x < genCanvas.width; x += 40) {
      genCtx.beginPath();
      genCtx.moveTo(x, 0);
      genCtx.lineTo(x, genCanvas.height);
      genCtx.stroke();
    }

    for (let y = 0; y < genCanvas.height; y += 40) {
      genCtx.beginPath();
      genCtx.moveTo(0, y);
      genCtx.lineTo(genCanvas.width, y);
      genCtx.stroke();
    }
  }

  // New style: Fractal Code
  function generateFractals(color, intensity) {
    const depth = Math.floor(4 * intensity);

    function drawBranch(x, y, length, angle, currentDepth) {
      if (currentDepth <= 0 || length < 2) return;

      const activeColor = color === 'rainbow' ? getRainbowColor(currentDepth, depth) : color;

      const endX = x + Math.cos(angle) * length;
      const endY = y + Math.sin(angle) * length;

      genCtx.beginPath();
      genCtx.moveTo(x, y);
      genCtx.lineTo(endX, endY);
      genCtx.strokeStyle = adjustBrightness(activeColor, currentDepth / depth);
      genCtx.lineWidth = currentDepth * 0.5;
      genCtx.stroke();

      // Draw node
      genCtx.beginPath();
      genCtx.arc(endX, endY, currentDepth, 0, Math.PI * 2);
      genCtx.fillStyle = activeColor;
      genCtx.fill();

      // Branch out
      const branchAngle = 0.4 + Math.random() * 0.3;
      drawBranch(endX, endY, length * 0.7, angle - branchAngle, currentDepth - 1);
      drawBranch(endX, endY, length * 0.7, angle + branchAngle, currentDepth - 1);

      if (Math.random() > 0.5) {
        drawBranch(endX, endY, length * 0.5, angle, currentDepth - 1);
      }
    }

    // Draw multiple fractal trees
    const treeCount = Math.floor(3 * intensity);
    for (let i = 0; i < treeCount; i++) {
      const startX = Math.random() * genCanvas.width;
      const startY = genCanvas.height;
      const startAngle = -Math.PI / 2 + (Math.random() - 0.5) * 0.5;
      const startLength = 40 + Math.random() * 40;

      drawBranch(startX, startY, startLength, startAngle, depth);
    }

    // Add floating code characters
    const charCount = Math.floor(50 * intensity);
    for (let i = 0; i < charCount; i++) {
      const x = Math.random() * genCanvas.width;
      const y = Math.random() * genCanvas.height;
      const char = matrixCharsGen[Math.floor(Math.random() * matrixCharsGen.length)];
      const activeColor = color === 'rainbow' ? getRainbowColor(i, charCount) : color;

      genCtx.font = '12px monospace';
      genCtx.fillStyle = adjustBrightness(activeColor, Math.random() * 0.5 + 0.3);
      genCtx.fillText(char, x, y);
    }
  }

  function adjustBrightness(hex, factor) {
    // Handle rainbow case
    if (hex === 'rainbow') {
      hex = '#00ff00';
    }
    if (hex === 'matrix-fade') {
      hex = '#00ff00';
    }

    // Handle rgb() format
    if (hex.startsWith('rgb')) {
      const match = hex.match(/\d+/g);
      if (match) {
        const r = Math.floor(parseInt(match[0]) * factor);
        const g = Math.floor(parseInt(match[1]) * factor);
        const b = Math.floor(parseInt(match[2]) * factor);
        return `rgb(${r}, ${g}, ${b})`;
      }
    }

    // Handle hsl() format
    if (hex.startsWith('hsl')) {
      const match = hex.match(/[\d.]+/g);
      if (match) {
        const h = match[0];
        const s = match[1];
        const l = Math.floor(parseFloat(match[2]) * factor);
        return `hsl(${h}, ${s}%, ${l}%)`;
      }
    }

    // Handle hex format
    if (!hex.startsWith('#')) return hex;

    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);

    const newR = Math.floor(r * factor);
    const newG = Math.floor(g * factor);
    const newB = Math.floor(b * factor);

    return `rgb(${newR}, ${newG}, ${newB})`;
  }

  function downloadImage() {
    const link = document.createElement('a');
    link.download = 'matrix-image-' + Date.now() + '.png';
    link.href = genCanvas.toDataURL('image/png');
    link.click();
  }

  generateBtn.addEventListener('click', generateImage);
  downloadBtn.addEventListener('click', downloadImage);

  // Archive functionality
  const ARCHIVE_KEY = 'matrixGeneratorArchive';

  function saveToArchive() {
    const dataUrl = genCanvas.toDataURL('image/png');
    const style = genStyleSelect.value;
    const color = genColorSelect.options[genColorSelect.selectedIndex].text;
    const intensity = genIntensitySelect.value;
    const effect = genEffectSelect.value;

    const creation = {
      id: Date.now(),
      imageData: dataUrl,
      style: style,
      color: color,
      intensity: intensity,
      effect: effect,
      createdAt: new Date().toISOString()
    };

    // Get existing archive
    let archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');

    // Add new creation at the beginning
    archive.unshift(creation);

    // Keep only the last 20 creations to save space
    if (archive.length > 20) {
      archive = archive.slice(0, 20);
    }

    // Save to localStorage
    localStorage.setItem(ARCHIVE_KEY, JSON.stringify(archive));

    // Update the archive display
    loadUserArchive();

    // Show success feedback
    const btn = saveToArchiveBtn;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<span class="btn-matrix-char"></span> SAVED!';
    btn.style.background = 'var(--theme-primary, #0f0)';
    btn.style.color = '#000';
    setTimeout(() => {
      btn.innerHTML = originalText;
      btn.style.background = '';
      btn.style.color = '';
    }, 1500);
  }

  saveToArchiveBtn.addEventListener('click', saveToArchive);
  saveToArchiveBtn.disabled = true;
</script>

<!-- MATRIX CREATION ARCHIVE - User Generated Content -->
<div class="container">
  <div class="panel matrix-archive-panel">
    <!-- Animated Matrix Background for Archive -->
    <div class="archive-matrix-bg">
      <div class="archive-char-stream" style="left: 10%;"></div>
      <div class="archive-char-stream" style="left: 30%;"></div>
      <div class="archive-char-stream" style="left: 50%;"></div>
      <div class="archive-char-stream" style="left: 70%;"></div>
      <div class="archive-char-stream" style="left: 90%;"></div>
    </div>

    <h2 style="text-align: center; margin-bottom: 5px; position: relative; z-index: 2;">
      <span class="archive-glitch-title" data-text="CREATION ARCHIVE">CREATION ARCHIVE</span>
    </h2>
    <p class="archive-subtitle">Your generated Matrix creations stored locally</p>

    <div class="archive-stats" id="archive-stats">
      <span class="stat-item"><span class="stat-icon">></span> Creations: <span id="creation-count">0</span></span>
      <span class="stat-item"><span class="stat-icon">></span> Storage: <span id="storage-used">0 KB</span></span>
    </div>

    <div class="archive-controls">
      <button class="btn archive-control-btn" onclick="clearArchive()">
        <span class="btn-matrix-char"></span> CLEAR ALL
      </button>
      <button class="btn archive-control-btn" onclick="exportArchive()">
        <span class="btn-matrix-char"></span> EXPORT
      </button>
    </div>

    <!-- User's saved creations -->
    <div id="user-archive-gallery" class="user-archive-gallery">
      <div class="archive-empty-state" id="archive-empty">
        <div class="empty-icon">[ ]</div>
        <p>No creations saved yet</p>
        <p class="empty-hint">Generate an image above and click "SAVE TO ARCHIVE"</p>
      </div>
    </div>
  </div>
</div>

<style>
  .matrix-archive-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: var(--theme-border, #0f0);
    border: 2px solid var(--theme-border, #0f0);
    position: relative;
    overflow: hidden;
  }

  /* Animated Matrix Background for Archive */
  .archive-matrix-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    pointer-events: none;
    opacity: 0.1;
    z-index: 0;
  }

  .archive-char-stream {
    position: absolute;
    top: -50%;
    width: 20px;
    height: 200%;
    background: linear-gradient(
      to bottom,
      transparent,
      var(--theme-primary, #0f0) 20%,
      var(--theme-primary, #0f0) 80%,
      transparent
    );
    animation: archiveStreamFall 10s linear infinite;
    opacity: 0.3;
  }

  .archive-char-stream:nth-child(1) { animation-duration: 12s; animation-delay: 0s; }
  .archive-char-stream:nth-child(2) { animation-duration: 15s; animation-delay: 2s; }
  .archive-char-stream:nth-child(3) { animation-duration: 10s; animation-delay: 1s; }
  .archive-char-stream:nth-child(4) { animation-duration: 14s; animation-delay: 3s; }
  .archive-char-stream:nth-child(5) { animation-duration: 11s; animation-delay: 0.5s; }

  @keyframes archiveStreamFall {
    0% { transform: translateY(-50%); }
    100% { transform: translateY(50%); }
  }

  /* Archive Glitch Title */
  .archive-glitch-title {
    position: relative;
    display: inline-block;
    color: var(--theme-primary, #0f0);
    text-shadow: 0 0 10px var(--theme-glow, #0f0);
    font-family: 'Courier New', monospace;
    letter-spacing: 3px;
  }

  .archive-glitch-title::before,
  .archive-glitch-title::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
  }

  .archive-glitch-title:hover::before {
    color: #f00;
    animation: archiveGlitch1 0.3s infinite;
    opacity: 0.8;
  }

  .archive-glitch-title:hover::after {
    color: #0ff;
    animation: archiveGlitch2 0.3s infinite;
    opacity: 0.8;
  }

  @keyframes archiveGlitch1 {
    0%, 100% { transform: translate(0); }
    33% { transform: translate(-2px, 1px); }
    66% { transform: translate(2px, -1px); }
  }

  @keyframes archiveGlitch2 {
    0%, 100% { transform: translate(0); }
    33% { transform: translate(2px, -1px); }
    66% { transform: translate(-2px, 1px); }
  }

  .archive-subtitle {
    text-align: center;
    color: var(--theme-text, #0a0);
    font-size: 0.85rem;
    margin-bottom: 15px;
    font-family: 'Courier New', monospace;
    position: relative;
    z-index: 2;
  }

  .archive-stats {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-bottom: 15px;
    position: relative;
    z-index: 2;
  }

  .stat-item {
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: var(--theme-text, #0f0);
  }

  .stat-icon {
    color: var(--theme-primary, #0f0);
    margin-right: 5px;
  }

  .archive-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    position: relative;
    z-index: 2;
  }

  .archive-control-btn {
    width: auto !important;
    padding: 8px 16px !important;
    font-size: 0.8rem;
    background: transparent !important;
    border: 1px dashed var(--theme-border, #0f0) !important;
  }

  .archive-control-btn:hover {
    background: rgba(0, 255, 0, 0.1) !important;
    border-style: solid !important;
  }

  .user-archive-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
    padding: 10px 0;
    position: relative;
    z-index: 2;
    min-height: 100px;
  }

  .archive-empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 40px 20px;
    color: var(--theme-text, #0a0);
    font-family: 'Courier New', monospace;
  }

  .empty-icon {
    font-size: 3rem;
    color: var(--theme-primary, #0f0);
    margin-bottom: 15px;
    animation: emptyPulse 2s infinite;
  }

  @keyframes emptyPulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
  }

  .empty-hint {
    font-size: 0.8rem;
    color: var(--theme-text, #0a0);
    opacity: 0.7;
    margin-top: 10px;
  }

  /* Archive Card Styles */
  .archive-card {
    position: relative;
    border: 1px solid var(--theme-border, #0f0);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    background: rgba(0, 20, 0, 0.22);
  }

  .archive-card:hover {
    transform: scale(1.03);
    box-shadow: 0 0 25px rgba(0, 255, 0, 0.4);
    border-color: var(--theme-secondary, #0ff);
  }

  .archive-card-image {
    width: 100%;
    height: 120px;
    object-fit: cover;
    display: block;
    border-bottom: 1px solid var(--theme-border, #0f0);
  }

  .archive-card-info {
    padding: 10px;
    font-family: 'Courier New', monospace;
  }

  .archive-card-style {
    color: var(--theme-primary, #0f0);
    font-size: 0.85rem;
    font-weight: bold;
    text-transform: capitalize;
    margin-bottom: 5px;
  }

  .archive-card-meta {
    font-size: 0.7rem;
    color: var(--theme-text, #0a0);
    opacity: 0.8;
  }

  .archive-card-actions {
    display: flex;
    gap: 5px;
    margin-top: 8px;
  }

  .archive-card-btn {
    flex: 1;
    padding: 5px 8px;
    font-size: 0.7rem;
    background: rgba(0, 30, 0, 0.28);
    color: var(--theme-primary, #0f0);
    border: 1px solid var(--theme-border, #0f0);
    border-radius: 3px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    transition: all 0.2s ease;
  }

  .archive-card-btn:hover {
    background: var(--theme-primary, #0f0);
    color: #000;
  }

  .archive-card-btn.delete-btn {
    border-color: #f00;
    color: #f00;
  }

  .archive-card-btn.delete-btn:hover {
    background: #f00;
    color: #000;
  }

  /* Scanline effect on cards */
  .archive-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 255, 0, 0.02) 2px,
      rgba(0, 255, 0, 0.02) 4px
    );
    pointer-events: none;
    z-index: 1;
  }
</style>

<script>
  // Archive Management Functions
  function loadUserArchive() {
    const archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');
    const gallery = document.getElementById('user-archive-gallery');
    const emptyState = document.getElementById('archive-empty');
    const creationCount = document.getElementById('creation-count');
    const storageUsed = document.getElementById('storage-used');

    // Update stats
    creationCount.textContent = archive.length;
    const storageSize = new Blob([JSON.stringify(archive)]).size;
    storageUsed.textContent = (storageSize / 1024).toFixed(1) + ' KB';

    if (archive.length === 0) {
      gallery.innerHTML = `
        <div class="archive-empty-state" id="archive-empty">
          <div class="empty-icon">[ ]</div>
          <p>No creations saved yet</p>
          <p class="empty-hint">Generate an image above and click "SAVE TO ARCHIVE"</p>
        </div>
      `;
      return;
    }

    gallery.innerHTML = archive.map((item, index) => `
      <div class="archive-card" data-id="${item.id}">
        <img src="${item.imageData}" alt="Creation ${index + 1}" class="archive-card-image" />
        <div class="archive-card-info">
          <div class="archive-card-style">${item.style}</div>
          <div class="archive-card-meta">${item.color} | ${item.intensity}${item.effect && item.effect !== 'none' ? ' | ' + item.effect : ''}</div>
          <div class="archive-card-actions">
            <button class="archive-card-btn" onclick="downloadFromArchive(${item.id})">DOWNLOAD</button>
            <button class="archive-card-btn delete-btn" onclick="deleteFromArchive(${item.id})">DELETE</button>
          </div>
        </div>
      </div>
    `).join('');
  }

  function deleteFromArchive(id) {
    let archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');
    archive = archive.filter(item => item.id !== id);
    localStorage.setItem(ARCHIVE_KEY, JSON.stringify(archive));
    loadUserArchive();
  }

  function downloadFromArchive(id) {
    const archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');
    const item = archive.find(item => item.id === id);
    if (item) {
      const link = document.createElement('a');
      link.download = `matrix-${item.style}-${item.id}.png`;
      link.href = item.imageData;
      link.click();
    }
  }

  function clearArchive() {
    if (confirm('Are you sure you want to delete all saved creations? This cannot be undone.')) {
      localStorage.removeItem(ARCHIVE_KEY);
      loadUserArchive();
    }
  }

  function exportArchive() {
    const archive = JSON.parse(localStorage.getItem(ARCHIVE_KEY) || '[]');
    if (archive.length === 0) {
      alert('No creations to export.');
      return;
    }

    // Create a zip-like download of all images (simplified: download first one)
    archive.forEach((item, index) => {
      setTimeout(() => {
        const link = document.createElement('a');
        link.download = `matrix-${item.style}-${index + 1}.png`;
        link.href = item.imageData;
        link.click();
      }, index * 500);
    });
  }

  // Load archive on page load
  document.addEventListener('DOMContentLoaded', loadUserArchive);
</script>

<!-- FOOOCUS AI IMAGE GENERATOR SECTION - HIDDEN FROM ALL USERS -->
<div class="container" style="display: none;">
  <div class="panel fooocus-panel">
    <h2 style="text-align: center; margin-bottom: 15px;">FOOOCUS AI IMAGE GENERATOR</h2>
    <p class="fooocus-subtitle">Open-source AI image generation - Focus on prompts, not parameters</p>

    <div class="fooocus-features">
      <div class="fooocus-feature">
        <span class="feature-icon">üé®</span>
        <span class="feature-text">Stable Diffusion powered</span>
      </div>
      <div class="fooocus-feature">
        <span class="feature-icon">‚ö°</span>
        <span class="feature-text">Optimized for speed</span>
      </div>
      <div class="fooocus-feature">
        <span class="feature-icon">üîß</span>
        <span class="feature-text">Minimal setup required</span>
      </div>
      <div class="fooocus-feature">
        <span class="feature-icon">üíª</span>
        <span class="feature-text">Local GPU processing</span>
      </div>
    </div>

    <div class="fooocus-description">
      <p>Fooocus is an image generating software based on Stable Diffusion. Designed to eliminate the complexity of parameter tuning, letting you focus entirely on your creative prompts. Supports SDXL, LoRA, ControlNet, and more.</p>
    </div>

    <div class="fooocus-actions">
      <a href="https://github.com/lllyasviel/Fooocus" class="btn fooocus-btn" target="_blank" rel="noopener">
        <span class="btn-icon">üìÇ</span> VIEW ON GITHUB
      </a>
      <a href="https://github.com/lllyasviel/Fooocus/releases" class="btn fooocus-btn secondary" target="_blank" rel="noopener">
        <span class="btn-icon">üì•</span> DOWNLOAD RELEASES
      </a>
    </div>

    <div class="fooocus-clone-cmd">
      <span class="cmd-label">Clone Repository:</span>
      <code id="fooocus-clone-code">gh repo clone lllyasviel/Fooocus</code>
      <button class="copy-btn" onclick="copyFooocusCmd()">üìã COPY</button>
    </div>
  </div>
</div>

<style>
  .fooocus-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: #0f0;
    border: 2px solid #0f0;
    position: relative;
    overflow: hidden;
  }

  .fooocus-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #0f0, #0ff, #0f0, transparent);
    animation: fooocusScan 4s linear infinite;
  }

  @keyframes fooocusScan {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .fooocus-subtitle {
    text-align: center;
    color: #0a0;
    font-size: 0.95rem;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
  }

  .fooocus-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .fooocus-feature {
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(0, 30, 0, 0.22);
    padding: 10px 15px;
    border-radius: 5px;
    border: 1px solid #0a0;
    transition: all 0.3s ease;
  }

  .fooocus-feature:hover {
    border-color: #0f0;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
  }

  .feature-icon {
    font-size: 1.2rem;
  }

  .feature-text {
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    color: #0f0;
  }

  .fooocus-description {
    background: rgba(0, 20, 0, 0.24);
    border: 1px solid #0a0;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 20px;
  }

  .fooocus-description p {
    color: #0f0;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.6;
    margin: 0;
  }

  .fooocus-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .fooocus-btn {
    display: inline-flex !important;
    align-items: center;
    gap: 8px;
    width: auto !important;
    padding: 12px 24px !important;
    font-size: 0.9rem;
  }

  .fooocus-btn.secondary {
    background: transparent;
    border: 1px dashed #0f0;
  }

  .fooocus-btn.secondary:hover {
    background: rgba(0, 255, 0, 0.1);
  }

  .fooocus-clone-cmd {
    background: #000;
    border: 1px solid #0f0;
    border-radius: 5px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .cmd-label {
    color: #0a0;
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
  }

  #fooocus-clone-code {
    background: rgba(0, 30, 0, 0.28);
    color: #0f0;
    padding: 8px 12px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    border: 1px solid #0a0;
  }

  .copy-btn {
    background: #001a00;
    color: #0f0;
    border: 1px solid #0f0;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    transition: all 0.2s ease;
  }

  .copy-btn:hover {
    background: #003300;
  }

  .copy-btn.copied {
    background: #0f0;
    color: #000;
  }
</style>

<script>
  function copyFooocusCmd() {
    const code = document.getElementById('fooocus-clone-code').textContent;
    navigator.clipboard.writeText(code).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = '‚úì COPIED';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'üìã COPY';
        btn.classList.remove('copied');
      }, 2000);
    }).catch(err => {
      console.error('Failed to copy:', err);
    });
  }
</script>

<!-- MATRIX AI VIDEO GENERATOR SECTION -->
<div class="container">
  <div class="panel matrix-ai-video-panel">
    <div class="matrix-ai-video-header">
      <div class="matrix-ai-video-icon">
        <svg viewBox="0 0 100 100" class="video-ai-icon">
          <rect x="10" y="15" width="80" height="50" rx="5" fill="none" stroke="#0f0" stroke-width="2"/>
          <circle cx="50" cy="40" r="12" fill="none" stroke="#0f0" stroke-width="2"/>
          <polygon points="46,35 46,45 56,40" fill="#0f0"/>
          <rect x="25" y="70" width="50" height="8" rx="2" fill="none" stroke="#0f0" stroke-width="2"/>
          <line x1="35" y1="74" x2="65" y2="74" stroke="#0f0" stroke-width="2"/>
        </svg>
      </div>
      <h2>MATRIX AI VIDEO GENERATOR</h2>
      <p class="matrix-ai-video-subtitle">Generate 30+ Second AI Videos from Text & Images</p>
    </div>

    <div class="matrix-ai-video-features">
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">üé¨</span>
        <span class="feature-text">Text to Video</span>
      </div>
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">üñºÔ∏è</span>
        <span class="feature-text">Image to Video</span>
      </div>
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">‚è±Ô∏è</span>
        <span class="feature-text">30+ Seconds</span>
      </div>
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">‚¨áÔ∏è</span>
        <span class="feature-text">Download Ready</span>
      </div>
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">üéØ</span>
        <span class="feature-text">High Resolution</span>
      </div>
      <div class="matrix-ai-video-feature">
        <span class="feature-icon">‚ö°</span>
        <span class="feature-text">Real-time AI</span>
      </div>
    </div>

    <div class="matrix-ai-video-description">
      <p>Create stunning AI-powered videos using advanced diffusion transformer technology. Generate 30+ second videos from text prompts or transform your images into dynamic video content. All generated videos are downloadable directly from the interface.</p>
    </div>

    <!-- Tab Navigation -->
    <div class="matrix-video-tabs">
      <button class="matrix-video-tab active" onclick="switchVideoTab('text2video')" id="tab-text2video">
        <span class="tab-icon">üìù</span> Text to Video
      </button>
      <button class="matrix-video-tab" onclick="switchVideoTab('image2video')" id="tab-image2video">
        <span class="tab-icon">üñºÔ∏è</span> Image to Video
      </button>
      <button class="matrix-video-tab" onclick="switchVideoTab('advanced')" id="tab-advanced">
        <span class="tab-icon">üöÄ</span> Advanced Generator
      </button>
    </div>

    <!-- Text to Video Tab Content -->
    <div class="matrix-video-tab-content active" id="content-text2video">
      <div class="matrix-video-embed-container">
        <div class="matrix-video-loading" id="loading-text2video">
          <div class="loading-spinner"></div>
          <span>Initializing Text-to-Video AI...</span>
        </div>
        <iframe
          src="https://wan-ai-wan2-1.hf.space"
          frameborder="0"
          width="100%"
          height="800"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; microphone; camera"
          loading="lazy"
          title="Matrix AI Video Generator - Text to Video"
          onload="document.getElementById('loading-text2video').style.display='none';">
        </iframe>
      </div>
      <div class="matrix-tab-info">
        <h4>Text-to-Video Features</h4>
        <ul>
          <li>Generate videos up to 30+ seconds from text descriptions</li>
          <li>High-quality 720p/1080p output resolution</li>
          <li>Advanced motion synthesis and scene generation</li>
          <li>Download generated videos directly</li>
        </ul>
      </div>
    </div>

    <!-- Image to Video Tab Content -->
    <div class="matrix-video-tab-content" id="content-image2video">
      <div class="matrix-video-embed-container">
        <div class="matrix-video-loading" id="loading-image2video">
          <div class="loading-spinner"></div>
          <span>Initializing Image-to-Video AI...</span>
        </div>
        <iframe
          src="https://multimodalart-hunyuan-video-1-5.hf.space"
          frameborder="0"
          width="100%"
          height="800"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; microphone; camera"
          loading="lazy"
          title="Matrix AI Video Generator - Image to Video"
          onload="document.getElementById('loading-image2video').style.display='none';">
        </iframe>
      </div>
      <div class="matrix-tab-info">
        <h4>Image-to-Video Features</h4>
        <ul>
          <li>Transform static images into dynamic videos</li>
          <li>Add motion and animation to any picture</li>
          <li>Control movement direction and intensity</li>
          <li>Export and download your animated creations</li>
        </ul>
      </div>
    </div>

    <!-- Advanced Generator Tab Content -->
    <div class="matrix-video-tab-content" id="content-advanced">
      <div class="matrix-video-embed-container">
        <div class="matrix-video-loading" id="loading-advanced">
          <div class="loading-spinner"></div>
          <span>Initializing Advanced Video Generator...</span>
        </div>
        <iframe
          src="https://lightricks-ltx-video-distilled.hf.space"
          frameborder="0"
          width="100%"
          height="800"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; microphone; camera"
          loading="lazy"
          title="Matrix AI Video Generator - Advanced LTX"
          onload="document.getElementById('loading-advanced').style.display='none';">
        </iframe>
      </div>
      <div class="matrix-tab-info">
        <h4>Advanced Generator Features</h4>
        <ul>
          <li>Real-time video generation at up to 30 FPS</li>
          <li>Fine-tuned diffusion transformer technology</li>
          <li>Combined text and image input support</li>
          <li>Professional-grade output quality</li>
        </ul>
      </div>
    </div>

    <div class="matrix-video-tips">
      <h3>PROMPT TIPS FOR BEST RESULTS</h3>
      <div class="tips-grid">
        <div class="tip-item">
          <span class="tip-icon">üìù</span>
          <p>Be specific and detailed in your descriptions - include subjects, actions, settings, and mood</p>
        </div>
        <div class="tip-item">
          <span class="tip-icon">üé•</span>
          <p>Include camera movements: pan, zoom, tracking shot, dolly, crane shot</p>
        </div>
        <div class="tip-item">
          <span class="tip-icon">üí°</span>
          <p>Specify lighting conditions: golden hour, neon glow, dramatic shadows, soft ambient</p>
        </div>
        <div class="tip-item">
          <span class="tip-icon">üé®</span>
          <p>Define visual style: cinematic, anime, realistic, cyberpunk, Matrix-style</p>
        </div>
      </div>
      <div class="sample-prompt">
        <strong>Sample Prompt:</strong> "Matrix digital rain falling through a dark cityscape, green glowing code cascading down skyscrapers, cinematic camera slowly panning upward, neon reflections on wet streets, cyberpunk atmosphere, 4K quality"
      </div>
    </div>

    <div class="matrix-video-how-to">
      <h3>HOW TO GENERATE & DOWNLOAD</h3>
      <div class="how-to-steps">
        <div class="how-to-step">
          <span class="step-number">1</span>
          <p>Select your preferred generator tab (Text-to-Video, Image-to-Video, or Advanced)</p>
        </div>
        <div class="how-to-step">
          <span class="step-number">2</span>
          <p>Enter your text prompt or upload an image</p>
        </div>
        <div class="how-to-step">
          <span class="step-number">3</span>
          <p>Adjust settings (duration, resolution, style) if available</p>
        </div>
        <div class="how-to-step">
          <span class="step-number">4</span>
          <p>Click Generate and wait for AI processing</p>
        </div>
        <div class="how-to-step">
          <span class="step-number">5</span>
          <p>Download your video using the download button in the interface</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function switchVideoTab(tabName) {
    // Remove active class from all tabs and contents
    document.querySelectorAll('.matrix-video-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.matrix-video-tab-content').forEach(content => content.classList.remove('active'));

    // Add active class to selected tab and content
    document.getElementById('tab-' + tabName).classList.add('active');
    document.getElementById('content-' + tabName).classList.add('active');
  }
</script>

<style>
  /* ============================================
     MATRIX AI VIDEO GENERATOR STYLES
     ============================================ */

  .matrix-ai-video-panel {
    background: var(--theme-bg-panel) !important;
    --matrix-pulse-color: var(--section-video-generator, #0f0);
    border: 2px solid var(--section-video-generator, #0f0);
    border-radius: 14px;
    box-shadow:
      0 0 0 calc(var(--matrix-bass) * 2px) rgba(0, 255, 0, 0.22),
      0 0 26px rgba(0, 255, 0, 0.14),
      0 0 60px rgba(0, 255, 255, 0.05);
    background-image:
      radial-gradient(1100px circle at 15% 0%, rgba(0, 255, 0, 0.14), transparent 55%),
      radial-gradient(900px circle at 85% 100%, rgba(0, 255, 255, 0.06), transparent 60%),
      repeating-linear-gradient(180deg, rgba(255, 255, 255, 0.025) 0px, rgba(255, 255, 255, 0.025) 1px, transparent 2px, transparent 7px);
    background-blend-mode: screen;
    isolation: isolate;
    position: relative;
    overflow: hidden;
  }

  .matrix-ai-video-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--section-video-generator, #0f0), #0ff, var(--section-video-generator, #0f0), transparent);
    animation: matrixAiVideoScan 4s linear infinite;
    opacity: 0.9;
    z-index: 2;
  }

  .matrix-ai-video-panel::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    background:
      radial-gradient(closest-side at 50% 50%, transparent 60%, rgba(0, 0, 0, 0.55) 100%),
      linear-gradient(90deg, rgba(255, 0, 0, 0.03), transparent 18%, transparent 82%, rgba(0, 255, 255, 0.03));
    opacity: 0.9;
    animation: matrixCrtFlicker 7.2s steps(2) infinite;
  }

  @keyframes matrixAiVideoScan {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Header Section */
  .matrix-ai-video-header {
    text-align: center;
    margin-bottom: 25px;
    position: relative;
    z-index: 2;
  }

  .matrix-ai-video-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 15px;
    animation: iconPulse 2s ease-in-out infinite;
  }

  .video-ai-icon {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 0 10px var(--section-video-generator, #0f0));
  }

  @keyframes iconPulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
  }

  .matrix-ai-video-header h2 {
    color: var(--section-video-generator, #0f0);
    font-size: 1.8rem;
    text-shadow: 0 0 20px var(--section-video-generator, #0f0), 0 0 40px var(--section-video-generator, #0f0);
    margin: 0 0 10px 0;
    font-family: 'Courier New', monospace;
    letter-spacing: 3px;
  }

  .matrix-ai-video-subtitle {
    text-align: center;
    color: #0ff;
    font-size: 1rem;
    margin-bottom: 20px;
    font-family: 'Courier New', monospace;
    text-shadow: 0 0 10px #0ff;
  }

  /* Features Grid */
  .matrix-ai-video-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 25px;
    position: relative;
    z-index: 2;
  }

	  .matrix-ai-video-feature {
	    display: flex;
	    align-items: center;
	    gap: 8px;
	    background: rgba(0, 30, 0, 0.14);
	    padding: 10px 12px;
	    border-radius: 5px;
	    border: 1px solid var(--section-video-generator, #0a0);
	    transition: all 0.3s ease;
	    font-family: 'Courier New', monospace;
	    font-size: 0.8rem;
	    color: var(--section-video-generator, #0f0);
	  }

  .matrix-ai-video-feature:hover {
    border-color: var(--section-video-generator, #0f0);
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
    transform: translateY(-2px);
  }

  .matrix-ai-video-feature .feature-icon {
    font-size: 1.1rem;
  }

	  /* Description */
	  .matrix-ai-video-description {
	    background: rgba(0, 20, 0, 0.16);
	    border: 1px solid var(--section-video-generator, #0a0);
	    border-radius: 5px;
	    padding: 15px;
	    margin-bottom: 20px;
      position: relative;
      z-index: 2;
	  }

  .matrix-ai-video-description p {
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.6;
    margin: 0;
    text-align: center;
  }

  /* Tab Navigation */
  .matrix-video-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
    position: relative;
    z-index: 2;
  }

	  .matrix-video-tab {
	    background: rgba(0, 20, 0, 0.18);
	    border: 2px solid var(--section-video-generator, #0a0);
	    color: var(--section-video-generator, #0a0);
	    padding: 12px 20px;
	    border-radius: 8px;
	    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
  }

  .matrix-video-tab::after {
    content: '';
    position: absolute;
    left: 12px;
    right: 12px;
    bottom: 6px;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.9), rgba(0, 255, 255, 0.55), rgba(0, 255, 0, 0.9), transparent);
    transform: scaleX(0);
    transform-origin: center;
    transition: transform 0.25s ease;
    opacity: 0.85;
  }

  .matrix-video-tab:hover {
    border-color: var(--section-video-generator, #0f0);
    color: var(--section-video-generator, #0f0);
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
  }

  .matrix-video-tab.active {
    background: rgba(0, 255, 0, 0.15);
    border-color: var(--section-video-generator, #0f0);
    color: var(--section-video-generator, #0f0);
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.3), inset 0 0 20px rgba(0, 255, 0, 0.1);
  }

  .matrix-video-tab.active::after {
    transform: scaleX(1);
  }

  .matrix-video-tab:focus-visible {
    outline: 2px solid rgba(0, 255, 255, 0.65);
    outline-offset: 3px;
  }

  .matrix-video-tab .tab-icon {
    font-size: 1.1rem;
  }

  /* Tab Content */
  .matrix-video-tab-content {
    display: none;
  }

  .matrix-video-tab-content.active {
    display: block;
  }

	  /* Embed Container */
	  .matrix-video-embed-container {
	    background: rgba(0, 0, 0, 0.18);
	    border: 2px solid var(--section-video-generator, #0f0);
	    border-radius: 10px;
	    padding: 10px;
	    overflow: hidden;
	    position: relative;
	    min-height: 800px;
	    box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
	    backdrop-filter: blur(12px);
	    -webkit-backdrop-filter: blur(12px);
	  }

  .matrix-video-embed-container::before {
    content: '';
    position: absolute;
    inset: 8px;
    pointer-events: none;
    border-radius: 8px;
    background:
      repeating-linear-gradient(180deg, rgba(0, 255, 0, 0.03) 0px, rgba(0, 255, 0, 0.03) 1px, transparent 2px, transparent 8px);
    mix-blend-mode: screen;
    opacity: 0.45;
    z-index: 2;
  }

  .matrix-video-embed-container::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: 10px;
    background: radial-gradient(closest-side at 50% 50%, transparent 62%, rgba(0, 0, 0, 0.55) 100%);
    opacity: 0.65;
    z-index: 2;
  }

  .matrix-video-embed-container iframe {
    border-radius: 8px;
    display: block;
    position: relative;
    z-index: 1;
  }

  /* Loading Indicator */
  .matrix-video-loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    z-index: 5;
  }

  .matrix-video-loading .loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid rgba(0, 255, 0, 0.2);
    border-top-color: var(--section-video-generator, #0f0);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

	  /* Tab Info */
	  .matrix-tab-info {
	    background: rgba(0, 20, 0, 0.18);
	    border: 1px solid var(--section-video-generator, #0a0);
	    border-radius: 5px;
	    padding: 15px;
	    margin-top: 15px;
	  }

  .matrix-tab-info h4 {
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    margin: 0 0 10px 0;
    text-shadow: 0 0 10px var(--section-video-generator, #0f0);
  }

  .matrix-tab-info ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .matrix-tab-info li {
    color: var(--section-video-generator, #0a0);
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    padding: 5px 0;
    padding-left: 20px;
    position: relative;
    opacity: 0.8;
  }

  .matrix-tab-info li::before {
    content: '>';
    position: absolute;
    left: 0;
    color: var(--section-video-generator, #0f0);
  }

	  /* Tips Section */
	  .matrix-video-tips {
	    background: rgba(0, 20, 0, 0.18);
	    border: 1px solid var(--section-video-generator, #0a0);
	    border-radius: 8px;
	    padding: 20px;
	    margin-top: 25px;
	  }

  .matrix-video-tips h3 {
    text-align: center;
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    margin: 0 0 15px 0;
    text-shadow: 0 0 10px var(--section-video-generator, #0f0);
  }

  .tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
  }

	  .tip-item {
	    display: flex;
	    align-items: flex-start;
	    gap: 10px;
	    background: rgba(0, 30, 0, 0.12);
	    padding: 12px;
	    border-radius: 5px;
	    border: 1px solid var(--section-video-generator, #0a0);
	  }

  .tip-item .tip-icon {
    font-size: 1.2rem;
    flex-shrink: 0;
  }

  .tip-item p {
    color: var(--section-video-generator, #0a0);
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    margin: 0;
    line-height: 1.4;
    opacity: 0.8;
  }

	  .sample-prompt {
	    background: rgba(0, 0, 0, 0.18);
	    border: 1px dashed var(--section-video-generator, #0f0);
	    border-radius: 5px;
	    padding: 15px;
	    color: var(--section-video-generator, #0f0);
	    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    line-height: 1.5;
  }

  .sample-prompt strong {
    color: #0ff;
    display: block;
    margin-bottom: 8px;
  }

	  /* How To Section */
	  .matrix-video-how-to {
	    background: rgba(0, 20, 0, 0.18);
	    border: 1px solid var(--section-video-generator, #0a0);
	    border-radius: 8px;
	    padding: 20px;
	    margin-top: 20px;
	  }

  .matrix-video-how-to h3 {
    text-align: center;
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    margin: 0 0 20px 0;
    text-shadow: 0 0 10px var(--section-video-generator, #0f0);
  }

  .how-to-steps {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .how-to-step {
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(0, 30, 0, 0.22);
    padding: 12px 15px;
    border-radius: 5px;
    border: 1px solid var(--section-video-generator, #0a0);
    transition: all 0.3s ease;
  }

  .how-to-step:hover {
    border-color: var(--section-video-generator, #0f0);
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.15);
  }

  .step-number {
    width: 30px;
    height: 30px;
    background: rgba(0, 255, 0, 0.2);
    border: 2px solid var(--section-video-generator, #0f0);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--section-video-generator, #0f0);
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 0.9rem;
    flex-shrink: 0;
  }

  .how-to-step p {
    color: var(--section-video-generator, #0a0);
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    margin: 0;
    opacity: 0.8;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .matrix-ai-video-header h2 {
      font-size: 1.4rem;
      letter-spacing: 1px;
    }

    .matrix-ai-video-subtitle {
      font-size: 0.85rem;
    }

    .matrix-ai-video-features {
      grid-template-columns: repeat(2, 1fr);
    }

    .matrix-video-tabs {
      flex-direction: column;
    }

    .matrix-video-tab {
      width: 100%;
      justify-content: center;
    }

    .matrix-video-embed-container {
      min-height: 600px;
    }

    .matrix-video-embed-container iframe {
      height: 600px;
    }

    .tips-grid {
      grid-template-columns: 1fr;
    }

    .how-to-step {
      flex-direction: column;
      text-align: center;
      gap: 10px;
    }
  }

  @media (max-width: 480px) {
    .matrix-ai-video-features {
      grid-template-columns: 1fr;
    }

    .matrix-ai-video-icon {
      width: 60px;
      height: 60px;
    }
  }
</style>

</body>
                           </html>
